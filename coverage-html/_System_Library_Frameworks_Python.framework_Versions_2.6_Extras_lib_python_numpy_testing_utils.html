<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
<title>Coverage for /System/Library/Frameworks/Python.framework/Versions/2.6/Extras/lib/python/numpy/testing/utils</title>
<link rel='stylesheet' href='style.css' type='text/css'>
<script type='text/javascript' src='jquery-1.3.2.min.js'></script>
<script type='text/javascript'>
function toggle_lines(btn, cls) {
    var btn = $(btn);
    var hide = "hide_"+cls;
    if (btn.hasClass(hide)) {
        $("#source ."+cls).removeClass(hide);
        btn.removeClass(hide);
    }
    else {
        $("#source ."+cls).addClass(hide);
        btn.addClass(hide);
    }
}
</script>
</head>
<body>
<div id='header'>
    <div class='content'>
        <h1>Coverage for <b>/System/Library/Frameworks/Python.framework/Versions/2.6/Extras/lib/python/numpy/testing/utils</b> :
            <span class='pc_cov'>10%</span>
        </h1>
        <h2 class='stats'>
            269 statements
            <span class='run hide_run' onclick='toggle_lines(this, "run")'>28 run</span>
            <span class='exc' onclick='toggle_lines(this, "exc")'>0 excluded</span>
            <span class='mis' onclick='toggle_lines(this, "mis")'>241 missing</span>
            
        </h2>
    </div>
</div>

<div id='source'>
<table cellspacing='0' cellpadding='0'>
<tr>
<td class='linenos' valign='top'>
<p class='pln'>1</p>
<p class='pln'>2</p>
<p class='pln'>3</p>
<p class='pln'>4</p>
<p class='stm run hide_run'>5</p>
<p class='stm run hide_run'>6</p>
<p class='stm run hide_run'>7</p>
<p class='stm run hide_run'>8</p>
<p class='stm run hide_run'>9</p>
<p class='pln'>10</p>
<p class='stm run hide_run'>11</p>
<p class='pln'>12</p>
<p class='pln'>13</p>
<p class='pln'>14</p>
<p class='pln'>15</p>
<p class='pln'>16</p>
<p class='stm run hide_run'>17</p>
<p class='pln'>18</p>
<p class='stm run hide_run'>19</p>
<p class='pln'>20</p>
<p class='pln'>21</p>
<p class='pln'>22</p>
<p class='pln'>23</p>
<p class='stm mis'>24</p>
<p class='stm mis'>25</p>
<p class='stm mis'>26</p>
<p class='stm mis'>27</p>
<p class='stm mis'>28</p>
<p class='stm mis'>29</p>
<p class='stm mis'>30</p>
<p class='pln'>31</p>
<p class='stm run hide_run'>32</p>
<p class='stm mis'>33</p>
<p class='pln'>34</p>
<p class='pln'>35</p>
<p class='pln'>36</p>
<p class='stm mis'>37</p>
<p class='stm mis'>38</p>
<p class='stm mis'>39</p>
<p class='stm mis'>40</p>
<p class='stm mis'>41</p>
<p class='stm mis'>42</p>
<p class='stm mis'>43</p>
<p class='stm mis'>44</p>
<p class='stm mis'>45</p>
<p class='stm mis'>46</p>
<p class='pln'>47</p>
<p class='stm mis'>48</p>
<p class='pln'>49</p>
<p class='pln'>50</p>
<p class='stm mis'>51</p>
<p class='stm mis'>52</p>
<p class='stm mis'>53</p>
<p class='stm mis'>54</p>
<p class='stm mis'>55</p>
<p class='stm mis'>56</p>
<p class='stm mis'>57</p>
<p class='pln'>58</p>
<p class='pln'>59</p>
<p class='pln'>60</p>
<p class='pln'>61</p>
<p class='stm run hide_run'>62</p>
<p class='pln'>63</p>
<p class='pln'>64</p>
<p class='stm mis'>65</p>
<p class='stm mis'>66</p>
<p class='stm mis'>67</p>
<p class='stm mis'>68</p>
<p class='stm run hide_run'>69</p>
<p class='pln'>70</p>
<p class='stm mis'>71</p>
<p class='pln'>72</p>
<p class='stm run hide_run'>73</p>
<p class='pln'>74</p>
<p class='stm mis'>75</p>
<p class='pln'>76</p>
<p class='pln'>77</p>
<p class='pln'>78</p>
<p class='pln'>79</p>
<p class='pln'>80</p>
<p class='pln'>81</p>
<p class='pln'>82</p>
<p class='pln'>83</p>
<p class='pln'>84</p>
<p class='stm mis'>85</p>
<p class='stm mis'>86</p>
<p class='stm mis'>87</p>
<p class='stm mis'>88</p>
<p class='stm mis'>89</p>
<p class='stm mis'>90</p>
<p class='stm mis'>91</p>
<p class='stm mis'>92</p>
<p class='stm mis'>93</p>
<p class='stm mis'>94</p>
<p class='pln'>95</p>
<p class='stm mis'>96</p>
<p class='pln'>97</p>
<p class='stm mis'>98</p>
<p class='pln'>99</p>
<p class='stm mis'>100</p>
<p class='pln'>101</p>
<p class='stm mis'>102</p>
<p class='stm mis'>103</p>
<p class='pln'>104</p>
<p class='pln'>105</p>
<p class='pln'>106</p>
<p class='stm run hide_run'>107</p>
<p class='pln'>108</p>
<p class='pln'>109</p>
<p class='stm mis'>110</p>
<p class='stm mis'>111</p>
<p class='stm mis'>112</p>
<p class='stm mis'>113</p>
<p class='pln'>114</p>
<p class='stm mis'>115</p>
<p class='stm mis'>116</p>
<p class='stm mis'>117</p>
<p class='stm mis'>118</p>
<p class='stm mis'>119</p>
<p class='stm mis'>120</p>
<p class='stm mis'>121</p>
<p class='stm mis'>122</p>
<p class='stm mis'>123</p>
<p class='stm mis'>124</p>
<p class='stm mis'>125</p>
<p class='stm mis'>126</p>
<p class='pln'>127</p>
<p class='stm run hide_run'>128</p>
<p class='pln'>129</p>
<p class='pln'>130</p>
<p class='pln'>131</p>
<p class='pln'>132</p>
<p class='pln'>133</p>
<p class='pln'>134</p>
<p class='pln'>135</p>
<p class='pln'>136</p>
<p class='pln'>137</p>
<p class='pln'>138</p>
<p class='pln'>139</p>
<p class='pln'>140</p>
<p class='pln'>141</p>
<p class='pln'>142</p>
<p class='pln'>143</p>
<p class='pln'>144</p>
<p class='pln'>145</p>
<p class='pln'>146</p>
<p class='pln'>147</p>
<p class='pln'>148</p>
<p class='pln'>149</p>
<p class='pln'>150</p>
<p class='pln'>151</p>
<p class='pln'>152</p>
<p class='pln'>153</p>
<p class='pln'>154</p>
<p class='pln'>155</p>
<p class='pln'>156</p>
<p class='pln'>157</p>
<p class='pln'>158</p>
<p class='pln'>159</p>
<p class='pln'>160</p>
<p class='pln'>161</p>
<p class='pln'>162</p>
<p class='pln'>163</p>
<p class='stm mis'>164</p>
<p class='stm mis'>165</p>
<p class='stm mis'>166</p>
<p class='stm mis'>167</p>
<p class='stm mis'>168</p>
<p class='stm mis'>169</p>
<p class='stm mis'>170</p>
<p class='stm mis'>171</p>
<p class='stm mis'>172</p>
<p class='stm mis'>173</p>
<p class='stm mis'>174</p>
<p class='stm mis'>175</p>
<p class='stm mis'>176</p>
<p class='stm mis'>177</p>
<p class='stm mis'>178</p>
<p class='stm mis'>179</p>
<p class='stm mis'>180</p>
<p class='stm mis'>181</p>
<p class='stm mis'>182</p>
<p class='stm mis'>183</p>
<p class='pln'>184</p>
<p class='stm run hide_run'>185</p>
<p class='stm mis'>186</p>
<p class='stm mis'>187</p>
<p class='stm mis'>188</p>
<p class='stm mis'>189</p>
<p class='stm mis'>190</p>
<p class='stm mis'>191</p>
<p class='stm mis'>192</p>
<p class='stm mis'>193</p>
<p class='stm mis'>194</p>
<p class='stm mis'>195</p>
<p class='stm mis'>196</p>
<p class='stm mis'>197</p>
<p class='pln'>198</p>
<p class='stm run hide_run'>199</p>
<p class='pln'>200</p>
<p class='pln'>201</p>
<p class='pln'>202</p>
<p class='pln'>203</p>
<p class='pln'>204</p>
<p class='pln'>205</p>
<p class='stm mis'>206</p>
<p class='stm mis'>207</p>
<p class='stm mis'>208</p>
<p class='stm mis'>209</p>
<p class='stm mis'>210</p>
<p class='stm mis'>211</p>
<p class='pln'>212</p>
<p class='pln'>213</p>
<p class='stm run hide_run'>214</p>
<p class='pln'>215</p>
<p class='pln'>216</p>
<p class='pln'>217</p>
<p class='pln'>218</p>
<p class='pln'>219</p>
<p class='stm mis'>220</p>
<p class='stm mis'>221</p>
<p class='stm mis'>222</p>
<p class='stm mis'>223</p>
<p class='pln'>224</p>
<p class='stm mis'>225</p>
<p class='stm mis'>226</p>
<p class='stm mis'>227</p>
<p class='stm mis'>228</p>
<p class='stm mis'>229</p>
<p class='stm mis'>230</p>
<p class='stm mis'>231</p>
<p class='stm mis'>232</p>
<p class='stm mis'>233</p>
<p class='stm mis'>234</p>
<p class='pln'>235</p>
<p class='pln'>236</p>
<p class='pln'>237</p>
<p class='stm mis'>238</p>
<p class='stm mis'>239</p>
<p class='pln'>240</p>
<p class='stm run hide_run'>241</p>
<p class='pln'>242</p>
<p class='stm mis'>243</p>
<p class='stm mis'>244</p>
<p class='stm mis'>245</p>
<p class='stm mis'>246</p>
<p class='pln'>247</p>
<p class='stm mis'>248</p>
<p class='stm mis'>249</p>
<p class='pln'>250</p>
<p class='stm mis'>251</p>
<p class='stm mis'>252</p>
<p class='stm mis'>253</p>
<p class='stm mis'>254</p>
<p class='pln'>255</p>
<p class='pln'>256</p>
<p class='pln'>257</p>
<p class='pln'>258</p>
<p class='pln'>259</p>
<p class='stm mis'>260</p>
<p class='stm mis'>261</p>
<p class='pln'>262</p>
<p class='stm mis'>263</p>
<p class='pln'>264</p>
<p class='pln'>265</p>
<p class='pln'>266</p>
<p class='stm mis'>267</p>
<p class='stm mis'>268</p>
<p class='stm mis'>269</p>
<p class='stm mis'>270</p>
<p class='stm mis'>271</p>
<p class='stm mis'>272</p>
<p class='pln'>273</p>
<p class='pln'>274</p>
<p class='pln'>275</p>
<p class='pln'>276</p>
<p class='pln'>277</p>
<p class='stm mis'>278</p>
<p class='pln'>279</p>
<p class='stm mis'>280</p>
<p class='stm mis'>281</p>
<p class='stm mis'>282</p>
<p class='stm mis'>283</p>
<p class='pln'>284</p>
<p class='stm mis'>285</p>
<p class='stm mis'>286</p>
<p class='stm mis'>287</p>
<p class='stm mis'>288</p>
<p class='stm mis'>289</p>
<p class='stm mis'>290</p>
<p class='pln'>291</p>
<p class='pln'>292</p>
<p class='pln'>293</p>
<p class='pln'>294</p>
<p class='stm mis'>295</p>
<p class='stm mis'>296</p>
<p class='stm mis'>297</p>
<p class='stm mis'>298</p>
<p class='pln'>299</p>
<p class='stm mis'>300</p>
<p class='pln'>301</p>
<p class='stm run hide_run'>302</p>
<p class='stm mis'>303</p>
<p class='pln'>304</p>
<p class='pln'>305</p>
<p class='stm run hide_run'>306</p>
<p class='stm mis'>307</p>
<p class='stm mis'>308</p>
<p class='stm mis'>309</p>
<p class='stm mis'>310</p>
<p class='pln'>311</p>
<p class='pln'>312</p>
<p class='stm run hide_run'>313</p>
<p class='stm mis'>314</p>
<p class='pln'>315</p>
<p class='pln'>316</p>
<p class='pln'>317</p>
<p class='stm run hide_run'>318</p>
<p class='stm mis'>319</p>
<p class='pln'>320</p>
<p class='stm run hide_run'>321</p>
<p class='pln'>322</p>
<p class='stm mis'>323</p>
<p class='pln'>324</p>
<p class='stm mis'>325</p>
<p class='stm mis'>326</p>
<p class='stm mis'>327</p>
<p class='stm mis'>328</p>
<p class='stm mis'>329</p>
<p class='stm mis'>330</p>
<p class='stm mis'>331</p>
<p class='stm mis'>332</p>
<p class='stm mis'>333</p>
<p class='stm mis'>334</p>
<p class='stm mis'>335</p>
<p class='stm mis'>336</p>
<p class='stm mis'>337</p>
<p class='stm mis'>338</p>
<p class='stm mis'>339</p>
<p class='stm mis'>340</p>
<p class='stm mis'>341</p>
<p class='stm mis'>342</p>
<p class='stm mis'>343</p>
<p class='stm mis'>344</p>
<p class='stm mis'>345</p>
<p class='stm mis'>346</p>
<p class='stm mis'>347</p>
<p class='pln'>348</p>
<p class='stm mis'>349</p>
<p class='stm mis'>350</p>
<p class='stm mis'>351</p>
<p class='stm mis'>352</p>
<p class='stm mis'>353</p>
<p class='stm mis'>354</p>
<p class='stm mis'>355</p>
<p class='stm mis'>356</p>
<p class='stm mis'>357</p>
<p class='stm mis'>358</p>
<p class='stm mis'>359</p>
<p class='pln'>360</p>
<p class='pln'>361</p>
<p class='stm run hide_run'>362</p>
<p class='pln'>363</p>
<p class='pln'>364</p>
<p class='stm mis'>365</p>
<p class='stm mis'>366</p>
<p class='stm mis'>367</p>
<p class='stm mis'>368</p>
<p class='stm mis'>369</p>
<p class='stm mis'>370</p>
<p class='stm mis'>371</p>
<p class='stm mis'>372</p>
<p class='stm mis'>373</p>
<p class='pln'>374</p>
<p class='stm mis'>375</p>
<p class='stm mis'>376</p>
<p class='stm mis'>377</p>
<p class='pln'>378</p>
<p class='stm mis'>379</p>
<p class='stm mis'>380</p>
<p class='stm mis'>381</p>
<p class='stm mis'>382</p>
<p class='stm mis'>383</p>
<p class='pln'>384</p>
<p class='pln'>385</p>
<p class='stm run hide_run'>386</p>
<p class='stm mis'>387</p>
<p class='stm mis'>388</p>
<p class='pln'>389</p>
<p class='stm run hide_run'>390</p>
<p class='stm mis'>391</p>
<p class='stm mis'>392</p>
<p class='pln'>393</p>
<p class='stm run hide_run'>394</p>
<p class='pln'>395</p>
<p class='pln'>396</p>
<p class='pln'>397</p>
<p class='pln'>398</p>
<p class='pln'>399</p>
<p class='pln'>400</p>
<p class='pln'>401</p>
<p class='pln'>402</p>
<p class='pln'>403</p>
<p class='pln'>404</p>
<p class='pln'>405</p>
<p class='pln'>406</p>
<p class='pln'>407</p>
<p class='pln'>408</p>
<p class='stm mis'>409</p>
<p class='stm mis'>410</p>
<p class='pln'>411</p>
<p class='stm mis'>412</p>
<p class='stm mis'>413</p>
<p class='pln'>414</p>
<p class='pln'>415</p>
<p class='stm mis'>416</p>
<p class='pln'>417</p>
<p class='stm mis'>418</p>
<p class='stm mis'>419</p>
<p class='stm mis'>420</p>
<p class='stm mis'>421</p>
<p class='stm mis'>422</p>
<p class='pln'>423</p>
<p class='stm mis'>424</p>
<p class='stm mis'>425</p>
<p class='pln'>426</p>
<p class='stm mis'>427</p>
<p class='stm mis'>428</p>
<p class='stm mis'>429</p>
<p class='stm mis'>430</p>
<p class='pln'>431</p>
<p class='pln'>432</p>
<p class='stm run hide_run'>433</p>
<p class='pln'>434</p>
<p class='pln'>435</p>
<p class='pln'>436</p>
<p class='stm mis'>437</p>
<p class='stm mis'>438</p>
<p class='pln'>439</p>
<p class='stm mis'>440</p>
<p class='pln'>441</p>
<p class='pln'>442</p>
<p class='stm mis'>443</p>
<p class='stm mis'>444</p>
<p class='stm mis'>445</p>
<p class='stm mis'>446</p>
<p class='stm mis'>447</p>
<p class='stm mis'>448</p>
<p class='stm mis'>449</p>
    
</td>
<td class='text' valign='top'>
<p class='pln'><span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>Utility function to facilitate testing.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>import</span> <span class='nam'>os</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>import</span> <span class='nam'>sys</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>import</span> <span class='nam'>re</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>import</span> <span class='nam'>operator</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>from</span> <span class='nam'>nosetester</span> <span class='key'>import</span> <span class='nam'>import_nose</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='nam'>__all__</span> <span class='op'>=</span> <span class='op'>[</span><span class='str'>&#39;assert_equal&#39;</span><span class='op'>,</span> <span class='str'>&#39;assert_almost_equal&#39;</span><span class='op'>,</span><span class='str'>&#39;assert_approx_equal&#39;</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='str'>&#39;assert_array_equal&#39;</span><span class='op'>,</span> <span class='str'>&#39;assert_array_less&#39;</span><span class='op'>,</span> <span class='str'>&#39;assert_string_equal&#39;</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='str'>&#39;assert_array_almost_equal&#39;</span><span class='op'>,</span> <span class='str'>&#39;assert_raises&#39;</span><span class='op'>,</span> <span class='str'>&#39;build_err_msg&#39;</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='str'>&#39;decorate_methods&#39;</span><span class='op'>,</span> <span class='str'>&#39;jiffies&#39;</span><span class='op'>,</span> <span class='str'>&#39;memusage&#39;</span><span class='op'>,</span> <span class='str'>&#39;print_assert_equal&#39;</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='str'>&#39;raises&#39;</span><span class='op'>,</span> <span class='str'>&#39;rand&#39;</span><span class='op'>,</span> <span class='str'>&#39;rundocs&#39;</span><span class='op'>,</span> <span class='str'>&#39;runstring&#39;</span><span class='op'>,</span> <span class='str'>&#39;verbose&#39;</span><span class='op'>,</span> <span class='str'>&#39;measure&#39;</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='nam'>verbose</span> <span class='op'>=</span> <span class='num'>0</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>rand</span><span class='op'>(</span><span class='op'>*</span><span class='nam'>args</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Returns an array of random numbers with the given shape.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; This only uses the standard library, so it is useful for testing purposes.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>import</span> <span class='nam'>random</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>from</span> <span class='nam'>numpy</span><span class='op'>.</span><span class='nam'>core</span> <span class='key'>import</span> <span class='nam'>zeros</span><span class='op'>,</span> <span class='nam'>float64</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>results</span> <span class='op'>=</span> <span class='nam'>zeros</span><span class='op'>(</span><span class='nam'>args</span><span class='op'>,</span> <span class='nam'>float64</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>f</span> <span class='op'>=</span> <span class='nam'>results</span><span class='op'>.</span><span class='nam'>flat</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>i</span> <span class='key'>in</span> <span class='nam'>range</span><span class='op'>(</span><span class='nam'>len</span><span class='op'>(</span><span class='nam'>f</span><span class='op'>)</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>f</span><span class='op'>[</span><span class='nam'>i</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>random</span><span class='op'>.</span><span class='nam'>random</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>results</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>if</span> <span class='nam'>sys</span><span class='op'>.</span><span class='nam'>platform</span><span class='op'>[</span><span class='op'>:</span><span class='num'>5</span><span class='op'>]</span><span class='op'>==</span><span class='str'>&#39;linux&#39;</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>jiffies</span><span class='op'>(</span><span class='nam'>_proc_pid_stat</span> <span class='op'>=</span> <span class='str'>&#39;/proc/%s/stat&#39;</span><span class='op'>%</span><span class='op'>(</span><span class='nam'>os</span><span class='op'>.</span><span class='nam'>getpid</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>_load_time</span><span class='op'>=</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Return number of jiffies (1/100ths of a second) that this</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; process has been scheduled in user mode. See man 5 proc. &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>import</span> <span class='nam'>time</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>_load_time</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>_load_time</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>time</span><span class='op'>.</span><span class='nam'>time</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>f</span><span class='op'>=</span><span class='nam'>open</span><span class='op'>(</span><span class='nam'>_proc_pid_stat</span><span class='op'>,</span><span class='str'>&#39;r&#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>l</span> <span class='op'>=</span> <span class='nam'>f</span><span class='op'>.</span><span class='nam'>readline</span><span class='op'>(</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>split</span><span class='op'>(</span><span class='str'>&#39; &#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>f</span><span class='op'>.</span><span class='nam'>close</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>int</span><span class='op'>(</span><span class='nam'>l</span><span class='op'>[</span><span class='num'>13</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>except</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>int</span><span class='op'>(</span><span class='num'>100</span><span class='op'>*</span><span class='op'>(</span><span class='nam'>time</span><span class='op'>.</span><span class='nam'>time</span><span class='op'>(</span><span class='op'>)</span><span class='op'>-</span><span class='nam'>_load_time</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>memusage</span><span class='op'>(</span><span class='nam'>_proc_pid_stat</span> <span class='op'>=</span> <span class='str'>&#39;/proc/%s/stat&#39;</span><span class='op'>%</span><span class='op'>(</span><span class='nam'>os</span><span class='op'>.</span><span class='nam'>getpid</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Return virtual memory size in bytes of the running python.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>f</span><span class='op'>=</span><span class='nam'>open</span><span class='op'>(</span><span class='nam'>_proc_pid_stat</span><span class='op'>,</span><span class='str'>&#39;r&#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>l</span> <span class='op'>=</span> <span class='nam'>f</span><span class='op'>.</span><span class='nam'>readline</span><span class='op'>(</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>split</span><span class='op'>(</span><span class='str'>&#39; &#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>f</span><span class='op'>.</span><span class='nam'>close</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>int</span><span class='op'>(</span><span class='nam'>l</span><span class='op'>[</span><span class='num'>22</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>except</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='com'># os.getpid is not in all platforms available.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='com'># Using time is safe but inaccurate, especially when process</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='com'># was suspended or sleeping.</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>jiffies</span><span class='op'>(</span><span class='nam'>_load_time</span><span class='op'>=</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Return number of jiffies (1/100ths of a second) that this</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; process has been scheduled in user mode. [Emulation with time.time]. &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>import</span> <span class='nam'>time</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>_load_time</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>_load_time</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>time</span><span class='op'>.</span><span class='nam'>time</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>int</span><span class='op'>(</span><span class='num'>100</span><span class='op'>*</span><span class='op'>(</span><span class='nam'>time</span><span class='op'>.</span><span class='nam'>time</span><span class='op'>(</span><span class='op'>)</span><span class='op'>-</span><span class='nam'>_load_time</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>memusage</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Return memory usage of running python. [Not implemented]&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>NotImplementedError</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>if</span> <span class='nam'>os</span><span class='op'>.</span><span class='nam'>name</span><span class='op'>==</span><span class='str'>&#39;nt&#39;</span> <span class='key'>and</span> <span class='nam'>sys</span><span class='op'>.</span><span class='nam'>version</span><span class='op'>[</span><span class='op'>:</span><span class='num'>3</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='str'>&#39;2.3&#39;</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='com'># Code &quot;stolen&quot; from enthought/debug/memusage.py</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>GetPerformanceAttributes</span><span class='op'>(</span><span class='nam'>object</span><span class='op'>,</span> <span class='nam'>counter</span><span class='op'>,</span> <span class='nam'>instance</span> <span class='op'>=</span> <span class='nam'>None</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='nam'>inum</span><span class='op'>=</span><span class='op'>-</span><span class='num'>1</span><span class='op'>,</span> <span class='nam'>format</span> <span class='op'>=</span> <span class='nam'>None</span><span class='op'>,</span> <span class='nam'>machine</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># NOTE: Many counters require 2 samples to give accurate results,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># including &quot;% Processor Time&quot; (as by definition, at any instant, a</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># thread&#39;s CPU usage is either 0 or 100).&nbsp; To read counters like this,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># you should copy this function, but keep the counter open, and call</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># CollectQueryData() each time you need to know.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># See http://msdn.microsoft.com/library/en-us/dnperfmo/html/perfmonpt2.asp</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># My older explanation for this was that the &quot;AddCounter&quot; process forced</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># the CPU to 100%, but the above makes more sense :)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>import</span> <span class='nam'>win32pdh</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>format</span> <span class='key'>is</span> <span class='nam'>None</span><span class='op'>:</span> <span class='nam'>format</span> <span class='op'>=</span> <span class='nam'>win32pdh</span><span class='op'>.</span><span class='nam'>PDH_FMT_LONG</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>path</span> <span class='op'>=</span> <span class='nam'>win32pdh</span><span class='op'>.</span><span class='nam'>MakeCounterPath</span><span class='op'>(</span> <span class='op'>(</span><span class='nam'>machine</span><span class='op'>,</span><span class='nam'>object</span><span class='op'>,</span><span class='nam'>instance</span><span class='op'>,</span> <span class='nam'>None</span><span class='op'>,</span> <span class='nam'>inum</span><span class='op'>,</span><span class='nam'>counter</span><span class='op'>)</span> <span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>hq</span> <span class='op'>=</span> <span class='nam'>win32pdh</span><span class='op'>.</span><span class='nam'>OpenQuery</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>hc</span> <span class='op'>=</span> <span class='nam'>win32pdh</span><span class='op'>.</span><span class='nam'>AddCounter</span><span class='op'>(</span><span class='nam'>hq</span><span class='op'>,</span> <span class='nam'>path</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>win32pdh</span><span class='op'>.</span><span class='nam'>CollectQueryData</span><span class='op'>(</span><span class='nam'>hq</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>type</span><span class='op'>,</span> <span class='nam'>val</span> <span class='op'>=</span> <span class='nam'>win32pdh</span><span class='op'>.</span><span class='nam'>GetFormattedCounterValue</span><span class='op'>(</span><span class='nam'>hc</span><span class='op'>,</span> <span class='nam'>format</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>val</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>finally</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>win32pdh</span><span class='op'>.</span><span class='nam'>RemoveCounter</span><span class='op'>(</span><span class='nam'>hc</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>finally</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>win32pdh</span><span class='op'>.</span><span class='nam'>CloseQuery</span><span class='op'>(</span><span class='nam'>hq</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>memusage</span><span class='op'>(</span><span class='nam'>processName</span><span class='op'>=</span><span class='str'>&quot;python&quot;</span><span class='op'>,</span> <span class='nam'>instance</span><span class='op'>=</span><span class='num'>0</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># from win32pdhutil, part of the win32all package</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>import</span> <span class='nam'>win32pdh</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>GetPerformanceAttributes</span><span class='op'>(</span><span class='str'>&quot;Process&quot;</span><span class='op'>,</span> <span class='str'>&quot;Virtual Bytes&quot;</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>processName</span><span class='op'>,</span> <span class='nam'>instance</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>win32pdh</span><span class='op'>.</span><span class='nam'>PDH_FMT_LONG</span><span class='op'>,</span> <span class='nam'>None</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>build_err_msg</span><span class='op'>(</span><span class='nam'>arrays</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>,</span> <span class='nam'>header</span><span class='op'>=</span><span class='str'>&#39;Items are not equal:&#39;</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>True</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>names</span><span class='op'>=</span><span class='op'>(</span><span class='str'>&#39;ACTUAL&#39;</span><span class='op'>,</span> <span class='str'>&#39;DESIRED&#39;</span><span class='op'>)</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='op'>[</span><span class='str'>&#39;\n&#39;</span> <span class='op'>+</span> <span class='nam'>header</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>err_msg</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>err_msg</span><span class='op'>.</span><span class='nam'>find</span><span class='op'>(</span><span class='str'>&#39;\n&#39;</span><span class='op'>)</span> <span class='op'>==</span> <span class='op'>-</span><span class='num'>1</span> <span class='key'>and</span> <span class='nam'>len</span><span class='op'>(</span><span class='nam'>err_msg</span><span class='op'>)</span> <span class='op'>&lt;</span> <span class='num'>79</span><span class='op'>-</span><span class='nam'>len</span><span class='op'>(</span><span class='nam'>header</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='op'>[</span><span class='nam'>msg</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span> <span class='op'>+</span> <span class='str'>&#39; &#39;</span> <span class='op'>+</span> <span class='nam'>err_msg</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>err_msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>verbose</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>i</span><span class='op'>,</span> <span class='nam'>a</span> <span class='key'>in</span> <span class='nam'>enumerate</span><span class='op'>(</span><span class='nam'>arrays</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>r</span> <span class='op'>=</span> <span class='nam'>repr</span><span class='op'>(</span><span class='nam'>a</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>except</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>r</span> <span class='op'>=</span> <span class='str'>&#39;[repr failed]&#39;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>r</span><span class='op'>.</span><span class='nam'>count</span><span class='op'>(</span><span class='str'>&#39;\n&#39;</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='num'>3</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>r</span> <span class='op'>=</span> <span class='str'>&#39;\n&#39;</span><span class='op'>.</span><span class='nam'>join</span><span class='op'>(</span><span class='nam'>r</span><span class='op'>.</span><span class='nam'>splitlines</span><span class='op'>(</span><span class='op'>)</span><span class='op'>[</span><span class='op'>:</span><span class='num'>3</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>r</span> <span class='op'>+=</span> <span class='str'>&#39;...&#39;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='str'>&#39; %s: %s&#39;</span> <span class='op'>%</span> <span class='op'>(</span><span class='nam'>names</span><span class='op'>[</span><span class='nam'>i</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>r</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span> <span class='str'>&#39;\n&#39;</span><span class='op'>.</span><span class='nam'>join</span><span class='op'>(</span><span class='nam'>msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>assert_equal</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>,</span><span class='nam'>desired</span><span class='op'>,</span><span class='nam'>err_msg</span><span class='op'>=</span><span class='str'>&#39;&#39;</span><span class='op'>,</span><span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>True</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; Raise an assertion if two objects are not equal.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; Given two objects (lists, tuples, dictionaries or numpy arrays), check</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; that all elements of these objects are equal. An exception is raised at</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; the first conflicting values.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; Parameters</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; ----------</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; actual : list, tuple, dict or ndarray</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; The object to check.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; desired : list, tuple, dict or ndarray</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; The expected object.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; err_msg : string</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; The error message to be printed in case of failure.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; verbose : bool</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; If True, the conflicting values are appended to the error message.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; Raises</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; ------</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; AssertionError</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; If actual and desired are not equal.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; Examples</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; --------</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; np.testing.assert_equal([4,5], [4,6]) # doctest:+ELLIPSIS</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; ...</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &lt;type &#39;exceptions.AssertionError&#39;&gt;:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; Items are not equal:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; item=1</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &lt;BLANKLINE&gt;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp;&nbsp; ACTUAL: 5</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp;&nbsp; DESIRED: 6</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>desired</span><span class='op'>,</span> <span class='nam'>dict</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>,</span> <span class='nam'>dict</span><span class='op'>)</span> <span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>AssertionError</span><span class='op'>(</span><span class='nam'>repr</span><span class='op'>(</span><span class='nam'>type</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>assert_equal</span><span class='op'>(</span><span class='nam'>len</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>)</span><span class='op'>,</span><span class='nam'>len</span><span class='op'>(</span><span class='nam'>desired</span><span class='op'>)</span><span class='op'>,</span><span class='nam'>err_msg</span><span class='op'>,</span><span class='nam'>verbose</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>k</span><span class='op'>,</span><span class='nam'>i</span> <span class='key'>in</span> <span class='nam'>desired</span><span class='op'>.</span><span class='nam'>items</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>k</span> <span class='key'>not</span> <span class='key'>in</span> <span class='nam'>actual</span> <span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>AssertionError</span><span class='op'>(</span><span class='nam'>repr</span><span class='op'>(</span><span class='nam'>k</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>assert_equal</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>[</span><span class='nam'>k</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>desired</span><span class='op'>[</span><span class='nam'>k</span><span class='op'>]</span><span class='op'>,</span> <span class='str'>&#39;key=%r\n%s&#39;</span> <span class='op'>%</span> <span class='op'>(</span><span class='nam'>k</span><span class='op'>,</span><span class='nam'>err_msg</span><span class='op'>)</span><span class='op'>,</span> <span class='nam'>verbose</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>desired</span><span class='op'>,</span> <span class='op'>(</span><span class='nam'>list</span><span class='op'>,</span><span class='nam'>tuple</span><span class='op'>)</span><span class='op'>)</span> <span class='key'>and</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>,</span> <span class='op'>(</span><span class='nam'>list</span><span class='op'>,</span><span class='nam'>tuple</span><span class='op'>)</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>assert_equal</span><span class='op'>(</span><span class='nam'>len</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>)</span><span class='op'>,</span><span class='nam'>len</span><span class='op'>(</span><span class='nam'>desired</span><span class='op'>)</span><span class='op'>,</span><span class='nam'>err_msg</span><span class='op'>,</span><span class='nam'>verbose</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>k</span> <span class='key'>in</span> <span class='nam'>range</span><span class='op'>(</span><span class='nam'>len</span><span class='op'>(</span><span class='nam'>desired</span><span class='op'>)</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>assert_equal</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>[</span><span class='nam'>k</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>desired</span><span class='op'>[</span><span class='nam'>k</span><span class='op'>]</span><span class='op'>,</span> <span class='str'>&#39;item=%r\n%s&#39;</span> <span class='op'>%</span> <span class='op'>(</span><span class='nam'>k</span><span class='op'>,</span><span class='nam'>err_msg</span><span class='op'>)</span><span class='op'>,</span> <span class='nam'>verbose</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>from</span> <span class='nam'>numpy</span><span class='op'>.</span><span class='nam'>core</span> <span class='key'>import</span> <span class='nam'>ndarray</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>,</span> <span class='nam'>ndarray</span><span class='op'>)</span> <span class='key'>or</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>desired</span><span class='op'>,</span> <span class='nam'>ndarray</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>assert_array_equal</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>,</span> <span class='nam'>desired</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>,</span> <span class='nam'>verbose</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='nam'>build_err_msg</span><span class='op'>(</span><span class='op'>[</span><span class='nam'>actual</span><span class='op'>,</span> <span class='nam'>desired</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>,</span> <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>verbose</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>desired</span> <span class='op'>!=</span> <span class='nam'>actual</span> <span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>AssertionError</span><span class='op'>(</span><span class='nam'>msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>print_assert_equal</span><span class='op'>(</span><span class='nam'>test_string</span><span class='op'>,</span><span class='nam'>actual</span><span class='op'>,</span><span class='nam'>desired</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>import</span> <span class='nam'>pprint</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span><span class='op'>(</span><span class='nam'>actual</span> <span class='op'>==</span> <span class='nam'>desired</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>except</span> <span class='nam'>AssertionError</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>import</span> <span class='nam'>cStringIO</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='nam'>cStringIO</span><span class='op'>.</span><span class='nam'>StringIO</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span><span class='op'>.</span><span class='nam'>write</span><span class='op'>(</span><span class='nam'>test_string</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span><span class='op'>.</span><span class='nam'>write</span><span class='op'>(</span><span class='str'>&#39; failed\nACTUAL: \n&#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>pprint</span><span class='op'>.</span><span class='nam'>pprint</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>,</span><span class='nam'>msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span><span class='op'>.</span><span class='nam'>write</span><span class='op'>(</span><span class='str'>&#39;DESIRED: \n&#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>pprint</span><span class='op'>.</span><span class='nam'>pprint</span><span class='op'>(</span><span class='nam'>desired</span><span class='op'>,</span><span class='nam'>msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>AssertionError</span><span class='op'>(</span><span class='nam'>msg</span><span class='op'>.</span><span class='nam'>getvalue</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>assert_almost_equal</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>,</span><span class='nam'>desired</span><span class='op'>,</span><span class='nam'>decimal</span><span class='op'>=</span><span class='num'>7</span><span class='op'>,</span><span class='nam'>err_msg</span><span class='op'>=</span><span class='str'>&#39;&#39;</span><span class='op'>,</span><span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>True</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Raise an assertion if two items are not equal.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; I think this should be part of unittest.py</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; The test is equivalent to abs(desired-actual) &lt; 0.5 * 10**(-decimal)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>from</span> <span class='nam'>numpy</span><span class='op'>.</span><span class='nam'>core</span> <span class='key'>import</span> <span class='nam'>ndarray</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>,</span> <span class='nam'>ndarray</span><span class='op'>)</span> <span class='key'>or</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>desired</span><span class='op'>,</span> <span class='nam'>ndarray</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>assert_array_almost_equal</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>,</span> <span class='nam'>desired</span><span class='op'>,</span> <span class='nam'>decimal</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='nam'>build_err_msg</span><span class='op'>(</span><span class='op'>[</span><span class='nam'>actual</span><span class='op'>,</span> <span class='nam'>desired</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>,</span> <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>verbose</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>round</span><span class='op'>(</span><span class='nam'>abs</span><span class='op'>(</span><span class='nam'>desired</span> <span class='op'>-</span> <span class='nam'>actual</span><span class='op'>)</span><span class='op'>,</span><span class='nam'>decimal</span><span class='op'>)</span> <span class='op'>!=</span> <span class='num'>0</span> <span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>AssertionError</span><span class='op'>(</span><span class='nam'>msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>assert_approx_equal</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>,</span><span class='nam'>desired</span><span class='op'>,</span><span class='nam'>significant</span><span class='op'>=</span><span class='num'>7</span><span class='op'>,</span><span class='nam'>err_msg</span><span class='op'>=</span><span class='str'>&#39;&#39;</span><span class='op'>,</span><span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>True</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Raise an assertion if two items are not</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; equal.&nbsp; I think this should be part of unittest.py</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Approximately equal is defined as the number of significant digits</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; correct</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>import</span> <span class='nam'>math</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>actual</span><span class='op'>,</span> <span class='nam'>desired</span> <span class='op'>=</span> <span class='nam'>map</span><span class='op'>(</span><span class='nam'>float</span><span class='op'>,</span> <span class='op'>(</span><span class='nam'>actual</span><span class='op'>,</span> <span class='nam'>desired</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>desired</span><span class='op'>==</span><span class='nam'>actual</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='com'># Normalized the numbers to be in range (-10.0,10.0)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>scale</span> <span class='op'>=</span> <span class='nam'>float</span><span class='op'>(</span><span class='nam'>pow</span><span class='op'>(</span><span class='num'>10</span><span class='op'>,</span><span class='nam'>math</span><span class='op'>.</span><span class='nam'>floor</span><span class='op'>(</span><span class='nam'>math</span><span class='op'>.</span><span class='nam'>log10</span><span class='op'>(</span><span class='num'>0.5</span><span class='op'>*</span><span class='op'>(</span><span class='nam'>abs</span><span class='op'>(</span><span class='nam'>desired</span><span class='op'>)</span><span class='op'>+</span><span class='nam'>abs</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>sc_desired</span> <span class='op'>=</span> <span class='nam'>desired</span><span class='op'>/</span><span class='nam'>scale</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>except</span> <span class='nam'>ZeroDivisionError</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>sc_desired</span> <span class='op'>=</span> <span class='num'>0.0</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>sc_actual</span> <span class='op'>=</span> <span class='nam'>actual</span><span class='op'>/</span><span class='nam'>scale</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>except</span> <span class='nam'>ZeroDivisionError</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>sc_actual</span> <span class='op'>=</span> <span class='num'>0.0</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='nam'>build_err_msg</span><span class='op'>(</span><span class='op'>[</span><span class='nam'>actual</span><span class='op'>,</span> <span class='nam'>desired</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>header</span><span class='op'>=</span><span class='str'>&#39;Items are not equal to %d significant digits:&#39;</span> <span class='op'>%</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='nam'>significant</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>verbose</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>math</span><span class='op'>.</span><span class='nam'>fabs</span><span class='op'>(</span><span class='nam'>sc_desired</span> <span class='op'>-</span> <span class='nam'>sc_actual</span><span class='op'>)</span> <span class='op'>&gt;=</span> <span class='nam'>pow</span><span class='op'>(</span><span class='num'>10.</span><span class='op'>,</span><span class='op'>-</span><span class='op'>(</span><span class='nam'>significant</span><span class='op'>-</span><span class='num'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>AssertionError</span><span class='op'>(</span><span class='nam'>msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>assert_array_compare</span><span class='op'>(</span><span class='nam'>comparison</span><span class='op'>,</span> <span class='nam'>x</span><span class='op'>,</span> <span class='nam'>y</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>=</span><span class='str'>&#39;&#39;</span><span class='op'>,</span> <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>True</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='nam'>header</span><span class='op'>=</span><span class='str'>&#39;&#39;</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>from</span> <span class='nam'>numpy</span><span class='op'>.</span><span class='nam'>core</span> <span class='key'>import</span> <span class='nam'>asarray</span><span class='op'>,</span> <span class='nam'>isnan</span><span class='op'>,</span> <span class='nam'>any</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>from</span> <span class='nam'>numpy</span> <span class='key'>import</span> <span class='nam'>isreal</span><span class='op'>,</span> <span class='nam'>iscomplex</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>x</span> <span class='op'>=</span> <span class='nam'>asarray</span><span class='op'>(</span><span class='nam'>x</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>y</span> <span class='op'>=</span> <span class='nam'>asarray</span><span class='op'>(</span><span class='nam'>y</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>isnumber</span><span class='op'>(</span><span class='nam'>x</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>x</span><span class='op'>.</span><span class='nam'>dtype</span><span class='op'>.</span><span class='nam'>char</span> <span class='key'>in</span> <span class='str'>&#39;?bhilqpBHILQPfdgFDG&#39;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>cond</span> <span class='op'>=</span> <span class='op'>(</span><span class='nam'>x</span><span class='op'>.</span><span class='nam'>shape</span><span class='op'>==</span><span class='op'>(</span><span class='op'>)</span> <span class='key'>or</span> <span class='nam'>y</span><span class='op'>.</span><span class='nam'>shape</span><span class='op'>==</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='key'>or</span> <span class='nam'>x</span><span class='op'>.</span><span class='nam'>shape</span> <span class='op'>==</span> <span class='nam'>y</span><span class='op'>.</span><span class='nam'>shape</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>cond</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='nam'>build_err_msg</span><span class='op'>(</span><span class='op'>[</span><span class='nam'>x</span><span class='op'>,</span> <span class='nam'>y</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>err_msg</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>+</span> <span class='str'>&#39;\n(shapes %s, %s mismatch)&#39;</span> <span class='op'>%</span> <span class='op'>(</span><span class='nam'>x</span><span class='op'>.</span><span class='nam'>shape</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>y</span><span class='op'>.</span><span class='nam'>shape</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>verbose</span><span class='op'>,</span> <span class='nam'>header</span><span class='op'>=</span><span class='nam'>header</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>names</span><span class='op'>=</span><span class='op'>(</span><span class='str'>&#39;x&#39;</span><span class='op'>,</span> <span class='str'>&#39;y&#39;</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>cond</span> <span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>AssertionError</span><span class='op'>(</span><span class='nam'>msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='op'>(</span><span class='nam'>isnumber</span><span class='op'>(</span><span class='nam'>x</span><span class='op'>)</span> <span class='key'>and</span> <span class='nam'>isnumber</span><span class='op'>(</span><span class='nam'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='key'>and</span> <span class='op'>(</span><span class='nam'>any</span><span class='op'>(</span><span class='nam'>isnan</span><span class='op'>(</span><span class='nam'>x</span><span class='op'>)</span><span class='op'>)</span> <span class='key'>or</span> <span class='nam'>any</span><span class='op'>(</span><span class='nam'>isnan</span><span class='op'>(</span><span class='nam'>y</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># Handling nan: we first check that x and y have the nan at the</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># same locations, and then we mask the nan and do the comparison as</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># usual.</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>xnanid</span> <span class='op'>=</span> <span class='nam'>isnan</span><span class='op'>(</span><span class='nam'>x</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>ynanid</span> <span class='op'>=</span> <span class='nam'>isnan</span><span class='op'>(</span><span class='nam'>y</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>assert_array_equal</span><span class='op'>(</span><span class='nam'>xnanid</span><span class='op'>,</span> <span class='nam'>ynanid</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>except</span> <span class='nam'>AssertionError</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='nam'>build_err_msg</span><span class='op'>(</span><span class='op'>[</span><span class='nam'>x</span><span class='op'>,</span> <span class='nam'>y</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>err_msg</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>+</span> <span class='str'>&#39;\n(x and y nan location mismatch %s, &#39;</span> <span class='xx'>\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;%s mismatch)&#39;</span> <span class='op'>%</span> <span class='op'>(</span><span class='nam'>xnanid</span><span class='op'>,</span> <span class='nam'>ynanid</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>verbose</span><span class='op'>,</span> <span class='nam'>header</span><span class='op'>=</span><span class='nam'>header</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>names</span><span class='op'>=</span><span class='op'>(</span><span class='str'>&#39;x&#39;</span><span class='op'>,</span> <span class='str'>&#39;y&#39;</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>val</span> <span class='op'>=</span> <span class='nam'>comparison</span><span class='op'>(</span><span class='nam'>x</span><span class='op'>[</span><span class='op'>~</span><span class='nam'>xnanid</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>y</span><span class='op'>[</span><span class='op'>~</span><span class='nam'>ynanid</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>val</span> <span class='op'>=</span> <span class='nam'>comparison</span><span class='op'>(</span><span class='nam'>x</span><span class='op'>,</span><span class='nam'>y</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>val</span><span class='op'>,</span> <span class='nam'>bool</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>cond</span> <span class='op'>=</span> <span class='nam'>val</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>reduced</span> <span class='op'>=</span> <span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>reduced</span> <span class='op'>=</span> <span class='nam'>val</span><span class='op'>.</span><span class='nam'>ravel</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>cond</span> <span class='op'>=</span> <span class='nam'>reduced</span><span class='op'>.</span><span class='nam'>all</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>reduced</span> <span class='op'>=</span> <span class='nam'>reduced</span><span class='op'>.</span><span class='nam'>tolist</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>cond</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>match</span> <span class='op'>=</span> <span class='num'>100</span><span class='op'>-</span><span class='num'>100.0</span><span class='op'>*</span><span class='nam'>reduced</span><span class='op'>.</span><span class='nam'>count</span><span class='op'>(</span><span class='num'>1</span><span class='op'>)</span><span class='op'>/</span><span class='nam'>len</span><span class='op'>(</span><span class='nam'>reduced</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='nam'>build_err_msg</span><span class='op'>(</span><span class='op'>[</span><span class='nam'>x</span><span class='op'>,</span> <span class='nam'>y</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>err_msg</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>+</span> <span class='str'>&#39;\n(mismatch %s%%)&#39;</span> <span class='op'>%</span> <span class='op'>(</span><span class='nam'>match</span><span class='op'>,</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>verbose</span><span class='op'>,</span> <span class='nam'>header</span><span class='op'>=</span><span class='nam'>header</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>names</span><span class='op'>=</span><span class='op'>(</span><span class='str'>&#39;x&#39;</span><span class='op'>,</span> <span class='str'>&#39;y&#39;</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>cond</span> <span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>AssertionError</span><span class='op'>(</span><span class='nam'>msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>except</span> <span class='nam'>ValueError</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='nam'>build_err_msg</span><span class='op'>(</span><span class='op'>[</span><span class='nam'>x</span><span class='op'>,</span> <span class='nam'>y</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>,</span> <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>verbose</span><span class='op'>,</span> <span class='nam'>header</span><span class='op'>=</span><span class='nam'>header</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>names</span><span class='op'>=</span><span class='op'>(</span><span class='str'>&#39;x&#39;</span><span class='op'>,</span> <span class='str'>&#39;y&#39;</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>ValueError</span><span class='op'>(</span><span class='nam'>msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>assert_array_equal</span><span class='op'>(</span><span class='nam'>x</span><span class='op'>,</span> <span class='nam'>y</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>=</span><span class='str'>&#39;&#39;</span><span class='op'>,</span> <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>True</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>assert_array_compare</span><span class='op'>(</span><span class='nam'>operator</span><span class='op'>.</span><span class='nam'>__eq__</span><span class='op'>,</span> <span class='nam'>x</span><span class='op'>,</span> <span class='nam'>y</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>=</span><span class='nam'>err_msg</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>verbose</span><span class='op'>,</span> <span class='nam'>header</span><span class='op'>=</span><span class='str'>&#39;Arrays are not equal&#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>assert_array_almost_equal</span><span class='op'>(</span><span class='nam'>x</span><span class='op'>,</span> <span class='nam'>y</span><span class='op'>,</span> <span class='nam'>decimal</span><span class='op'>=</span><span class='num'>6</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>=</span><span class='str'>&#39;&#39;</span><span class='op'>,</span> <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>True</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>from</span> <span class='nam'>numpy</span><span class='op'>.</span><span class='nam'>core</span> <span class='key'>import</span> <span class='nam'>around</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>compare</span><span class='op'>(</span><span class='nam'>x</span><span class='op'>,</span> <span class='nam'>y</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>around</span><span class='op'>(</span><span class='nam'>abs</span><span class='op'>(</span><span class='nam'>x</span><span class='op'>-</span><span class='nam'>y</span><span class='op'>)</span><span class='op'>,</span><span class='nam'>decimal</span><span class='op'>)</span> <span class='op'>&lt;=</span> <span class='num'>10.0</span><span class='op'>**</span><span class='op'>(</span><span class='op'>-</span><span class='nam'>decimal</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>assert_array_compare</span><span class='op'>(</span><span class='nam'>compare</span><span class='op'>,</span> <span class='nam'>x</span><span class='op'>,</span> <span class='nam'>y</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>=</span><span class='nam'>err_msg</span><span class='op'>,</span> <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>verbose</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='nam'>header</span><span class='op'>=</span><span class='str'>&#39;Arrays are not almost equal&#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>assert_array_less</span><span class='op'>(</span><span class='nam'>x</span><span class='op'>,</span> <span class='nam'>y</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>=</span><span class='str'>&#39;&#39;</span><span class='op'>,</span> <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>True</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>assert_array_compare</span><span class='op'>(</span><span class='nam'>operator</span><span class='op'>.</span><span class='nam'>__lt__</span><span class='op'>,</span> <span class='nam'>x</span><span class='op'>,</span> <span class='nam'>y</span><span class='op'>,</span> <span class='nam'>err_msg</span><span class='op'>=</span><span class='nam'>err_msg</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>verbose</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='nam'>header</span><span class='op'>=</span><span class='str'>&#39;Arrays are not less-ordered&#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>runstring</span><span class='op'>(</span><span class='nam'>astr</span><span class='op'>,</span> <span class='nam'>dict</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>exec</span> <span class='nam'>astr</span> <span class='key'>in</span> <span class='nam'>dict</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>assert_string_equal</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>,</span> <span class='nam'>desired</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='com'># delay import of difflib to reduce startup time</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>import</span> <span class='nam'>difflib</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>,</span> <span class='nam'>str</span><span class='op'>)</span> <span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>AssertionError</span><span class='op'>(</span><span class='op'>`</span><span class='nam'>type</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>)</span><span class='op'>`</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>desired</span><span class='op'>,</span> <span class='nam'>str</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>AssertionError</span><span class='op'>(</span><span class='op'>`</span><span class='nam'>type</span><span class='op'>(</span><span class='nam'>desired</span><span class='op'>)</span><span class='op'>`</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>re</span><span class='op'>.</span><span class='nam'>match</span><span class='op'>(</span><span class='str'>r&#39;\A&#39;</span><span class='op'>+</span><span class='nam'>desired</span><span class='op'>+</span><span class='str'>r&#39;\Z&#39;</span><span class='op'>,</span> <span class='nam'>actual</span><span class='op'>,</span> <span class='nam'>re</span><span class='op'>.</span><span class='nam'>M</span><span class='op'>)</span><span class='op'>:</span> <span class='key'>return</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>diff</span> <span class='op'>=</span> <span class='nam'>list</span><span class='op'>(</span><span class='nam'>difflib</span><span class='op'>.</span><span class='nam'>Differ</span><span class='op'>(</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>compare</span><span class='op'>(</span><span class='nam'>actual</span><span class='op'>.</span><span class='nam'>splitlines</span><span class='op'>(</span><span class='num'>1</span><span class='op'>)</span><span class='op'>,</span> <span class='nam'>desired</span><span class='op'>.</span><span class='nam'>splitlines</span><span class='op'>(</span><span class='num'>1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>diff_list</span> <span class='op'>=</span> <span class='op'>[</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>while</span> <span class='nam'>diff</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>d1</span> <span class='op'>=</span> <span class='nam'>diff</span><span class='op'>.</span><span class='nam'>pop</span><span class='op'>(</span><span class='num'>0</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>d1</span><span class='op'>.</span><span class='nam'>startswith</span><span class='op'>(</span><span class='str'>&#39;&nbsp; &#39;</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>continue</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>d1</span><span class='op'>.</span><span class='nam'>startswith</span><span class='op'>(</span><span class='str'>&#39;- &#39;</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>l</span> <span class='op'>=</span> <span class='op'>[</span><span class='nam'>d1</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>d2</span> <span class='op'>=</span> <span class='nam'>diff</span><span class='op'>.</span><span class='nam'>pop</span><span class='op'>(</span><span class='num'>0</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>d2</span><span class='op'>.</span><span class='nam'>startswith</span><span class='op'>(</span><span class='str'>&#39;? &#39;</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>l</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>d2</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>d2</span> <span class='op'>=</span> <span class='nam'>diff</span><span class='op'>.</span><span class='nam'>pop</span><span class='op'>(</span><span class='num'>0</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>d2</span><span class='op'>.</span><span class='nam'>startswith</span><span class='op'>(</span><span class='str'>&#39;+ &#39;</span><span class='op'>)</span> <span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>AssertionError</span><span class='op'>(</span><span class='op'>`</span><span class='nam'>d2</span><span class='op'>`</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>l</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>d2</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>d3</span> <span class='op'>=</span> <span class='nam'>diff</span><span class='op'>.</span><span class='nam'>pop</span><span class='op'>(</span><span class='num'>0</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>d3</span><span class='op'>.</span><span class='nam'>startswith</span><span class='op'>(</span><span class='str'>&#39;? &#39;</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>l</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>d3</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>diff</span><span class='op'>.</span><span class='nam'>insert</span><span class='op'>(</span><span class='num'>0</span><span class='op'>,</span> <span class='nam'>d3</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>re</span><span class='op'>.</span><span class='nam'>match</span><span class='op'>(</span><span class='str'>r&#39;\A&#39;</span><span class='op'>+</span><span class='nam'>d2</span><span class='op'>[</span><span class='num'>2</span><span class='op'>:</span><span class='op'>]</span><span class='op'>+</span><span class='str'>r&#39;\Z&#39;</span><span class='op'>,</span> <span class='nam'>d1</span><span class='op'>[</span><span class='num'>2</span><span class='op'>:</span><span class='op'>]</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>continue</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>diff_list</span><span class='op'>.</span><span class='nam'>extend</span><span class='op'>(</span><span class='nam'>l</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>continue</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>AssertionError</span><span class='op'>(</span><span class='op'>`</span><span class='nam'>d1</span><span class='op'>`</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>diff_list</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='str'>&#39;Differences in strings:\n%s&#39;</span> <span class='op'>%</span> <span class='op'>(</span><span class='str'>&#39;&#39;</span><span class='op'>.</span><span class='nam'>join</span><span class='op'>(</span><span class='nam'>diff_list</span><span class='op'>)</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>rstrip</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>actual</span> <span class='op'>!=</span> <span class='nam'>desired</span> <span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>AssertionError</span><span class='op'>(</span><span class='nam'>msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>rundocs</span><span class='op'>(</span><span class='nam'>filename</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Run doc string tests found in filename.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>import</span> <span class='nam'>doctest</span><span class='op'>,</span> <span class='nam'>imp</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>filename</span> <span class='key'>is</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>f</span> <span class='op'>=</span> <span class='nam'>sys</span><span class='op'>.</span><span class='nam'>_getframe</span><span class='op'>(</span><span class='num'>1</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>filename</span> <span class='op'>=</span> <span class='nam'>f</span><span class='op'>.</span><span class='nam'>f_globals</span><span class='op'>[</span><span class='str'>&#39;__file__&#39;</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>name</span> <span class='op'>=</span> <span class='nam'>os</span><span class='op'>.</span><span class='nam'>path</span><span class='op'>.</span><span class='nam'>splitext</span><span class='op'>(</span><span class='nam'>os</span><span class='op'>.</span><span class='nam'>path</span><span class='op'>.</span><span class='nam'>basename</span><span class='op'>(</span><span class='nam'>filename</span><span class='op'>)</span><span class='op'>)</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>path</span> <span class='op'>=</span> <span class='op'>[</span><span class='nam'>os</span><span class='op'>.</span><span class='nam'>path</span><span class='op'>.</span><span class='nam'>dirname</span><span class='op'>(</span><span class='nam'>filename</span><span class='op'>)</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>file</span><span class='op'>,</span> <span class='nam'>pathname</span><span class='op'>,</span> <span class='nam'>description</span> <span class='op'>=</span> <span class='nam'>imp</span><span class='op'>.</span><span class='nam'>find_module</span><span class='op'>(</span><span class='nam'>name</span><span class='op'>,</span> <span class='nam'>path</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>m</span> <span class='op'>=</span> <span class='nam'>imp</span><span class='op'>.</span><span class='nam'>load_module</span><span class='op'>(</span><span class='nam'>name</span><span class='op'>,</span> <span class='nam'>file</span><span class='op'>,</span> <span class='nam'>pathname</span><span class='op'>,</span> <span class='nam'>description</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>finally</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>file</span><span class='op'>.</span><span class='nam'>close</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>sys</span><span class='op'>.</span><span class='nam'>version</span><span class='op'>[</span><span class='op'>:</span><span class='num'>3</span><span class='op'>]</span><span class='op'>&lt;</span><span class='str'>&#39;2.4&#39;</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>doctest</span><span class='op'>.</span><span class='nam'>testmod</span><span class='op'>(</span><span class='nam'>m</span><span class='op'>,</span> <span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>False</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>tests</span> <span class='op'>=</span> <span class='nam'>doctest</span><span class='op'>.</span><span class='nam'>DocTestFinder</span><span class='op'>(</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>find</span><span class='op'>(</span><span class='nam'>m</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>runner</span> <span class='op'>=</span> <span class='nam'>doctest</span><span class='op'>.</span><span class='nam'>DocTestRunner</span><span class='op'>(</span><span class='nam'>verbose</span><span class='op'>=</span><span class='nam'>False</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>test</span> <span class='key'>in</span> <span class='nam'>tests</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>runner</span><span class='op'>.</span><span class='nam'>run</span><span class='op'>(</span><span class='nam'>test</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>raises</span><span class='op'>(</span><span class='op'>*</span><span class='nam'>args</span><span class='op'>,</span><span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>nose</span> <span class='op'>=</span> <span class='nam'>import_nose</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>nose</span><span class='op'>.</span><span class='nam'>tools</span><span class='op'>.</span><span class='nam'>raises</span><span class='op'>(</span><span class='op'>*</span><span class='nam'>args</span><span class='op'>,</span><span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>assert_raises</span><span class='op'>(</span><span class='op'>*</span><span class='nam'>args</span><span class='op'>,</span><span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>nose</span> <span class='op'>=</span> <span class='nam'>import_nose</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>nose</span><span class='op'>.</span><span class='nam'>tools</span><span class='op'>.</span><span class='nam'>assert_raises</span><span class='op'>(</span><span class='op'>*</span><span class='nam'>args</span><span class='op'>,</span><span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>decorate_methods</span><span class='op'>(</span><span class='nam'>cls</span><span class='op'>,</span> <span class='nam'>decorator</span><span class='op'>,</span> <span class='nam'>testmatch</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&#39;&#39;&#39; Apply decorator to all methods in class matching testmatch</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; Parameters</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; ----------</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; cls : class</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Class to decorate methods for</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; decorator : function</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Decorator to apply to methods</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; testmatch : compiled regexp or string to compile to regexp</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Decorators are applied if testmatch.search(methodname)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; is not None.&nbsp; Default value is</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; re.compile(r&#39;(?:^|[\\b_\\.%s-])[Tt]est&#39; % os.sep)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; (the default for nose)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &#39;&#39;&#39;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>testmatch</span> <span class='key'>is</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>testmatch</span> <span class='op'>=</span> <span class='nam'>re</span><span class='op'>.</span><span class='nam'>compile</span><span class='op'>(</span><span class='str'>r&#39;(?:^|[\\b_\\.%s-])[Tt]est&#39;</span> <span class='op'>%</span> <span class='nam'>os</span><span class='op'>.</span><span class='nam'>sep</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>testmatch</span> <span class='op'>=</span> <span class='nam'>re</span><span class='op'>.</span><span class='nam'>compile</span><span class='op'>(</span><span class='nam'>testmatch</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>cls_attr</span> <span class='op'>=</span> <span class='nam'>cls</span><span class='op'>.</span><span class='nam'>__dict__</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='com'># delayed import to reduce startup time</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>from</span> <span class='nam'>inspect</span> <span class='key'>import</span> <span class='nam'>isfunction</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>methods</span> <span class='op'>=</span> <span class='nam'>filter</span><span class='op'>(</span><span class='nam'>isfunction</span><span class='op'>,</span> <span class='nam'>cls_attr</span><span class='op'>.</span><span class='nam'>values</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>function</span> <span class='key'>in</span> <span class='nam'>methods</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>hasattr</span><span class='op'>(</span><span class='nam'>function</span><span class='op'>,</span> <span class='str'>&#39;compat_func_name&#39;</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>funcname</span> <span class='op'>=</span> <span class='nam'>function</span><span class='op'>.</span><span class='nam'>compat_func_name</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>funcname</span> <span class='op'>=</span> <span class='nam'>function</span><span class='op'>.</span><span class='nam'>__name__</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>except</span> <span class='nam'>AttributeError</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># not a function</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>continue</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>testmatch</span><span class='op'>.</span><span class='nam'>search</span><span class='op'>(</span><span class='nam'>funcname</span><span class='op'>)</span> <span class='key'>and</span> <span class='key'>not</span> <span class='nam'>funcname</span><span class='op'>.</span><span class='nam'>startswith</span><span class='op'>(</span><span class='str'>&#39;_&#39;</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>setattr</span><span class='op'>(</span><span class='nam'>cls</span><span class='op'>,</span> <span class='nam'>funcname</span><span class='op'>,</span> <span class='nam'>decorator</span><span class='op'>(</span><span class='nam'>function</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>measure</span><span class='op'>(</span><span class='nam'>code_str</span><span class='op'>,</span><span class='nam'>times</span><span class='op'>=</span><span class='num'>1</span><span class='op'>,</span><span class='nam'>label</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Return elapsed time for executing code_str in the</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; namespace of the caller for given times.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>frame</span> <span class='op'>=</span> <span class='nam'>sys</span><span class='op'>.</span><span class='nam'>_getframe</span><span class='op'>(</span><span class='num'>1</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>locs</span><span class='op'>,</span><span class='nam'>globs</span> <span class='op'>=</span> <span class='nam'>frame</span><span class='op'>.</span><span class='nam'>f_locals</span><span class='op'>,</span><span class='nam'>frame</span><span class='op'>.</span><span class='nam'>f_globals</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>code</span> <span class='op'>=</span> <span class='nam'>compile</span><span class='op'>(</span><span class='nam'>code_str</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='str'>&#39;Test name: %s &#39;</span> <span class='op'>%</span> <span class='nam'>label</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='str'>&#39;exec&#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>i</span> <span class='op'>=</span> <span class='num'>0</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>elapsed</span> <span class='op'>=</span> <span class='nam'>jiffies</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>while</span> <span class='nam'>i</span> <span class='op'>&lt;</span> <span class='nam'>times</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>i</span> <span class='op'>+=</span> <span class='num'>1</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>exec</span> <span class='nam'>code</span> <span class='key'>in</span> <span class='nam'>globs</span><span class='op'>,</span><span class='nam'>locs</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>elapsed</span> <span class='op'>=</span> <span class='nam'>jiffies</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-</span> <span class='nam'>elapsed</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span> <span class='num'>0.01</span><span class='op'>*</span><span class='nam'>elapsed</span><span class='strut'>&nbsp;</span></p>
    
</td>
</tr>
</table>
</div>

</body>
</html>
