<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
<title>Coverage for /Users/ysababady/.local/lib/python2.6/site-packages/arboris/visu_osg</title>
<link rel='stylesheet' href='style.css' type='text/css'>
<script type='text/javascript' src='jquery-1.3.2.min.js'></script>
<script type='text/javascript'>
function toggle_lines(btn, cls) {
    var btn = $(btn);
    var hide = "hide_"+cls;
    if (btn.hasClass(hide)) {
        $("#source ."+cls).removeClass(hide);
        btn.removeClass(hide);
    }
    else {
        $("#source ."+cls).addClass(hide);
        btn.addClass(hide);
    }
}
</script>
</head>
<body>
<div id='header'>
    <div class='content'>
        <h1>Coverage for <b>/Users/ysababady/.local/lib/python2.6/site-packages/arboris/visu_osg</b> :
            <span class='pc_cov'>1%</span>
        </h1>
        <h2 class='stats'>
            287 statements
            <span class='run hide_run' onclick='toggle_lines(this, "run")'>3 run</span>
            <span class='exc' onclick='toggle_lines(this, "exc")'>0 excluded</span>
            <span class='mis' onclick='toggle_lines(this, "mis")'>284 missing</span>
            
        </h2>
    </div>
</div>

<div id='source'>
<table cellspacing='0' cellpadding='0'>
<tr>
<td class='linenos' valign='top'>
<p class='pln'>1</p>
<p class='stm run hide_run'>2</p>
<p class='pln'>3</p>
<p class='pln'>4</p>
<p class='pln'>5</p>
<p class='pln'>6</p>
<p class='pln'>7</p>
<p class='pln'>8</p>
<p class='pln'>9</p>
<p class='pln'>10</p>
<p class='pln'>11</p>
<p class='pln'>12</p>
<p class='pln'>13</p>
<p class='pln'>14</p>
<p class='pln'>15</p>
<p class='pln'>16</p>
<p class='pln'>17</p>
<p class='pln'>18</p>
<p class='pln'>19</p>
<p class='pln'>20</p>
<p class='pln'>21</p>
<p class='stm run hide_run'>22</p>
<p class='pln'>23</p>
<p class='pln'>24</p>
<p class='stm run hide_run'>25</p>
<p class='stm mis'>26</p>
<p class='stm mis'>27</p>
<p class='stm mis'>28</p>
<p class='stm mis'>29</p>
<p class='stm mis'>30</p>
<p class='stm mis'>31</p>
<p class='stm mis'>32</p>
<p class='pln'>33</p>
<p class='stm mis'>34</p>
<p class='pln'>35</p>
<p class='stm mis'>36</p>
<p class='pln'>37</p>
<p class='pln'>38</p>
<p class='pln'>39</p>
<p class='pln'>40</p>
<p class='pln'>41</p>
<p class='pln'>42</p>
<p class='pln'>43</p>
<p class='pln'>44</p>
<p class='pln'>45</p>
<p class='pln'>46</p>
<p class='pln'>47</p>
<p class='pln'>48</p>
<p class='pln'>49</p>
<p class='pln'>50</p>
<p class='pln'>51</p>
<p class='pln'>52</p>
<p class='pln'>53</p>
<p class='pln'>54</p>
<p class='pln'>55</p>
<p class='pln'>56</p>
<p class='pln'>57</p>
<p class='pln'>58</p>
<p class='pln'>59</p>
<p class='pln'>60</p>
<p class='stm mis'>61</p>
<p class='stm mis'>62</p>
<p class='stm mis'>63</p>
<p class='stm mis'>64</p>
<p class='stm mis'>65</p>
<p class='stm mis'>66</p>
<p class='stm mis'>67</p>
<p class='stm mis'>68</p>
<p class='stm mis'>69</p>
<p class='stm mis'>70</p>
<p class='stm mis'>71</p>
<p class='stm mis'>72</p>
<p class='stm mis'>73</p>
<p class='stm mis'>74</p>
<p class='stm mis'>75</p>
<p class='stm mis'>76</p>
<p class='stm mis'>77</p>
<p class='stm mis'>78</p>
<p class='stm mis'>79</p>
<p class='stm mis'>80</p>
<p class='pln'>81</p>
<p class='stm mis'>82</p>
<p class='pln'>83</p>
<p class='pln'>84</p>
<p class='pln'>85</p>
<p class='pln'>86</p>
<p class='pln'>87</p>
<p class='pln'>88</p>
<p class='pln'>89</p>
<p class='pln'>90</p>
<p class='stm mis'>91</p>
<p class='pln'>92</p>
<p class='pln'>93</p>
<p class='pln'>94</p>
<p class='pln'>95</p>
<p class='pln'>96</p>
<p class='pln'>97</p>
<p class='pln'>98</p>
<p class='pln'>99</p>
<p class='pln'>100</p>
<p class='pln'>101</p>
<p class='pln'>102</p>
<p class='pln'>103</p>
<p class='pln'>104</p>
<p class='pln'>105</p>
<p class='pln'>106</p>
<p class='pln'>107</p>
<p class='stm mis'>108</p>
<p class='stm mis'>109</p>
<p class='pln'>110</p>
<p class='pln'>111</p>
<p class='pln'>112</p>
<p class='pln'>113</p>
<p class='stm mis'>114</p>
<p class='pln'>115</p>
<p class='stm mis'>116</p>
<p class='stm mis'>117</p>
<p class='stm mis'>118</p>
<p class='stm mis'>119</p>
<p class='stm mis'>120</p>
<p class='stm mis'>121</p>
<p class='stm mis'>122</p>
<p class='stm mis'>123</p>
<p class='stm mis'>124</p>
<p class='stm mis'>125</p>
<p class='stm mis'>126</p>
<p class='stm mis'>127</p>
<p class='pln'>128</p>
<p class='stm mis'>129</p>
<p class='pln'>130</p>
<p class='pln'>131</p>
<p class='stm mis'>132</p>
<p class='pln'>133</p>
<p class='pln'>134</p>
<p class='pln'>135</p>
<p class='pln'>136</p>
<p class='pln'>137</p>
<p class='pln'>138</p>
<p class='pln'>139</p>
<p class='pln'>140</p>
<p class='pln'>141</p>
<p class='pln'>142</p>
<p class='pln'>143</p>
<p class='pln'>144</p>
<p class='pln'>145</p>
<p class='pln'>146</p>
<p class='pln'>147</p>
<p class='pln'>148</p>
<p class='stm mis'>149</p>
<p class='pln'>150</p>
<p class='stm mis'>151</p>
<p class='stm mis'>152</p>
<p class='stm mis'>153</p>
<p class='stm mis'>154</p>
<p class='stm mis'>155</p>
<p class='pln'>156</p>
<p class='stm mis'>157</p>
<p class='stm mis'>158</p>
<p class='stm mis'>159</p>
<p class='stm mis'>160</p>
<p class='stm mis'>161</p>
<p class='stm mis'>162</p>
<p class='pln'>163</p>
<p class='stm mis'>164</p>
<p class='stm mis'>165</p>
<p class='stm mis'>166</p>
<p class='stm mis'>167</p>
<p class='stm mis'>168</p>
<p class='stm mis'>169</p>
<p class='pln'>170</p>
<p class='stm mis'>171</p>
<p class='stm mis'>172</p>
<p class='stm mis'>173</p>
<p class='stm mis'>174</p>
<p class='stm mis'>175</p>
<p class='pln'>176</p>
<p class='stm mis'>177</p>
<p class='pln'>178</p>
<p class='pln'>179</p>
<p class='pln'>180</p>
<p class='pln'>181</p>
<p class='pln'>182</p>
<p class='pln'>183</p>
<p class='pln'>184</p>
<p class='pln'>185</p>
<p class='pln'>186</p>
<p class='pln'>187</p>
<p class='pln'>188</p>
<p class='pln'>189</p>
<p class='pln'>190</p>
<p class='pln'>191</p>
<p class='pln'>192</p>
<p class='pln'>193</p>
<p class='pln'>194</p>
<p class='pln'>195</p>
<p class='pln'>196</p>
<p class='pln'>197</p>
<p class='stm mis'>198</p>
<p class='stm mis'>199</p>
<p class='stm mis'>200</p>
<p class='pln'>201</p>
<p class='stm mis'>202</p>
<p class='pln'>203</p>
<p class='stm mis'>204</p>
<p class='stm mis'>205</p>
<p class='stm mis'>206</p>
<p class='stm mis'>207</p>
<p class='stm mis'>208</p>
<p class='stm mis'>209</p>
<p class='stm mis'>210</p>
<p class='stm mis'>211</p>
<p class='pln'>212</p>
<p class='stm mis'>213</p>
<p class='pln'>214</p>
<p class='pln'>215</p>
<p class='pln'>216</p>
<p class='pln'>217</p>
<p class='pln'>218</p>
<p class='pln'>219</p>
<p class='pln'>220</p>
<p class='pln'>221</p>
<p class='pln'>222</p>
<p class='pln'>223</p>
<p class='pln'>224</p>
<p class='pln'>225</p>
<p class='stm mis'>226</p>
<p class='stm mis'>227</p>
<p class='stm mis'>228</p>
<p class='stm mis'>229</p>
<p class='stm mis'>230</p>
<p class='stm mis'>231</p>
<p class='stm mis'>232</p>
<p class='stm mis'>233</p>
<p class='pln'>234</p>
<p class='stm mis'>235</p>
<p class='pln'>236</p>
<p class='pln'>237</p>
<p class='pln'>238</p>
<p class='pln'>239</p>
<p class='pln'>240</p>
<p class='pln'>241</p>
<p class='pln'>242</p>
<p class='pln'>243</p>
<p class='pln'>244</p>
<p class='pln'>245</p>
<p class='pln'>246</p>
<p class='stm mis'>247</p>
<p class='pln'>248</p>
<p class='stm mis'>249</p>
<p class='stm mis'>250</p>
<p class='stm mis'>251</p>
<p class='stm mis'>252</p>
<p class='pln'>253</p>
<p class='pln'>254</p>
<p class='stm mis'>255</p>
<p class='pln'>256</p>
<p class='pln'>257</p>
<p class='stm mis'>258</p>
<p class='stm mis'>259</p>
<p class='stm mis'>260</p>
<p class='stm mis'>261</p>
<p class='stm mis'>262</p>
<p class='pln'>263</p>
<p class='stm mis'>264</p>
<p class='stm mis'>265</p>
<p class='stm mis'>266</p>
<p class='pln'>267</p>
<p class='stm mis'>268</p>
<p class='pln'>269</p>
<p class='stm mis'>270</p>
<p class='stm mis'>271</p>
<p class='stm mis'>272</p>
<p class='pln'>273</p>
<p class='stm mis'>274</p>
<p class='pln'>275</p>
<p class='stm mis'>276</p>
<p class='stm mis'>277</p>
<p class='stm mis'>278</p>
<p class='pln'>279</p>
<p class='stm mis'>280</p>
<p class='stm mis'>281</p>
<p class='pln'>282</p>
<p class='stm mis'>283</p>
<p class='stm mis'>284</p>
<p class='stm mis'>285</p>
<p class='stm mis'>286</p>
<p class='stm mis'>287</p>
<p class='stm mis'>288</p>
<p class='stm mis'>289</p>
<p class='stm mis'>290</p>
<p class='stm mis'>291</p>
<p class='stm mis'>292</p>
<p class='stm mis'>293</p>
<p class='stm mis'>294</p>
<p class='stm mis'>295</p>
<p class='pln'>296</p>
<p class='stm mis'>297</p>
<p class='pln'>298</p>
<p class='pln'>299</p>
<p class='pln'>300</p>
<p class='pln'>301</p>
<p class='pln'>302</p>
<p class='pln'>303</p>
<p class='pln'>304</p>
<p class='pln'>305</p>
<p class='stm mis'>306</p>
<p class='stm mis'>307</p>
<p class='stm mis'>308</p>
<p class='stm mis'>309</p>
<p class='stm mis'>310</p>
<p class='stm mis'>311</p>
<p class='pln'>312</p>
<p class='pln'>313</p>
<p class='pln'>314</p>
<p class='pln'>315</p>
<p class='pln'>316</p>
<p class='pln'>317</p>
<p class='pln'>318</p>
<p class='pln'>319</p>
<p class='pln'>320</p>
<p class='pln'>321</p>
<p class='pln'>322</p>
<p class='pln'>323</p>
<p class='pln'>324</p>
<p class='pln'>325</p>
<p class='stm mis'>326</p>
<p class='pln'>327</p>
<p class='pln'>328</p>
<p class='stm mis'>329</p>
<p class='pln'>330</p>
<p class='pln'>331</p>
<p class='pln'>332</p>
<p class='pln'>333</p>
<p class='pln'>334</p>
<p class='pln'>335</p>
<p class='pln'>336</p>
<p class='pln'>337</p>
<p class='pln'>338</p>
<p class='pln'>339</p>
<p class='pln'>340</p>
<p class='pln'>341</p>
<p class='pln'>342</p>
<p class='pln'>343</p>
<p class='pln'>344</p>
<p class='pln'>345</p>
<p class='pln'>346</p>
<p class='pln'>347</p>
<p class='pln'>348</p>
<p class='pln'>349</p>
<p class='stm mis'>350</p>
<p class='stm mis'>351</p>
<p class='stm mis'>352</p>
<p class='pln'>353</p>
<p class='stm mis'>354</p>
<p class='stm mis'>355</p>
<p class='pln'>356</p>
<p class='stm mis'>357</p>
<p class='stm mis'>358</p>
<p class='stm mis'>359</p>
<p class='pln'>360</p>
<p class='stm mis'>361</p>
<p class='pln'>362</p>
<p class='pln'>363</p>
<p class='pln'>364</p>
<p class='stm mis'>365</p>
<p class='stm mis'>366</p>
<p class='pln'>367</p>
<p class='pln'>368</p>
<p class='stm mis'>369</p>
<p class='stm mis'>370</p>
<p class='stm mis'>371</p>
<p class='stm mis'>372</p>
<p class='stm mis'>373</p>
<p class='stm mis'>374</p>
<p class='stm mis'>375</p>
<p class='pln'>376</p>
<p class='stm mis'>377</p>
<p class='stm mis'>378</p>
<p class='stm mis'>379</p>
<p class='stm mis'>380</p>
<p class='pln'>381</p>
<p class='stm mis'>382</p>
<p class='stm mis'>383</p>
<p class='stm mis'>384</p>
<p class='stm mis'>385</p>
<p class='pln'>386</p>
<p class='pln'>387</p>
<p class='pln'>388</p>
<p class='pln'>389</p>
<p class='stm mis'>390</p>
<p class='stm mis'>391</p>
<p class='stm mis'>392</p>
<p class='stm mis'>393</p>
<p class='pln'>394</p>
<p class='pln'>395</p>
<p class='stm mis'>396</p>
<p class='pln'>397</p>
<p class='stm mis'>398</p>
<p class='stm mis'>399</p>
<p class='pln'>400</p>
<p class='pln'>401</p>
<p class='pln'>402</p>
<p class='stm mis'>403</p>
<p class='stm mis'>404</p>
<p class='pln'>405</p>
<p class='stm mis'>406</p>
<p class='pln'>407</p>
<p class='pln'>408</p>
<p class='stm mis'>409</p>
<p class='stm mis'>410</p>
<p class='pln'>411</p>
<p class='stm mis'>412</p>
<p class='stm mis'>413</p>
<p class='stm mis'>414</p>
<p class='stm mis'>415</p>
<p class='stm mis'>416</p>
<p class='stm mis'>417</p>
<p class='stm mis'>418</p>
<p class='pln'>419</p>
<p class='stm mis'>420</p>
<p class='pln'>421</p>
<p class='pln'>422</p>
<p class='pln'>423</p>
<p class='pln'>424</p>
<p class='pln'>425</p>
<p class='pln'>426</p>
<p class='pln'>427</p>
<p class='pln'>428</p>
<p class='pln'>429</p>
<p class='pln'>430</p>
<p class='pln'>431</p>
<p class='stm mis'>432</p>
<p class='stm mis'>433</p>
<p class='pln'>434</p>
<p class='stm mis'>435</p>
<p class='stm mis'>436</p>
<p class='stm mis'>437</p>
<p class='pln'>438</p>
<p class='pln'>439</p>
<p class='stm mis'>440</p>
<p class='stm mis'>441</p>
<p class='pln'>442</p>
<p class='stm mis'>443</p>
<p class='stm mis'>444</p>
<p class='stm mis'>445</p>
<p class='pln'>446</p>
<p class='stm mis'>447</p>
<p class='stm mis'>448</p>
<p class='stm mis'>449</p>
<p class='stm mis'>450</p>
<p class='pln'>451</p>
<p class='pln'>452</p>
<p class='pln'>453</p>
<p class='pln'>454</p>
<p class='pln'>455</p>
<p class='pln'>456</p>
<p class='pln'>457</p>
<p class='pln'>458</p>
<p class='pln'>459</p>
<p class='pln'>460</p>
<p class='stm mis'>461</p>
<p class='stm mis'>462</p>
<p class='stm mis'>463</p>
<p class='stm mis'>464</p>
<p class='stm mis'>465</p>
<p class='pln'>466</p>
<p class='stm mis'>467</p>
<p class='stm mis'>468</p>
<p class='stm mis'>469</p>
<p class='stm mis'>470</p>
<p class='stm mis'>471</p>
<p class='pln'>472</p>
<p class='stm mis'>473</p>
<p class='stm mis'>474</p>
<p class='stm mis'>475</p>
<p class='stm mis'>476</p>
<p class='stm mis'>477</p>
<p class='stm mis'>478</p>
<p class='stm mis'>479</p>
<p class='stm mis'>480</p>
<p class='stm mis'>481</p>
<p class='stm mis'>482</p>
<p class='pln'>483</p>
<p class='stm mis'>484</p>
<p class='stm mis'>485</p>
<p class='pln'>486</p>
<p class='pln'>487</p>
<p class='stm mis'>488</p>
<p class='stm mis'>489</p>
<p class='stm mis'>490</p>
<p class='stm mis'>491</p>
<p class='stm mis'>492</p>
<p class='stm mis'>493</p>
<p class='stm mis'>494</p>
<p class='stm mis'>495</p>
<p class='stm mis'>496</p>
<p class='stm mis'>497</p>
<p class='stm mis'>498</p>
<p class='stm mis'>499</p>
<p class='pln'>500</p>
<p class='stm mis'>501</p>
<p class='stm mis'>502</p>
<p class='pln'>503</p>
<p class='pln'>504</p>
<p class='stm mis'>505</p>
<p class='stm mis'>506</p>
<p class='pln'>507</p>
<p class='pln'>508</p>
<p class='stm mis'>509</p>
<p class='stm mis'>510</p>
<p class='pln'>511</p>
<p class='pln'>512</p>
<p class='pln'>513</p>
<p class='stm mis'>514</p>
<p class='stm mis'>515</p>
<p class='stm mis'>516</p>
<p class='stm mis'>517</p>
<p class='stm mis'>518</p>
<p class='stm mis'>519</p>
<p class='stm mis'>520</p>
<p class='stm mis'>521</p>
<p class='pln'>522</p>
<p class='pln'>523</p>
<p class='stm mis'>524</p>
<p class='pln'>525</p>
<p class='stm mis'>526</p>
<p class='pln'>527</p>
<p class='stm mis'>528</p>
<p class='stm mis'>529</p>
<p class='stm mis'>530</p>
<p class='stm mis'>531</p>
<p class='stm mis'>532</p>
<p class='stm mis'>533</p>
<p class='stm mis'>534</p>
<p class='stm mis'>535</p>
<p class='stm mis'>536</p>
<p class='stm mis'>537</p>
<p class='stm mis'>538</p>
<p class='pln'>539</p>
<p class='pln'>540</p>
<p class='pln'>541</p>
<p class='pln'>542</p>
<p class='pln'>543</p>
<p class='pln'>544</p>
<p class='stm mis'>545</p>
<p class='pln'>546</p>
<p class='stm mis'>547</p>
<p class='stm mis'>548</p>
<p class='stm mis'>549</p>
<p class='stm mis'>550</p>
<p class='stm mis'>551</p>
<p class='stm mis'>552</p>
<p class='stm mis'>553</p>
<p class='stm mis'>554</p>
<p class='pln'>555</p>
<p class='pln'>556</p>
<p class='stm mis'>557</p>
<p class='stm mis'>558</p>
<p class='stm mis'>559</p>
<p class='stm mis'>560</p>
<p class='stm mis'>561</p>
<p class='stm mis'>562</p>
<p class='pln'>563</p>
<p class='stm mis'>564</p>
<p class='pln'>565</p>
<p class='stm mis'>566</p>
<p class='pln'>567</p>
<p class='pln'>568</p>
<p class='stm mis'>569</p>
<p class='stm mis'>570</p>
<p class='pln'>571</p>
<p class='stm mis'>572</p>
<p class='stm mis'>573</p>
<p class='pln'>574</p>
<p class='stm mis'>575</p>
<p class='stm mis'>576</p>
<p class='pln'>577</p>
    
</td>
<td class='text' valign='top'>
<p class='pln'><span class='com'># coding=utf-8</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>Visualization of a simulation</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>This module is based on the openscenegraph (osg) python wrappers.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>Scene graph basics</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>------------------</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>A scene graph is a data structure that arranges the logical and </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>spatial representation of a graphical scene. It consists of a </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>collection of *nodes* in a tree or graph structure. In general a node</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>may have many children but only a single parent, with the effect of a </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>parent apparent to all its child nodes. For instance, a geometrical </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>transformation matrix node would move all its children.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>In some cases, a single (child) node may be shared between several </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>parents, for instance when the same geometry is displayed at several places</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>(this saves memory).</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='nam'>__author__</span> <span class='op'>=</span> <span class='op'>(</span><span class='str'>&quot;Sébastien BARTHÉLEMY &lt;barthelemy@crans.org&gt;&quot;</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;Joseph SALINI &lt;joseph.salini@gmail.com&gt;&quot;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>import</span> <span class='nam'>osg</span><span class='op'>,</span> <span class='nam'>osgDB</span><span class='op'>,</span> <span class='nam'>osgGA</span><span class='op'>,</span> <span class='nam'>osgViewer</span><span class='op'>,</span> <span class='nam'>osgText</span><span class='op'>,</span> <span class='nam'>osgUtil</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>from</span> <span class='nam'>numpy</span> <span class='key'>import</span> <span class='nam'>pi</span><span class='op'>,</span> <span class='nam'>arctan2</span><span class='op'>,</span> <span class='nam'>array</span><span class='op'>,</span> <span class='nam'>dot</span><span class='op'>,</span> <span class='nam'>cross</span><span class='op'>,</span> <span class='nam'>sqrt</span><span class='op'>,</span> <span class='nam'>eye</span><span class='op'>,</span> <span class='nam'>cos</span><span class='op'>,</span> <span class='nam'>sin</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>import</span> <span class='nam'>shapes</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>import</span> <span class='nam'>core</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>import</span> <span class='nam'>constraints</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>import</span> <span class='nam'>homogeneousmatrix</span> <span class='key'>as</span> <span class='nam'>Hg</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>import</span> <span class='nam'>massmatrix</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>import</span> <span class='nam'>logging</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='nam'>logging</span><span class='op'>.</span><span class='nam'>basicConfig</span><span class='op'>(</span><span class='nam'>level</span><span class='op'>=</span><span class='nam'>logging</span><span class='op'>.</span><span class='nam'>DEBUG</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>def</span> <span class='nam'>hsv_to_rgb</span><span class='op'>(</span><span class='nam'>hsv</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Convert color from hsv to rgb.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param hsv: hsv values (with h in [0..360], s and v in [0..1])</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type hsv: 3-tuple of floats (h, s, v)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :return rgb: rgb values (with r, g and b in [0..1])</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :rtype rgb: 3-tuple of floats (r, g, b)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; The algorithm is taken from:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; http://en.wikipedia.org/wiki/HSL_and_HSV</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; **Examples:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; hsv_to_rgb((360,1.,1.)) # red</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; (1.0, 0.0, 0.0)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; hsv_to_rgb((360,0.5,1.)) # faded red</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; (1.0, 0.5, 0.5)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; hsv_to_rgb((360,1.,0.5)) # dark red</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; (0.5, 0.0, 0.0)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; hsv_to_rgb((120,1.,1)) # green</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; (0.0, 1, 0.0)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; hsv_to_rgb((240,1.,1)) # blue</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; (0.0, 0.0, 1)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>from</span> <span class='nam'>math</span> <span class='key'>import</span> <span class='nam'>floor</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='op'>(</span><span class='nam'>h</span><span class='op'>,</span> <span class='nam'>s</span><span class='op'>,</span> <span class='nam'>v</span><span class='op'>)</span> <span class='op'>=</span> <span class='nam'>hsv</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>hi</span> <span class='op'>=</span> <span class='nam'>floor</span><span class='op'>(</span><span class='nam'>h</span><span class='op'>/</span><span class='num'>60</span><span class='op'>)</span> <span class='op'>%</span> <span class='num'>6</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>f</span> <span class='op'>=</span> <span class='nam'>h</span><span class='op'>/</span><span class='num'>60.</span> <span class='op'>-</span> <span class='nam'>floor</span><span class='op'>(</span><span class='nam'>h</span><span class='op'>/</span><span class='num'>60</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>p</span> <span class='op'>=</span> <span class='nam'>v</span> <span class='op'>*</span> <span class='op'>(</span><span class='num'>1</span> <span class='op'>-</span> <span class='nam'>s</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>q</span> <span class='op'>=</span> <span class='nam'>v</span> <span class='op'>*</span> <span class='op'>(</span><span class='num'>1</span> <span class='op'>-</span> <span class='nam'>f</span><span class='op'>*</span><span class='nam'>s</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>t</span> <span class='op'>=</span> <span class='nam'>v</span> <span class='op'>*</span> <span class='op'>(</span><span class='num'>1</span> <span class='op'>-</span> <span class='op'>(</span><span class='num'>1</span><span class='op'>-</span><span class='nam'>f</span><span class='op'>)</span><span class='op'>*</span><span class='nam'>s</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>hi</span> <span class='op'>==</span> <span class='num'>0</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>rgb</span> <span class='op'>=</span> <span class='op'>(</span><span class='nam'>v</span><span class='op'>,</span> <span class='nam'>t</span><span class='op'>,</span> <span class='nam'>p</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>hi</span> <span class='op'>==</span> <span class='num'>1</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>rgb</span> <span class='op'>=</span> <span class='op'>(</span><span class='nam'>q</span><span class='op'>,</span> <span class='nam'>v</span><span class='op'>,</span> <span class='nam'>p</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>hi</span> <span class='op'>==</span> <span class='num'>2</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>rgb</span> <span class='op'>=</span> <span class='op'>(</span><span class='nam'>p</span><span class='op'>,</span> <span class='nam'>v</span><span class='op'>,</span> <span class='nam'>t</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>hi</span> <span class='op'>==</span> <span class='num'>3</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>rgb</span> <span class='op'>=</span> <span class='op'>(</span><span class='nam'>p</span><span class='op'>,</span> <span class='nam'>q</span><span class='op'>,</span> <span class='nam'>v</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>hi</span> <span class='op'>==</span> <span class='num'>4</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>rgb</span> <span class='op'>=</span> <span class='op'>(</span><span class='nam'>t</span><span class='op'>,</span> <span class='nam'>p</span><span class='op'>,</span> <span class='nam'>v</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>hi</span> <span class='op'>==</span> <span class='num'>5</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>rgb</span> <span class='op'>=</span> <span class='op'>(</span><span class='nam'>v</span><span class='op'>,</span> <span class='nam'>p</span><span class='op'>,</span> <span class='nam'>q</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>rgb</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='nam'>_MASK</span> <span class='op'>=</span> <span class='op'>{</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;name&#39;</span><span class='op'>:</span> <span class='num'>1</span><span class='op'>&lt;&lt;</span><span class='num'>1</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;frame&#39;</span><span class='op'>:</span> <span class='num'>1</span><span class='op'>&lt;&lt;</span><span class='num'>2</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;link&#39;</span><span class='op'>:</span> <span class='num'>1</span><span class='op'>&lt;&lt;</span><span class='num'>3</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;shape&#39;</span><span class='op'>:</span> <span class='num'>1</span><span class='op'>&lt;&lt;</span><span class='num'>4</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;inertia ellipsoid&#39;</span><span class='op'>:</span> <span class='num'>1</span><span class='op'>&lt;&lt;</span><span class='num'>5</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;constraint force&#39;</span><span class='op'>:</span> <span class='num'>1</span><span class='op'>&lt;&lt;</span><span class='num'>6</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;active constraint&#39;</span><span class='op'>:</span> <span class='num'>1</span><span class='op'>&lt;&lt;</span><span class='num'>7</span><span class='op'>}</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>def</span> <span class='nam'>_pose2mat</span><span class='op'>(</span><span class='nam'>pose</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Convert an homogeneous transform matrix from numpy to osg.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; The conversion handles the transposition required by osg.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param pose: the homogeneous transform matrix.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type pose: (4,4)-shaped ndarray</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; **Example:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; mat = array([[ 1.,&nbsp; 2.,&nbsp; 3.,&nbsp; 4.],</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; ...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ 5.,&nbsp; 6.,&nbsp; 7.,&nbsp; 8.],</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; ...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ 9., 10., 11., 12.],</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; ...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [13., 14., 15., 16.]])</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; osg_mat = _pose2mat(mat)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>m</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Matrixd</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>m</span><span class='op'>.</span><span class='nam'>set</span><span class='op'>(</span><span class='nam'>pose</span><span class='op'>[</span><span class='num'>0</span><span class='op'>,</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>pose</span><span class='op'>[</span><span class='num'>1</span><span class='op'>,</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>pose</span><span class='op'>[</span><span class='num'>2</span><span class='op'>,</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>pose</span><span class='op'>[</span><span class='num'>3</span><span class='op'>,</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>pose</span><span class='op'>[</span><span class='num'>0</span><span class='op'>,</span><span class='num'>1</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>pose</span><span class='op'>[</span><span class='num'>1</span><span class='op'>,</span><span class='num'>1</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>pose</span><span class='op'>[</span><span class='num'>2</span><span class='op'>,</span><span class='num'>1</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>pose</span><span class='op'>[</span><span class='num'>3</span><span class='op'>,</span><span class='num'>1</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>pose</span><span class='op'>[</span><span class='num'>0</span><span class='op'>,</span><span class='num'>2</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>pose</span><span class='op'>[</span><span class='num'>1</span><span class='op'>,</span><span class='num'>2</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>pose</span><span class='op'>[</span><span class='num'>2</span><span class='op'>,</span><span class='num'>2</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>pose</span><span class='op'>[</span><span class='num'>3</span><span class='op'>,</span><span class='num'>2</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>pose</span><span class='op'>[</span><span class='num'>0</span><span class='op'>,</span><span class='num'>3</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>pose</span><span class='op'>[</span><span class='num'>1</span><span class='op'>,</span><span class='num'>3</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>pose</span><span class='op'>[</span><span class='num'>2</span><span class='op'>,</span><span class='num'>3</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>pose</span><span class='op'>[</span><span class='num'>3</span><span class='op'>,</span><span class='num'>3</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>m</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>def</span> <span class='nam'>_align_z_with_vector</span><span class='op'>(</span><span class='nam'>vec</span><span class='op'>,</span> <span class='nam'>transform</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>transform</span><span class='op'>,</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>PositionAttitudeTransform</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>z</span> <span class='op'>=</span> <span class='nam'>array</span><span class='op'>(</span><span class='op'>[</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>1.</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>length</span> <span class='op'>=</span> <span class='nam'>sqrt</span><span class='op'>(</span><span class='nam'>vec</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>*</span><span class='nam'>vec</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span> <span class='op'>+</span> <span class='nam'>vec</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>*</span><span class='nam'>vec</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span> <span class='op'>+</span> <span class='nam'>vec</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>*</span><span class='nam'>vec</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>length</span> <span class='op'>&gt;</span> <span class='num'>0.</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>vec</span> <span class='op'>=</span> <span class='nam'>vec</span><span class='op'>/</span><span class='nam'>length</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>q</span> <span class='op'>=</span> <span class='nam'>cross</span><span class='op'>(</span><span class='nam'>z</span><span class='op'>,</span> <span class='nam'>vec</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>sin_theta</span> <span class='op'>=</span> <span class='nam'>sqrt</span><span class='op'>(</span><span class='nam'>q</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>*</span><span class='nam'>q</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span> <span class='op'>+</span> <span class='nam'>q</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>*</span><span class='nam'>q</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span> <span class='op'>+</span> <span class='nam'>q</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>*</span><span class='nam'>q</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>cos_theta</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>z</span><span class='op'>,</span> <span class='nam'>vec</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>theta</span> <span class='op'>=</span> <span class='nam'>arctan2</span><span class='op'>(</span><span class='nam'>sin_theta</span><span class='op'>,</span> <span class='nam'>cos_theta</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>sin_theta</span> <span class='op'>==</span> <span class='num'>0.</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>transform</span><span class='op'>.</span><span class='nam'>setAttitude</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Quat</span><span class='op'>(</span><span class='nam'>theta</span><span class='op'>,</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3d</span><span class='op'>(</span><span class='num'>1.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>transform</span><span class='op'>.</span><span class='nam'>setAttitude</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Quat</span><span class='op'>(</span><span class='nam'>theta</span><span class='op'>,</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3d</span><span class='op'>(</span><span class='nam'>q</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>q</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>q</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>def</span> <span class='nam'>draw_frame</span><span class='op'>(</span><span class='nam'>length</span><span class='op'>=</span><span class='num'>1.</span><span class='op'>,</span> <span class='nam'>radius</span><span class='op'>=</span><span class='num'>0.05</span><span class='op'>,</span> <span class='nam'>alpha</span><span class='op'>=</span><span class='num'>1.</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Draw a frame, as 3 cylinders.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param length: the cylinders length</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type length: float</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param radius: the cylinders radius</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type radius: float</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param alpha: the cylinders alpha value</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type alpha: float</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :rtype: osg.PositionAttitudeTransform</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; **Example:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; generic_frame = draw_frame(.5, .8)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='com'># create the x cylinder</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>cyl_x</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>ShapeDrawable</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Cylinder</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3</span><span class='op'>(</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='nam'>length</span><span class='op'>/</span><span class='num'>2.</span><span class='op'>)</span><span class='op'>,</span> <span class='nam'>radius</span><span class='op'>,</span> <span class='nam'>length</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>cyl_y</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>ShapeDrawable</span><span class='op'>(</span><span class='nam'>cyl_x</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>cyl_z</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>ShapeDrawable</span><span class='op'>(</span><span class='nam'>cyl_x</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>cyl_x</span><span class='op'>.</span><span class='nam'>setColor</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec4</span><span class='op'>(</span><span class='num'>1.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='nam'>alpha</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>cyl_y</span><span class='op'>.</span><span class='nam'>setColor</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec4</span><span class='op'>(</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>1.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='nam'>alpha</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>cyl_z</span><span class='op'>.</span><span class='nam'>setColor</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec4</span><span class='op'>(</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>1.</span><span class='op'>,</span><span class='nam'>alpha</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='com'># create the geode for each cylinder</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>geo_x</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Geode</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>geo_x</span><span class='op'>.</span><span class='nam'>addDrawable</span><span class='op'>(</span> <span class='nam'>cyl_x</span> <span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>geo_y</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Geode</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>geo_y</span><span class='op'>.</span><span class='nam'>addDrawable</span><span class='op'>(</span> <span class='nam'>cyl_y</span> <span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>geo_z</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Geode</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>geo_z</span><span class='op'>.</span><span class='nam'>addDrawable</span><span class='op'>(</span> <span class='nam'>cyl_z</span> <span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='com'># create the transform node for geo_x and geo_y</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>trans_x</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>PositionAttitudeTransform</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>trans_x</span><span class='op'>.</span><span class='nam'>setAttitude</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Quat</span><span class='op'>(</span><span class='nam'>pi</span><span class='op'>/</span><span class='num'>2.</span><span class='op'>,</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3</span><span class='op'>(</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>1.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>trans_x</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>geo_x</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>trans_y</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>PositionAttitudeTransform</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>trans_y</span><span class='op'>.</span><span class='nam'>setAttitude</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Quat</span><span class='op'>(</span><span class='op'>-</span><span class='nam'>pi</span><span class='op'>/</span><span class='num'>2.</span><span class='op'>,</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3</span><span class='op'>(</span><span class='num'>1.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>trans_y</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>geo_y</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='com'># create the group and addChild trans_x and y, z didn&#39;t need transform</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>frame</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>PositionAttitudeTransform</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>frame</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>trans_x</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>frame</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>trans_y</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>frame</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>geo_z</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>frame</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>def</span> <span class='nam'>draw_line</span><span class='op'>(</span><span class='nam'>start</span><span class='op'>,</span> <span class='nam'>end</span><span class='op'>,</span> <span class='nam'>radius</span><span class='op'>=</span><span class='num'>0.04</span><span class='op'>,</span> <span class='nam'>color</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Draw a line between two points.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; The line is rendered as a cylinder.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param start: start point</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type start: (3,)-shaped ndarray</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param end: end point</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type end: (3,)-shaped ndarray</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param radius: the cylinder radius</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type radius: float</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param color: the line color </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type color: osg.Vec4</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :rtype: osg.Transform</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; **Example:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; draw_line((1.,2.,3.), (4.,5.,6.), radius=.5) #doctest: +ELLIPSIS</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &lt;osg.PositionAttitudeTransform; proxy of &lt;Swig Object of type &#39;osg::PositionAttitudeTransform *&#39; at 0x...&gt; &gt;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>v</span> <span class='op'>=</span> <span class='nam'>array</span><span class='op'>(</span><span class='op'>(</span><span class='nam'>end</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span> <span class='op'>-</span> <span class='nam'>start</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>end</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span> <span class='op'>-</span> <span class='nam'>start</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>end</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span> <span class='op'>-</span> <span class='nam'>start</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>length</span> <span class='op'>=</span> <span class='nam'>sqrt</span><span class='op'>(</span><span class='nam'>v</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>*</span><span class='nam'>v</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span> <span class='op'>+</span> <span class='nam'>v</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>*</span><span class='nam'>v</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span> <span class='op'>+</span> <span class='nam'>v</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>*</span><span class='nam'>v</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>v</span> <span class='op'>=</span> <span class='nam'>v</span><span class='op'>/</span><span class='nam'>length</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='com'># create the cylinder</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>cyl</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>ShapeDrawable</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Cylinder</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3</span><span class='op'>(</span><span class='num'>0.</span><span class='op'>,</span> <span class='num'>0.</span><span class='op'>,</span> <span class='nam'>length</span><span class='op'>/</span><span class='num'>2</span><span class='op'>)</span><span class='op'>,</span> <span class='nam'>radius</span><span class='op'>,</span> <span class='nam'>length</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>color</span> <span class='key'>is</span> <span class='key'>not</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>cyl</span><span class='op'>.</span><span class='nam'>setColor</span><span class='op'>(</span><span class='nam'>color</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>geode</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Geode</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>geode</span><span class='op'>.</span><span class='nam'>addDrawable</span><span class='op'>(</span><span class='nam'>cyl</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>line</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>PositionAttitudeTransform</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>_align_z_with_vector</span><span class='op'>(</span><span class='nam'>v</span><span class='op'>,</span> <span class='nam'>line</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>line</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>geode</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>line</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>def</span> <span class='nam'>draw_text</span><span class='op'>(</span><span class='nam'>label</span><span class='op'>,</span> <span class='nam'>size</span><span class='op'>=</span><span class='num'>1.</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Create a text geode.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param label: the text</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type lable: string</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param size: a scaling factor</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type size: float</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; **Example:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; draw_text(&#39;le texte a afficher&#39;, .2) #doctest: +ELLIPSIS</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &lt;osg.Geode; proxy of &lt;Swig Object of type &#39;osg::Geode *&#39; at 0x...&gt; &gt;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>text</span> <span class='op'>=</span> <span class='nam'>osgText</span><span class='op'>.</span><span class='nam'>Text</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>text</span><span class='op'>.</span><span class='nam'>setCharacterSize</span><span class='op'>(</span><span class='nam'>size</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>text</span><span class='op'>.</span><span class='nam'>setText</span><span class='op'>(</span><span class='nam'>str</span><span class='op'>(</span><span class='nam'>label</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>text</span><span class='op'>.</span><span class='nam'>setDrawMode</span><span class='op'>(</span><span class='nam'>osgText</span><span class='op'>.</span><span class='nam'>Text</span><span class='op'>.</span><span class='nam'>TEXT</span> <span class='op'>|</span> <span class='nam'>osgText</span><span class='op'>.</span><span class='nam'>Text</span><span class='op'>.</span><span class='nam'>BOUNDINGBOX</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>text</span><span class='op'>.</span><span class='nam'>setAlignment</span><span class='op'>(</span><span class='nam'>osgText</span><span class='op'>.</span><span class='nam'>Text</span><span class='op'>.</span><span class='nam'>CENTER_TOP</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>geode</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Geode</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>geode</span><span class='op'>.</span><span class='nam'>addDrawable</span><span class='op'>(</span><span class='nam'>text</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>geode</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>def</span> <span class='nam'>draw_force</span><span class='op'>(</span><span class='nam'>length</span><span class='op'>=</span><span class='num'>1.</span><span class='op'>,</span> <span class='nam'>radius</span><span class='op'>=</span><span class='num'>0.03</span><span class='op'>,</span> <span class='nam'>alpha</span><span class='op'>=</span><span class='num'>1.</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Draw a force as a cylinder.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param length: the cylinder length</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type length: float</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param radius: the cylinder radius</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type radius: float</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param alpha: the cylinders alpha value</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type alpha: float</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :rtype: osg.Geode</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>cyl</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>ShapeDrawable</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Cylinder</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3</span><span class='op'>(</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='nam'>length</span><span class='op'>/</span><span class='num'>2.</span><span class='op'>)</span><span class='op'>,</span> <span class='nam'>radius</span><span class='op'>,</span> <span class='nam'>length</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>cyl</span><span class='op'>.</span><span class='nam'>setColor</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec4</span><span class='op'>(</span><span class='num'>1.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='nam'>alpha</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>geode</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Geode</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>geode</span><span class='op'>.</span><span class='nam'>addDrawable</span><span class='op'>(</span><span class='nam'>cyl</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>geode</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>class</span> <span class='nam'>SwitcherHandler</span><span class='op'>(</span><span class='nam'>osgGA</span><span class='op'>.</span><span class='nam'>GUIEventHandler</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Switches parts of the display on/off according to keys pressed.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>camera</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osgGA</span><span class='op'>.</span><span class='nam'>GUIEventHandler</span><span class='op'>.</span><span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_logger</span> <span class='op'>=</span> <span class='nam'>logging</span><span class='op'>.</span><span class='nam'>getLogger</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>__class__</span><span class='op'>.</span><span class='nam'>__name__</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_categories</span> <span class='op'>=</span> <span class='op'>{</span><span class='op'>}</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_camera</span> <span class='op'>=</span> <span class='nam'>camera</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>add_category</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>key</span><span class='op'>,</span> <span class='nam'>category</span><span class='op'>,</span> <span class='nam'>on</span><span class='op'>=</span><span class='nam'>True</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_categories</span><span class='op'>[</span><span class='nam'>key</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>category</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_turn</span><span class='op'>(</span><span class='nam'>category</span><span class='op'>,</span> <span class='nam'>on</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>_toggle</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>category</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Toggle display of a category.&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>mask</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_camera</span><span class='op'>.</span><span class='nam'>getCullMask</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>mask</span> <span class='op'>=</span> <span class='nam'>mask</span> <span class='op'>^</span> <span class='nam'>_MASK</span><span class='op'>[</span><span class='nam'>category</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_camera</span><span class='op'>.</span><span class='nam'>setCullMask</span><span class='op'>(</span><span class='nam'>mask</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>_turn</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>category</span><span class='op'>,</span> <span class='nam'>on</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Turn the display of a category on/off.&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>mask</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_camera</span><span class='op'>.</span><span class='nam'>getCullMask</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>on</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>mask</span> <span class='op'>=</span> <span class='nam'>mask</span> <span class='op'>|</span> <span class='nam'>_MASK</span><span class='op'>[</span><span class='nam'>category</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>mask</span> <span class='op'>=</span> <span class='nam'>mask</span> <span class='op'>&amp;</span> <span class='op'>~</span><span class='nam'>_MASK</span><span class='op'>[</span><span class='nam'>category</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_camera</span><span class='op'>.</span><span class='nam'>setCullMask</span><span class='op'>(</span><span class='nam'>mask</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>handle</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>ea</span><span class='op'>,</span> <span class='nam'>aa</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>nv</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>eventtype</span> <span class='op'>=</span> <span class='nam'>ea</span><span class='op'>.</span><span class='nam'>getEventType</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>eventtype</span> <span class='op'>==</span> <span class='nam'>ea</span><span class='op'>.</span><span class='nam'>KEYDOWN</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>key</span> <span class='op'>=</span> <span class='nam'>ea</span><span class='op'>.</span><span class='nam'>getKey</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_logger</span><span class='op'>.</span><span class='nam'>info</span><span class='op'>(</span><span class='str'>&#39;key %d pressed&#39;</span><span class='op'>,</span> <span class='nam'>key</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>category</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_categories</span><span class='op'>[</span><span class='nam'>key</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>except</span> <span class='nam'>KeyError</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>False</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>mask</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_camera</span><span class='op'>.</span><span class='nam'>getCullMask</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>mask</span> <span class='op'>=</span> <span class='nam'>mask</span> <span class='op'>^</span> <span class='nam'>_MASK</span><span class='op'>[</span><span class='nam'>category</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_camera</span><span class='op'>.</span><span class='nam'>setCullMask</span><span class='op'>(</span><span class='nam'>mask</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>False</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>def</span> <span class='nam'>graphic_options</span><span class='op'>(</span><span class='nam'>scale</span><span class='op'>=</span><span class='num'>1.</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Default dictionnary of graphic options.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param scale: the scaling factor</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type scale: float</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :return: scaled graphic options</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :rtype: dict</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>body_palette</span> <span class='op'>=</span> <span class='op'>[</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>ncolor</span> <span class='op'>=</span> <span class='num'>20</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>k</span> <span class='key'>in</span> <span class='nam'>range</span><span class='op'>(</span><span class='nam'>ncolor</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>h</span> <span class='op'>=</span> <span class='num'>360.</span><span class='op'>/</span><span class='nam'>ncolor</span> <span class='op'>*</span> <span class='nam'>k</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>body_palette</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>hsv_to_rgb</span><span class='op'>(</span><span class='op'>(</span><span class='nam'>h</span><span class='op'>,</span> <span class='num'>0.9</span> <span class='op'>,</span> <span class='num'>0.9</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='nam'>options</span> <span class='op'>=</span> <span class='op'>{</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;frame length&#39;</span><span class='op'>:</span> <span class='num'>0.08</span> <span class='op'>*</span> <span class='nam'>scale</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;frame radius&#39;</span><span class='op'>:</span> <span class='num'>0.005</span> <span class='op'>*</span> <span class='nam'>scale</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;frame alpha&#39;</span><span class='op'>:</span> <span class='num'>1.</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;link radius&#39;</span><span class='op'>:</span> <span class='num'>0.004</span> <span class='op'>*</span> <span class='nam'>scale</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;point radius&#39;</span><span class='op'>:</span> <span class='num'>0.008</span> <span class='op'>*</span> <span class='nam'>scale</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;text size&#39;</span><span class='op'>:</span> <span class='num'>0.1</span> <span class='op'>*</span> <span class='nam'>scale</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;body palette&#39;</span><span class='op'>:</span> <span class='nam'>body_palette</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;fullscreen&#39;</span><span class='op'>:</span> <span class='nam'>False</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;window size&#39;</span><span class='op'>:</span> <span class='op'>(</span><span class='num'>800</span><span class='op'>,</span><span class='num'>600</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;window position&#39;</span><span class='op'>:</span> <span class='op'>(</span><span class='num'>0</span><span class='op'>,</span><span class='num'>0</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;center of interest&#39;</span><span class='op'>:</span> <span class='op'>(</span><span class='num'>0.</span><span class='op'>,</span> <span class='num'>0.</span><span class='op'>,</span> <span class='num'>0.</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;camera position&#39;</span><span class='op'>:</span> <span class='op'>(</span><span class='num'>3.</span><span class='op'>,</span><span class='num'>3.</span><span class='op'>,</span><span class='num'>3.</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;force length&#39;</span><span class='op'>:</span> <span class='num'>0.1</span> <span class='op'>*</span> <span class='nam'>scale</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;force radius&#39;</span><span class='op'>:</span> <span class='num'>0.002</span> <span class='op'>*</span> <span class='nam'>scale</span><span class='op'>}</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>options</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'><span class='key'>class</span> <span class='nam'>Drawer</span><span class='op'>(</span><span class='nam'>core</span><span class='op'>.</span><span class='nam'>Observer</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Draw the world, creating OSG nodes.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; **Attributes:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; - :attr:`root`: the root node of the OSG scene,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; - :attr:`frames`: a dictionnary of tranform nodes corresponding to</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; and indexed by :class:`core.Frame` objects,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; - :attr:`constraint_forces` and :attr:`constraints_moment`: </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; dictionnaries of tranform nodes corresponding to and indexed by</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; :class:`core.Constraint` objects,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; **Methods:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; - :meth:`__init__` creates ``root`` OSG node, get the graphic options</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; (colors, sizes...) and do house keeping. If the ``world`` parameter is</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; given, it will be converted to OSG nodes (it calls :meth:`init`). </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; - :meth:`init` converts the ``world`` to osg nodes </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; (it calls :meth:`register`).</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; - :meth:`register` converts a single arboris object ``obj`` to zero or more</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; OSG nodes.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>world</span><span class='op'>,</span> <span class='nam'>scale</span><span class='op'>=</span><span class='num'>1.</span><span class='op'>,</span> <span class='nam'>options</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>,</span> <span class='nam'>viewer</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>options</span> <span class='key'>is</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span> <span class='op'>=</span> <span class='nam'>graphic_options</span><span class='op'>(</span><span class='nam'>scale</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span> <span class='op'>=</span> <span class='nam'>options</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>root</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Group</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># enable the transparency/alpha:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>blend</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>StateSet</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>blend</span><span class='op'>.</span><span class='nam'>setMode</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>GL_BLEND</span><span class='op'>,</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>StateAttribute</span><span class='op'>.</span><span class='nam'>ON</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>root</span><span class='op'>.</span><span class='nam'>setStateSet</span><span class='op'>(</span><span class='nam'>blend</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_generic_frame</span> <span class='op'>=</span> <span class='nam'>draw_frame</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>length</span><span class='op'>=</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span><span class='op'>[</span><span class='str'>&#39;frame length&#39;</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>radius</span><span class='op'>=</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span><span class='op'>[</span><span class='str'>&#39;frame radius&#39;</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>alpha</span><span class='op'>=</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span><span class='op'>[</span><span class='str'>&#39;frame alpha&#39;</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_generic_frame</span><span class='op'>.</span><span class='nam'>setNodeMask</span><span class='op'>(</span><span class='nam'>_MASK</span><span class='op'>[</span><span class='str'>&#39;frame&#39;</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_generic_force</span> <span class='op'>=</span> <span class='nam'>draw_force</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>length</span><span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span><span class='op'>[</span><span class='str'>&#39;force length&#39;</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>radius</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span><span class='op'>[</span><span class='str'>&#39;force radius&#39;</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_body_colors</span> <span class='op'>=</span> <span class='op'>{</span><span class='op'>}</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>registered</span> <span class='op'>=</span> <span class='op'>[</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>frames</span> <span class='op'>=</span> <span class='op'>{</span><span class='op'>}</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>constraint_forces</span> <span class='op'>=</span> <span class='op'>{</span><span class='op'>}</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_world</span> <span class='op'>=</span> <span class='nam'>world</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_register</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_world</span><span class='op'>.</span><span class='nam'>ground</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>viewer</span> <span class='key'>is</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># create the osg viewer:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>viewer</span> <span class='op'>=</span> <span class='nam'>osgViewer</span><span class='op'>.</span><span class='nam'>Viewer</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>viewer</span><span class='op'>.</span><span class='nam'>setSceneData</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>root</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>manipulator</span> <span class='op'>=</span> <span class='nam'>osgGA</span><span class='op'>.</span><span class='nam'>TrackballManipulator</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>viewer</span><span class='op'>.</span><span class='nam'>setCameraManipulator</span><span class='op'>(</span><span class='nam'>manipulator</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># set the position of the camera/view:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>coi</span> <span class='op'>=</span> <span class='nam'>map</span><span class='op'>(</span><span class='nam'>float</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span><span class='op'>[</span><span class='str'>&#39;center of interest&#39;</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>cam</span> <span class='op'>=</span> <span class='nam'>map</span><span class='op'>(</span><span class='nam'>float</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span><span class='op'>[</span><span class='str'>&#39;camera position&#39;</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>up</span> <span class='op'>=</span> <span class='nam'>map</span><span class='op'>(</span><span class='nam'>float</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_world</span><span class='op'>.</span><span class='nam'>up</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>manipulator</span><span class='op'>.</span><span class='nam'>setHomePosition</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3d</span><span class='op'>(</span><span class='nam'>coi</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>+</span><span class='nam'>cam</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>coi</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>+</span><span class='nam'>cam</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>coi</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>+</span><span class='nam'>cam</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3d</span><span class='op'>(</span><span class='nam'>coi</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>coi</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>coi</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3d</span><span class='op'>(</span><span class='nam'>up</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>up</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>up</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># setup the window:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span><span class='op'>[</span><span class='str'>&#39;fullscreen&#39;</span><span class='op'>]</span> <span class='key'>is</span> <span class='nam'>False</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>window_size</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span><span class='op'>[</span><span class='str'>&#39;window size&#39;</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>window_pos</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span><span class='op'>[</span><span class='str'>&#39;window position&#39;</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>viewer</span><span class='op'>.</span><span class='nam'>setUpViewInWindow</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>window_pos</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>window_pos</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>window_size</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>window_size</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>viewer</span><span class='op'>.</span><span class='nam'>home</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>viewer</span> <span class='op'>=</span> <span class='nam'>viewer</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>camera</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>viewer</span><span class='op'>.</span><span class='nam'>getCamera</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#inheritanceMask = (~(osg.CullSettings.CULL_MASK) &amp; osg.CullSettings.ALL_VARIABLES)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#camera.setInheritanceMask(inheritanceMask)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># add an handler for GUI Events (will toggle display on/off):</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>handler</span> <span class='op'>=</span> <span class='nam'>SwitcherHandler</span><span class='op'>(</span><span class='nam'>camera</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>viewer</span><span class='op'>.</span><span class='nam'>addEventHandler</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>handler</span><span class='op'>.</span><span class='nam'>__disown__</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>_choose_color</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>body</span><span class='op'>,</span> <span class='nam'>alpha</span><span class='op'>=</span><span class='num'>1.</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Select a colour in the palette for the body.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>body</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_body_colors</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>color</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_body_colors</span><span class='op'>[</span><span class='nam'>body</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>c</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span><span class='op'>[</span><span class='str'>&#39;body palette&#39;</span><span class='op'>]</span><span class='op'>.</span><span class='nam'>pop</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>color</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec4</span><span class='op'>(</span><span class='nam'>c</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>c</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>c</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>alpha</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_body_colors</span><span class='op'>[</span><span class='nam'>body</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>color</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>except</span> <span class='nam'>IndexError</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>color</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec4</span><span class='op'>(</span><span class='num'>1.</span><span class='op'>,</span> <span class='num'>1.</span><span class='op'>,</span> <span class='num'>1.</span><span class='op'>,</span> <span class='nam'>alpha</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>color</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>_register</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Add the given arboris object ``obj`` to the scene.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; For a single arboris object, several OSG nodes may be added,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; belonging to different categories. For instance,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; registering an object of the :class:`Body` class returns nodes</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; belonging to the ``frame``, ``name`` and ``inertia ellispoid``</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; categories.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; The categories a node belongs to is specified using node masks.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>registered</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>registered</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>opts</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>core</span><span class='op'>.</span><span class='nam'>Frame</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># create a transform for the frames (instances of </span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># the Body and Subframe classes)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>t</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>MatrixTransform</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>frames</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>t</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># draw the frame name:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>name</span> <span class='op'>=</span> <span class='nam'>draw_text</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>name</span><span class='op'>,</span> <span class='nam'>opts</span><span class='op'>[</span><span class='str'>&#39;text size&#39;</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>name</span><span class='op'>.</span><span class='nam'>setNodeMask</span><span class='op'>(</span><span class='nam'>_MASK</span><span class='op'>[</span><span class='str'>&#39;name&#39;</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>t</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>name</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># draw the frame basis:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>t</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_generic_frame</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>core</span><span class='op'>.</span><span class='nam'>Body</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>root</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>t</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>mass</span><span class='op'>[</span><span class='num'>5</span><span class='op'>,</span><span class='num'>5</span><span class='op'>]</span> <span class='op'>!=</span> <span class='num'>0</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># draw the body inertia ellipsoid.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># MatrixTransform() # position</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#&nbsp; |</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># PositionAttitudeTransform() # ellispoid axis scale</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#&nbsp; |</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># Geode()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#&nbsp; |</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># Sphere()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>Mb</span> <span class='op'>=</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>mass</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>color</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_choose_color</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>bHg</span> <span class='op'>=</span> <span class='nam'>massmatrix</span><span class='op'>.</span><span class='nam'>principalframe</span><span class='op'>(</span><span class='nam'>Mb</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>Mg</span> <span class='op'>=</span> <span class='nam'>massmatrix</span><span class='op'>.</span><span class='nam'>transport</span><span class='op'>(</span><span class='nam'>Mb</span><span class='op'>,</span> <span class='nam'>bHg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>shape</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>ShapeDrawable</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Sphere</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3</span><span class='op'>(</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>)</span><span class='op'>,</span> <span class='num'>1.</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>shape</span><span class='op'>.</span><span class='nam'>setColor</span><span class='op'>(</span><span class='nam'>color</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>shape_geo</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Geode</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>shape_geo</span><span class='op'>.</span><span class='nam'>addDrawable</span><span class='op'>(</span><span class='nam'>shape</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>scale_node</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>PositionAttitudeTransform</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>scale_node</span><span class='op'>.</span><span class='nam'>setScale</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3d</span><span class='op'>(</span><span class='nam'>Mg</span><span class='op'>[</span><span class='num'>0</span><span class='op'>,</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>Mg</span><span class='op'>[</span><span class='num'>1</span><span class='op'>,</span><span class='num'>1</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>Mg</span><span class='op'>[</span><span class='num'>2</span><span class='op'>,</span><span class='num'>2</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>scale_node</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>shape_geo</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>gen_scale_node</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>PositionAttitudeTransform</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>gen_scale_node</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>scale_node</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>pos_node</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>MatrixTransform</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>pos_node</span><span class='op'>.</span><span class='nam'>setMatrix</span><span class='op'>(</span><span class='nam'>_pose2mat</span><span class='op'>(</span><span class='nam'>bHg</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>pos_node</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>gen_scale_node</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>pos_node</span><span class='op'>.</span><span class='nam'>setNodeMask</span><span class='op'>(</span><span class='nam'>_MASK</span><span class='op'>[</span><span class='str'>&#39;inertia ellipsoid&#39;</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>frames</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>]</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>pos_node</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>core</span><span class='op'>.</span><span class='nam'>SubFrame</span><span class='op'>)</span> <span class='key'>or</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>core</span><span class='op'>.</span><span class='nam'>MovingSubFrame</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>frames</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>body</span><span class='op'>]</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>t</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># draw a line between the subframe and its parent:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>color</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_choose_color</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>body</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>nl</span> <span class='op'>=</span> <span class='nam'>draw_line</span><span class='op'>(</span><span class='op'>(</span><span class='num'>0</span><span class='op'>,</span><span class='num'>0</span><span class='op'>,</span><span class='num'>0</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='op'>-</span><span class='nam'>dot</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>bpose</span><span class='op'>[</span><span class='num'>0</span><span class='op'>:</span><span class='num'>3</span><span class='op'>,</span><span class='num'>0</span><span class='op'>:</span><span class='num'>3</span><span class='op'>]</span><span class='op'>.</span><span class='nam'>T</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>bpose</span><span class='op'>[</span><span class='num'>0</span><span class='op'>:</span><span class='num'>3</span><span class='op'>,</span><span class='num'>3</span><span class='op'>]</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='nam'>opts</span><span class='op'>[</span><span class='str'>&#39;link radius&#39;</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>color</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>nl</span><span class='op'>.</span><span class='nam'>setNodeMask</span><span class='op'>(</span><span class='nam'>_MASK</span><span class='op'>[</span><span class='str'>&#39;link&#39;</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>frames</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>]</span><span class='op'>.</span> <span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>nl</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>constraints</span><span class='op'>.</span><span class='nam'>SoftFingerContact</span><span class='op'>)</span> <span class='key'>or</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>constraints</span><span class='op'>.</span><span class='nam'>BallAndSocketConstraint</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>t</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>PositionAttitudeTransform</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>constraint_forces</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>t</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>t</span><span class='op'>.</span><span class='nam'>setNodeMask</span><span class='op'>(</span><span class='nam'>_MASK</span><span class='op'>[</span><span class='str'>&#39;constraint force&#39;</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>frames</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>_frames</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>]</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>t</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>t</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_generic_force</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>core</span><span class='op'>.</span><span class='nam'>Shape</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>color</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_choose_color</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>frame</span><span class='op'>.</span><span class='nam'>body</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>shapes</span><span class='op'>.</span><span class='nam'>Sphere</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>shape</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>ShapeDrawable</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Sphere</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3</span><span class='op'>(</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>)</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>radius</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>shapes</span><span class='op'>.</span><span class='nam'>Point</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>shape</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>ShapeDrawable</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Sphere</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3</span><span class='op'>(</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_options</span><span class='op'>[</span><span class='str'>&#39;point radius&#39;</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>shapes</span><span class='op'>.</span><span class='nam'>Box</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>shape</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>ShapeDrawable</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Box</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3</span><span class='op'>(</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>)</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>half_extents</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>*</span><span class='num'>2.</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>half_extents</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>*</span><span class='num'>2</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>half_extents</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>*</span><span class='num'>2</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>shapes</span><span class='op'>.</span><span class='nam'>Cylinder</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>shape</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>ShapeDrawable</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Cylinder</span><span class='op'>(</span><span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3</span><span class='op'>(</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>,</span><span class='num'>0.</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>radius</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>length</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>NotImplemented</span><span class='op'>(</span><span class='str'>&quot;Cannot draw this shape&quot;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>shape</span><span class='op'>.</span><span class='nam'>setColor</span><span class='op'>(</span><span class='nam'>color</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>switch</span> <span class='op'>=</span> <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Switch</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>geode</span> <span class='op'>=</span>&nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Geode</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>geode</span><span class='op'>.</span><span class='nam'>addDrawable</span><span class='op'>(</span><span class='nam'>shape</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>geode</span><span class='op'>.</span><span class='nam'>setNodeMask</span><span class='op'>(</span><span class='nam'>_MASK</span><span class='op'>[</span><span class='str'>&#39;shape&#39;</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>frames</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>frame</span><span class='op'>]</span><span class='op'>.</span><span class='nam'>addChild</span><span class='op'>(</span><span class='nam'>geode</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>core</span><span class='op'>.</span><span class='nam'>Joint</span><span class='op'>)</span> <span class='key'>or</span> <span class='xx'>\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>core</span><span class='op'>.</span><span class='nam'>Constraint</span><span class='op'>)</span> <span class='key'>or</span> <span class='xx'>\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>core</span><span class='op'>.</span><span class='nam'>Controller</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>NotImplemented</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>init</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>world</span><span class='op'>,</span> <span class='nam'>timeline</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_world</span><span class='op'>.</span><span class='nam'>update_geometric</span><span class='op'>(</span><span class='op'>)</span> <span class='com'>#TODO find a way to remove this</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_world</span><span class='op'>.</span><span class='nam'>iterbodies</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_register</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_world</span><span class='op'>.</span><span class='nam'>itersubframes</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_register</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_world</span><span class='op'>.</span><span class='nam'>itershapes</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_register</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_world</span><span class='op'>.</span><span class='nam'>_constraints</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_register</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>key</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>,</span> <span class='nam'>on</span> <span class='key'>in</span> <span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>(</span><span class='nam'>ord</span><span class='op'>(</span><span class='str'>&#39;f&#39;</span><span class='op'>)</span><span class='op'>,</span> <span class='str'>&#39;frame&#39;</span><span class='op'>,</span> <span class='nam'>True</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>(</span><span class='nam'>ord</span><span class='op'>(</span><span class='str'>&#39;i&#39;</span><span class='op'>)</span><span class='op'>,</span> <span class='str'>&#39;inertia ellipsoid&#39;</span><span class='op'>,</span> <span class='nam'>False</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>(</span><span class='nam'>ord</span><span class='op'>(</span><span class='str'>&#39;l&#39;</span><span class='op'>)</span><span class='op'>,</span> <span class='str'>&#39;link&#39;</span><span class='op'>,</span> <span class='nam'>True</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>(</span><span class='nam'>ord</span><span class='op'>(</span><span class='str'>&#39;n&#39;</span><span class='op'>)</span><span class='op'>,</span> <span class='str'>&#39;name&#39;</span><span class='op'>,</span> <span class='nam'>False</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>(</span><span class='nam'>ord</span><span class='op'>(</span><span class='str'>&#39;w&#39;</span><span class='op'>)</span><span class='op'>,</span> <span class='str'>&#39;constraint force&#39;</span><span class='op'>,</span> <span class='nam'>True</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>(</span><span class='nam'>ord</span><span class='op'>(</span><span class='str'>&#39;g&#39;</span><span class='op'>)</span><span class='op'>,</span> <span class='str'>&#39;shape&#39;</span><span class='op'>,</span> <span class='nam'>True</span><span class='op'>)</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>handler</span><span class='op'>.</span><span class='nam'>add_category</span><span class='op'>(</span><span class='nam'>key</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>,</span> <span class='nam'>on</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>update</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>dt</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_world</span><span class='op'>.</span><span class='nam'>itersubframes</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>frames</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>]</span><span class='op'>.</span><span class='nam'>setMatrix</span><span class='op'>(</span><span class='nam'>_pose2mat</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>bpose</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_world</span><span class='op'>.</span><span class='nam'>iterbodies</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>frames</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>]</span><span class='op'>.</span><span class='nam'>setMatrix</span><span class='op'>(</span><span class='nam'>_pose2mat</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>pose</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_world</span><span class='op'>.</span><span class='nam'>iterconstraints</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>is_active</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>from</span> <span class='nam'>numpy</span><span class='op'>.</span><span class='nam'>linalg</span> <span class='key'>import</span> <span class='nam'>norm</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># scale the generic_force according to the force</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># norm. We constraint the scaling to be in [0.1, 10]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span><span class='nam'>constraints</span><span class='op'>.</span><span class='nam'>SoftFingerContact</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>force</span> <span class='op'>=</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>_force</span><span class='op'>[</span><span class='num'>1</span><span class='op'>:</span><span class='num'>4</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span><span class='nam'>constraints</span><span class='op'>.</span><span class='nam'>BallAndSocketConstraint</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>force</span> <span class='op'>=</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>_force</span><span class='op'>[</span><span class='num'>0</span><span class='op'>:</span><span class='num'>3</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>scale</span> <span class='op'>=</span> <span class='nam'>min</span><span class='op'>(</span><span class='num'>10.</span><span class='op'>,</span> <span class='nam'>max</span><span class='op'>(</span><span class='num'>0.1</span><span class='op'>,</span> <span class='nam'>norm</span><span class='op'>(</span><span class='nam'>force</span><span class='op'>)</span><span class='op'>/</span><span class='num'>100</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>constraint_forces</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>]</span><span class='op'>.</span><span class='nam'>setScale</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>osg</span><span class='op'>.</span><span class='nam'>Vec3d</span><span class='op'>(</span><span class='nam'>scale</span><span class='op'>,</span><span class='nam'>scale</span><span class='op'>,</span><span class='nam'>scale</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>_align_z_with_vector</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>_force</span><span class='op'>[</span><span class='num'>1</span><span class='op'>:</span><span class='num'>4</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>constraint_forces</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>constraint_forces</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>]</span><span class='op'>.</span><span class='nam'>setNodeMask</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>_MASK</span><span class='op'>[</span><span class='str'>&#39;constraint force&#39;</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>constraint_forces</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>]</span><span class='op'>.</span><span class='nam'>setNodeMask</span><span class='op'>(</span><span class='num'>0</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>viewer</span><span class='op'>.</span><span class='nam'>frame</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>done</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>viewer</span><span class='op'>.</span><span class='nam'>done</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>finish</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
    
</td>
</tr>
</table>
</div>

</body>
</html>
