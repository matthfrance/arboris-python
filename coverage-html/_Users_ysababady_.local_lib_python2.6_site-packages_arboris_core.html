<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
<title>Coverage for /Users/ysababady/.local/lib/python2.6/site-packages/arboris/core</title>
<link rel='stylesheet' href='style.css' type='text/css'>
<script type='text/javascript' src='jquery-1.3.2.min.js'></script>
<script type='text/javascript'>
function toggle_lines(btn, cls) {
    var btn = $(btn);
    var hide = "hide_"+cls;
    if (btn.hasClass(hide)) {
        $("#source ."+cls).removeClass(hide);
        btn.removeClass(hide);
    }
    else {
        $("#source ."+cls).addClass(hide);
        btn.addClass(hide);
    }
}
</script>
</head>
<body>
<div id='header'>
    <div class='content'>
        <h1>Coverage for <b>/Users/ysababady/.local/lib/python2.6/site-packages/arboris/core</b> :
            <span class='pc_cov'>86%</span>
        </h1>
        <h2 class='stats'>
            496 statements
            <span class='run hide_run' onclick='toggle_lines(this, "run")'>426 run</span>
            <span class='exc' onclick='toggle_lines(this, "exc")'>0 excluded</span>
            <span class='mis' onclick='toggle_lines(this, "mis")'>70 missing</span>
            
        </h2>
    </div>
</div>

<div id='source'>
<table cellspacing='0' cellpadding='0'>
<tr>
<td class='linenos' valign='top'>
<p class='pln'>1</p>
<p class='stm run hide_run'>2</p>
<p class='pln'>3</p>
<p class='pln'>4</p>
<p class='pln'>5</p>
<p class='pln'>6</p>
<p class='pln'>7</p>
<p class='pln'>8</p>
<p class='pln'>9</p>
<p class='pln'>10</p>
<p class='pln'>11</p>
<p class='pln'>12</p>
<p class='pln'>13</p>
<p class='pln'>14</p>
<p class='pln'>15</p>
<p class='pln'>16</p>
<p class='stm run hide_run'>17</p>
<p class='pln'>18</p>
<p class='stm run hide_run'>19</p>
<p class='stm run hide_run'>20</p>
<p class='stm run hide_run'>21</p>
<p class='stm run hide_run'>22</p>
<p class='stm run hide_run'>23</p>
<p class='pln'>24</p>
<p class='pln'>25</p>
<p class='stm run hide_run'>26</p>
<p class='stm run hide_run'>27</p>
<p class='stm run hide_run'>28</p>
<p class='stm run hide_run'>29</p>
<p class='stm run hide_run'>30</p>
<p class='pln'>31</p>
<p class='stm run hide_run'>32</p>
<p class='pln'>33</p>
<p class='pln'>34</p>
<p class='pln'>35</p>
<p class='pln'>36</p>
<p class='stm run hide_run'>37</p>
<p class='stm run hide_run'>38</p>
<p class='pln'>39</p>
<p class='stm run hide_run'>40</p>
<p class='stm mis'>41</p>
<p class='stm mis'>42</p>
<p class='pln'>43</p>
<p class='stm mis'>44</p>
<p class='pln'>45</p>
<p class='pln'>46</p>
<p class='pln'>47</p>
<p class='pln'>48</p>
<p class='pln'>49</p>
<p class='stm run hide_run'>50</p>
<p class='pln'>51</p>
<p class='pln'>52</p>
<p class='pln'>53</p>
<p class='pln'>54</p>
<p class='pln'>55</p>
<p class='pln'>56</p>
<p class='pln'>57</p>
<p class='pln'>58</p>
<p class='pln'>59</p>
<p class='pln'>60</p>
<p class='pln'>61</p>
<p class='pln'>62</p>
<p class='pln'>63</p>
<p class='pln'>64</p>
<p class='pln'>65</p>
<p class='pln'>66</p>
<p class='pln'>67</p>
<p class='pln'>68</p>
<p class='pln'>69</p>
<p class='pln'>70</p>
<p class='pln'>71</p>
<p class='pln'>72</p>
<p class='pln'>73</p>
<p class='pln'>74</p>
<p class='pln'>75</p>
<p class='pln'>76</p>
<p class='pln'>77</p>
<p class='pln'>78</p>
<p class='pln'>79</p>
<p class='pln'>80</p>
<p class='stm run hide_run'>81</p>
<p class='stm run hide_run'>82</p>
<p class='pln'>83</p>
<p class='stm run hide_run'>84</p>
<p class='stm mis'>85</p>
<p class='stm mis'>86</p>
<p class='stm mis'>87</p>
<p class='stm mis'>88</p>
<p class='stm mis'>89</p>
<p class='pln'>90</p>
<p class='stm run hide_run'>91</p>
<p class='stm run hide_run'>92</p>
<p class='pln'>93</p>
<p class='stm run hide_run'>94</p>
<p class='stm run hide_run'>95</p>
<p class='stm run hide_run'>96</p>
<p class='stm mis'>97</p>
<p class='pln'>98</p>
<p class='stm run hide_run'>99</p>
<p class='pln'>100</p>
<p class='stm run hide_run'>101</p>
<p class='pln'>102</p>
<p class='pln'>103</p>
<p class='pln'>104</p>
<p class='pln'>105</p>
<p class='pln'>106</p>
<p class='pln'>107</p>
<p class='stm mis'>108</p>
<p class='stm mis'>109</p>
<p class='stm mis'>110</p>
<p class='stm mis'>111</p>
<p class='stm mis'>112</p>
<p class='pln'>113</p>
<p class='stm mis'>114</p>
<p class='stm mis'>115</p>
<p class='pln'>116</p>
<p class='stm run hide_run'>117</p>
<p class='stm run hide_run'>118</p>
<p class='pln'>119</p>
<p class='pln'>120</p>
<p class='stm run hide_run'>121</p>
<p class='pln'>122</p>
<p class='pln'>123</p>
<p class='stm run hide_run'>124</p>
<p class='pln'>125</p>
<p class='stm run hide_run'>126</p>
<p class='pln'>127</p>
<p class='stm mis'>128</p>
<p class='pln'>129</p>
<p class='stm run hide_run'>130</p>
<p class='pln'>131</p>
<p class='stm mis'>132</p>
<p class='pln'>133</p>
<p class='stm run hide_run'>134</p>
<p class='pln'>135</p>
<p class='stm mis'>136</p>
<p class='pln'>137</p>
<p class='stm run hide_run'>138</p>
<p class='pln'>139</p>
<p class='stm mis'>140</p>
<p class='pln'>141</p>
<p class='stm run hide_run'>142</p>
<p class='pln'>143</p>
<p class='stm mis'>144</p>
<p class='pln'>145</p>
<p class='stm run hide_run'>146</p>
<p class='pln'>147</p>
<p class='stm mis'>148</p>
<p class='pln'>149</p>
<p class='stm run hide_run'>150</p>
<p class='pln'>151</p>
<p class='pln'>152</p>
<p class='pln'>153</p>
<p class='pln'>154</p>
<p class='pln'>155</p>
<p class='pln'>156</p>
<p class='pln'>157</p>
<p class='pln'>158</p>
<p class='pln'>159</p>
<p class='pln'>160</p>
<p class='pln'>161</p>
<p class='stm run hide_run'>162</p>
<p class='pln'>163</p>
<p class='stm run hide_run'>164</p>
<p class='stm run hide_run'>165</p>
<p class='stm run hide_run'>166</p>
<p class='stm run hide_run'>167</p>
<p class='stm run hide_run'>168</p>
<p class='pln'>169</p>
<p class='stm run hide_run'>170</p>
<p class='pln'>171</p>
<p class='pln'>172</p>
<p class='pln'>173</p>
<p class='stm mis'>174</p>
<p class='pln'>175</p>
<p class='stm run hide_run'>176</p>
<p class='pln'>177</p>
<p class='stm run hide_run'>178</p>
<p class='stm mis'>179</p>
<p class='pln'>180</p>
<p class='stm run hide_run'>181</p>
<p class='pln'>182</p>
<p class='stm run hide_run'>183</p>
<p class='pln'>184</p>
<p class='pln'>185</p>
<p class='pln'>186</p>
<p class='stm mis'>187</p>
<p class='pln'>188</p>
<p class='stm run hide_run'>189</p>
<p class='pln'>190</p>
<p class='pln'>191</p>
<p class='pln'>192</p>
<p class='stm run hide_run'>193</p>
<p class='pln'>194</p>
<p class='stm run hide_run'>195</p>
<p class='pln'>196</p>
<p class='pln'>197</p>
<p class='pln'>198</p>
<p class='pln'>199</p>
<p class='pln'>200</p>
<p class='pln'>201</p>
<p class='pln'>202</p>
<p class='pln'>203</p>
<p class='stm mis'>204</p>
<p class='pln'>205</p>
<p class='stm run hide_run'>206</p>
<p class='pln'>207</p>
<p class='stm mis'>208</p>
<p class='pln'>209</p>
<p class='stm run hide_run'>210</p>
<p class='pln'>211</p>
<p class='stm mis'>212</p>
<p class='pln'>213</p>
<p class='pln'>214</p>
<p class='stm run hide_run'>215</p>
<p class='pln'>216</p>
<p class='pln'>217</p>
<p class='pln'>218</p>
<p class='stm run hide_run'>219</p>
<p class='stm run hide_run'>220</p>
<p class='stm run hide_run'>221</p>
<p class='pln'>222</p>
<p class='stm run hide_run'>223</p>
<p class='stm run hide_run'>224</p>
<p class='stm run hide_run'>225</p>
<p class='pln'>226</p>
<p class='stm run hide_run'>227</p>
<p class='stm run hide_run'>228</p>
<p class='pln'>229</p>
<p class='stm run hide_run'>230</p>
<p class='stm run hide_run'>231</p>
<p class='stm run hide_run'>232</p>
<p class='pln'>233</p>
<p class='pln'>234</p>
<p class='stm run hide_run'>235</p>
<p class='stm run hide_run'>236</p>
<p class='stm run hide_run'>237</p>
<p class='stm run hide_run'>238</p>
<p class='pln'>239</p>
<p class='stm run hide_run'>240</p>
<p class='stm run hide_run'>241</p>
<p class='stm run hide_run'>242</p>
<p class='stm run hide_run'>243</p>
<p class='stm run hide_run'>244</p>
<p class='stm run hide_run'>245</p>
<p class='stm run hide_run'>246</p>
<p class='stm run hide_run'>247</p>
<p class='pln'>248</p>
<p class='stm run hide_run'>249</p>
<p class='pln'>250</p>
<p class='pln'>251</p>
<p class='stm mis'>252</p>
<p class='stm mis'>253</p>
<p class='pln'>254</p>
<p class='stm mis'>255</p>
<p class='pln'>256</p>
<p class='stm run hide_run'>257</p>
<p class='pln'>258</p>
<p class='stm mis'>259</p>
<p class='pln'>260</p>
<p class='stm run hide_run'>261</p>
<p class='stm run hide_run'>262</p>
<p class='pln'>263</p>
<p class='stm run hide_run'>264</p>
<p class='stm mis'>265</p>
<p class='pln'>266</p>
<p class='stm run hide_run'>267</p>
<p class='pln'>268</p>
<p class='stm mis'>269</p>
<p class='pln'>270</p>
<p class='stm run hide_run'>271</p>
<p class='pln'>272</p>
<p class='stm run hide_run'>273</p>
<p class='pln'>274</p>
<p class='stm run hide_run'>275</p>
<p class='pln'>276</p>
<p class='stm mis'>277</p>
<p class='pln'>278</p>
<p class='stm run hide_run'>279</p>
<p class='pln'>280</p>
<p class='pln'>281</p>
<p class='pln'>282</p>
<p class='pln'>283</p>
<p class='pln'>284</p>
<p class='stm mis'>285</p>
<p class='pln'>286</p>
<p class='stm run hide_run'>287</p>
<p class='pln'>288</p>
<p class='stm mis'>289</p>
<p class='pln'>290</p>
<p class='stm run hide_run'>291</p>
<p class='pln'>292</p>
<p class='stm mis'>293</p>
<p class='pln'>294</p>
<p class='stm run hide_run'>295</p>
<p class='pln'>296</p>
<p class='stm mis'>297</p>
<p class='pln'>298</p>
<p class='pln'>299</p>
<p class='stm run hide_run'>300</p>
<p class='pln'>301</p>
<p class='pln'>302</p>
<p class='stm run hide_run'>303</p>
<p class='stm run hide_run'>304</p>
<p class='stm run hide_run'>305</p>
<p class='stm run hide_run'>306</p>
<p class='pln'>307</p>
<p class='pln'>308</p>
<p class='stm run hide_run'>309</p>
<p class='stm run hide_run'>310</p>
<p class='pln'>311</p>
<p class='stm run hide_run'>312</p>
<p class='stm run hide_run'>313</p>
<p class='pln'>314</p>
<p class='stm run hide_run'>315</p>
<p class='pln'>316</p>
<p class='stm mis'>317</p>
<p class='pln'>318</p>
<p class='stm run hide_run'>319</p>
<p class='pln'>320</p>
<p class='stm mis'>321</p>
<p class='pln'>322</p>
<p class='pln'>323</p>
<p class='stm run hide_run'>324</p>
<p class='pln'>325</p>
<p class='pln'>326</p>
<p class='pln'>327</p>
<p class='pln'>328</p>
<p class='stm run hide_run'>329</p>
<p class='stm run hide_run'>330</p>
<p class='stm run hide_run'>331</p>
<p class='stm run hide_run'>332</p>
<p class='stm run hide_run'>333</p>
<p class='stm run hide_run'>334</p>
<p class='stm run hide_run'>335</p>
<p class='stm run hide_run'>336</p>
<p class='stm run hide_run'>337</p>
<p class='stm run hide_run'>338</p>
<p class='stm run hide_run'>339</p>
<p class='stm run hide_run'>340</p>
<p class='stm run hide_run'>341</p>
<p class='stm run hide_run'>342</p>
<p class='stm run hide_run'>343</p>
<p class='stm run hide_run'>344</p>
<p class='stm run hide_run'>345</p>
<p class='pln'>346</p>
<p class='stm run hide_run'>347</p>
<p class='pln'>348</p>
<p class='stm run hide_run'>349</p>
<p class='stm run hide_run'>350</p>
<p class='stm run hide_run'>351</p>
<p class='pln'>352</p>
<p class='stm run hide_run'>353</p>
<p class='pln'>354</p>
<p class='pln'>355</p>
<p class='stm run hide_run'>356</p>
<p class='pln'>357</p>
<p class='stm run hide_run'>358</p>
<p class='pln'>359</p>
<p class='stm mis'>360</p>
<p class='stm mis'>361</p>
<p class='pln'>362</p>
<p class='stm run hide_run'>363</p>
<p class='pln'>364</p>
<p class='stm run hide_run'>365</p>
<p class='stm run hide_run'>366</p>
<p class='pln'>367</p>
<p class='stm run hide_run'>368</p>
<p class='pln'>369</p>
<p class='stm run hide_run'>370</p>
<p class='stm run hide_run'>371</p>
<p class='stm run hide_run'>372</p>
<p class='stm run hide_run'>373</p>
<p class='pln'>374</p>
<p class='stm run hide_run'>375</p>
<p class='pln'>376</p>
<p class='pln'>377</p>
<p class='stm mis'>378</p>
<p class='stm mis'>379</p>
<p class='stm mis'>380</p>
<p class='pln'>381</p>
<p class='stm run hide_run'>382</p>
<p class='pln'>383</p>
<p class='stm mis'>384</p>
<p class='stm mis'>385</p>
<p class='pln'>386</p>
<p class='stm run hide_run'>387</p>
<p class='pln'>388</p>
<p class='pln'>389</p>
<p class='stm mis'>390</p>
<p class='pln'>391</p>
<p class='stm run hide_run'>392</p>
<p class='pln'>393</p>
<p class='stm run hide_run'>394</p>
<p class='stm run hide_run'>395</p>
<p class='pln'>396</p>
<p class='stm run hide_run'>397</p>
<p class='pln'>398</p>
<p class='pln'>399</p>
<p class='pln'>400</p>
<p class='pln'>401</p>
<p class='pln'>402</p>
<p class='pln'>403</p>
<p class='pln'>404</p>
<p class='pln'>405</p>
<p class='pln'>406</p>
<p class='pln'>407</p>
<p class='pln'>408</p>
<p class='pln'>409</p>
<p class='pln'>410</p>
<p class='pln'>411</p>
<p class='stm run hide_run'>412</p>
<p class='pln'>413</p>
<p class='stm run hide_run'>414</p>
<p class='pln'>415</p>
<p class='pln'>416</p>
<p class='pln'>417</p>
<p class='pln'>418</p>
<p class='pln'>419</p>
<p class='pln'>420</p>
<p class='pln'>421</p>
<p class='pln'>422</p>
<p class='pln'>423</p>
<p class='pln'>424</p>
<p class='pln'>425</p>
<p class='pln'>426</p>
<p class='stm run hide_run'>427</p>
<p class='stm run hide_run'>428</p>
<p class='stm run hide_run'>429</p>
<p class='stm run hide_run'>430</p>
<p class='stm run hide_run'>431</p>
<p class='stm run hide_run'>432</p>
<p class='stm run hide_run'>433</p>
<p class='stm run hide_run'>434</p>
<p class='stm run hide_run'>435</p>
<p class='stm run hide_run'>436</p>
<p class='pln'>437</p>
<p class='stm mis'>438</p>
<p class='pln'>439</p>
<p class='stm run hide_run'>440</p>
<p class='stm run hide_run'>441</p>
<p class='stm run hide_run'>442</p>
<p class='stm run hide_run'>443</p>
<p class='stm mis'>444</p>
<p class='pln'>445</p>
<p class='stm run hide_run'>446</p>
<p class='pln'>447</p>
<p class='pln'>448</p>
<p class='pln'>449</p>
<p class='pln'>450</p>
<p class='pln'>451</p>
<p class='pln'>452</p>
<p class='pln'>453</p>
<p class='pln'>454</p>
<p class='pln'>455</p>
<p class='pln'>456</p>
<p class='pln'>457</p>
<p class='pln'>458</p>
<p class='pln'>459</p>
<p class='pln'>460</p>
<p class='pln'>461</p>
<p class='stm run hide_run'>462</p>
<p class='stm run hide_run'>463</p>
<p class='stm run hide_run'>464</p>
<p class='stm run hide_run'>465</p>
<p class='stm run hide_run'>466</p>
<p class='stm run hide_run'>467</p>
<p class='stm run hide_run'>468</p>
<p class='stm run hide_run'>469</p>
<p class='stm run hide_run'>470</p>
<p class='stm mis'>471</p>
<p class='pln'>472</p>
<p class='stm run hide_run'>473</p>
<p class='stm run hide_run'>474</p>
<p class='stm run hide_run'>475</p>
<p class='stm run hide_run'>476</p>
<p class='stm run hide_run'>477</p>
<p class='stm run hide_run'>478</p>
<p class='stm run hide_run'>479</p>
<p class='stm run hide_run'>480</p>
<p class='pln'>481</p>
<p class='pln'>482</p>
<p class='pln'>483</p>
<p class='stm run hide_run'>484</p>
<p class='stm run hide_run'>485</p>
<p class='stm run hide_run'>486</p>
<p class='pln'>487</p>
<p class='stm run hide_run'>488</p>
<p class='pln'>489</p>
<p class='pln'>490</p>
<p class='pln'>491</p>
<p class='pln'>492</p>
<p class='pln'>493</p>
<p class='pln'>494</p>
<p class='pln'>495</p>
<p class='pln'>496</p>
<p class='pln'>497</p>
<p class='pln'>498</p>
<p class='pln'>499</p>
<p class='pln'>500</p>
<p class='pln'>501</p>
<p class='pln'>502</p>
<p class='pln'>503</p>
<p class='pln'>504</p>
<p class='pln'>505</p>
<p class='pln'>506</p>
<p class='pln'>507</p>
<p class='pln'>508</p>
<p class='pln'>509</p>
<p class='pln'>510</p>
<p class='pln'>511</p>
<p class='stm run hide_run'>512</p>
<p class='stm run hide_run'>513</p>
<p class='stm run hide_run'>514</p>
<p class='stm mis'>515</p>
<p class='stm run hide_run'>516</p>
<p class='stm run hide_run'>517</p>
<p class='stm run hide_run'>518</p>
<p class='stm run hide_run'>519</p>
<p class='stm run hide_run'>520</p>
<p class='stm run hide_run'>521</p>
<p class='stm run hide_run'>522</p>
<p class='stm run hide_run'>523</p>
<p class='stm run hide_run'>524</p>
<p class='stm run hide_run'>525</p>
<p class='stm run hide_run'>526</p>
<p class='stm run hide_run'>527</p>
<p class='pln'>528</p>
<p class='stm run hide_run'>529</p>
<p class='stm run hide_run'>530</p>
<p class='stm run hide_run'>531</p>
<p class='stm run hide_run'>532</p>
<p class='stm run hide_run'>533</p>
<p class='pln'>534</p>
<p class='stm mis'>535</p>
<p class='pln'>536</p>
<p class='pln'>537</p>
<p class='stm run hide_run'>538</p>
<p class='pln'>539</p>
<p class='pln'>540</p>
<p class='stm run hide_run'>541</p>
<p class='stm run hide_run'>542</p>
<p class='stm run hide_run'>543</p>
<p class='stm run hide_run'>544</p>
<p class='stm run hide_run'>545</p>
<p class='pln'>546</p>
<p class='pln'>547</p>
<p class='pln'>548</p>
<p class='stm run hide_run'>549</p>
<p class='stm run hide_run'>550</p>
<p class='stm run hide_run'>551</p>
<p class='stm run hide_run'>552</p>
<p class='stm run hide_run'>553</p>
<p class='pln'>554</p>
<p class='pln'>555</p>
<p class='stm run hide_run'>556</p>
<p class='stm run hide_run'>557</p>
<p class='stm run hide_run'>558</p>
<p class='stm run hide_run'>559</p>
<p class='pln'>560</p>
<p class='stm run hide_run'>561</p>
<p class='stm run hide_run'>562</p>
<p class='pln'>563</p>
<p class='stm run hide_run'>564</p>
<p class='stm run hide_run'>565</p>
<p class='pln'>566</p>
<p class='stm run hide_run'>567</p>
<p class='pln'>568</p>
<p class='stm mis'>569</p>
<p class='pln'>570</p>
<p class='stm run hide_run'>571</p>
<p class='pln'>572</p>
<p class='stm run hide_run'>573</p>
<p class='pln'>574</p>
<p class='stm run hide_run'>575</p>
<p class='pln'>576</p>
<p class='stm run hide_run'>577</p>
<p class='pln'>578</p>
<p class='stm run hide_run'>579</p>
<p class='pln'>580</p>
<p class='stm run hide_run'>581</p>
<p class='pln'>582</p>
<p class='stm run hide_run'>583</p>
<p class='pln'>584</p>
<p class='stm run hide_run'>585</p>
<p class='pln'>586</p>
<p class='stm run hide_run'>587</p>
<p class='pln'>588</p>
<p class='stm run hide_run'>589</p>
<p class='pln'>590</p>
<p class='stm run hide_run'>591</p>
<p class='pln'>592</p>
<p class='stm mis'>593</p>
<p class='pln'>594</p>
<p class='stm run hide_run'>595</p>
<p class='pln'>596</p>
<p class='pln'>597</p>
<p class='pln'>598</p>
<p class='pln'>599</p>
<p class='pln'>600</p>
<p class='pln'>601</p>
<p class='pln'>602</p>
<p class='pln'>603</p>
<p class='pln'>604</p>
<p class='pln'>605</p>
<p class='stm run hide_run'>606</p>
<p class='pln'>607</p>
<p class='stm run hide_run'>608</p>
<p class='pln'>609</p>
<p class='pln'>610</p>
<p class='pln'>611</p>
<p class='pln'>612</p>
<p class='pln'>613</p>
<p class='pln'>614</p>
<p class='stm mis'>615</p>
<p class='pln'>616</p>
<p class='stm run hide_run'>617</p>
<p class='pln'>618</p>
<p class='pln'>619</p>
<p class='pln'>620</p>
<p class='pln'>621</p>
<p class='pln'>622</p>
<p class='pln'>623</p>
<p class='pln'>624</p>
<p class='pln'>625</p>
<p class='pln'>626</p>
<p class='pln'>627</p>
<p class='pln'>628</p>
<p class='pln'>629</p>
<p class='pln'>630</p>
<p class='pln'>631</p>
<p class='pln'>632</p>
<p class='pln'>633</p>
<p class='pln'>634</p>
<p class='pln'>635</p>
<p class='pln'>636</p>
<p class='pln'>637</p>
<p class='pln'>638</p>
<p class='pln'>639</p>
<p class='pln'>640</p>
<p class='pln'>641</p>
<p class='pln'>642</p>
<p class='pln'>643</p>
<p class='pln'>644</p>
<p class='pln'>645</p>
<p class='pln'>646</p>
<p class='pln'>647</p>
<p class='pln'>648</p>
<p class='pln'>649</p>
<p class='pln'>650</p>
<p class='stm run hide_run'>651</p>
<p class='pln'>652</p>
<p class='pln'>653</p>
<p class='pln'>654</p>
<p class='pln'>655</p>
<p class='pln'>656</p>
<p class='stm run hide_run'>657</p>
<p class='stm run hide_run'>658</p>
<p class='stm run hide_run'>659</p>
<p class='stm run hide_run'>660</p>
<p class='stm run hide_run'>661</p>
<p class='pln'>662</p>
<p class='pln'>663</p>
<p class='stm run hide_run'>664</p>
<p class='pln'>665</p>
<p class='pln'>666</p>
<p class='stm run hide_run'>667</p>
<p class='pln'>668</p>
<p class='pln'>669</p>
<p class='pln'>670</p>
<p class='stm run hide_run'>671</p>
<p class='pln'>672</p>
<p class='pln'>673</p>
<p class='pln'>674</p>
<p class='pln'>675</p>
<p class='pln'>676</p>
<p class='pln'>677</p>
<p class='pln'>678</p>
<p class='pln'>679</p>
<p class='pln'>680</p>
<p class='pln'>681</p>
<p class='pln'>682</p>
<p class='pln'>683</p>
<p class='pln'>684</p>
<p class='pln'>685</p>
<p class='pln'>686</p>
<p class='pln'>687</p>
<p class='pln'>688</p>
<p class='pln'>689</p>
<p class='pln'>690</p>
<p class='pln'>691</p>
<p class='pln'>692</p>
<p class='pln'>693</p>
<p class='pln'>694</p>
<p class='pln'>695</p>
<p class='pln'>696</p>
<p class='pln'>697</p>
<p class='pln'>698</p>
<p class='pln'>699</p>
<p class='pln'>700</p>
<p class='pln'>701</p>
<p class='pln'>702</p>
<p class='pln'>703</p>
<p class='pln'>704</p>
<p class='pln'>705</p>
<p class='pln'>706</p>
<p class='pln'>707</p>
<p class='pln'>708</p>
<p class='pln'>709</p>
<p class='pln'>710</p>
<p class='pln'>711</p>
<p class='pln'>712</p>
<p class='pln'>713</p>
<p class='pln'>714</p>
<p class='pln'>715</p>
<p class='pln'>716</p>
<p class='pln'>717</p>
<p class='pln'>718</p>
<p class='pln'>719</p>
<p class='pln'>720</p>
<p class='pln'>721</p>
<p class='pln'>722</p>
<p class='pln'>723</p>
<p class='pln'>724</p>
<p class='pln'>725</p>
<p class='pln'>726</p>
<p class='pln'>727</p>
<p class='pln'>728</p>
<p class='pln'>729</p>
<p class='pln'>730</p>
<p class='pln'>731</p>
<p class='pln'>732</p>
<p class='pln'>733</p>
<p class='pln'>734</p>
<p class='pln'>735</p>
<p class='pln'>736</p>
<p class='pln'>737</p>
<p class='pln'>738</p>
<p class='pln'>739</p>
<p class='pln'>740</p>
<p class='pln'>741</p>
<p class='pln'>742</p>
<p class='pln'>743</p>
<p class='pln'>744</p>
<p class='pln'>745</p>
<p class='stm run hide_run'>746</p>
<p class='stm run hide_run'>747</p>
<p class='stm run hide_run'>748</p>
<p class='stm run hide_run'>749</p>
<p class='stm run hide_run'>750</p>
<p class='stm run hide_run'>751</p>
<p class='stm run hide_run'>752</p>
<p class='stm run hide_run'>753</p>
<p class='pln'>754</p>
<p class='stm run hide_run'>755</p>
<p class='pln'>756</p>
<p class='pln'>757</p>
<p class='pln'>758</p>
<p class='pln'>759</p>
<p class='pln'>760</p>
<p class='pln'>761</p>
<p class='pln'>762</p>
<p class='pln'>763</p>
<p class='pln'>764</p>
<p class='pln'>765</p>
<p class='pln'>766</p>
<p class='pln'>767</p>
<p class='pln'>768</p>
<p class='pln'>769</p>
<p class='pln'>770</p>
<p class='pln'>771</p>
<p class='pln'>772</p>
<p class='pln'>773</p>
<p class='pln'>774</p>
<p class='pln'>775</p>
<p class='pln'>776</p>
<p class='pln'>777</p>
<p class='pln'>778</p>
<p class='pln'>779</p>
<p class='pln'>780</p>
<p class='pln'>781</p>
<p class='pln'>782</p>
<p class='pln'>783</p>
<p class='pln'>784</p>
<p class='pln'>785</p>
<p class='pln'>786</p>
<p class='pln'>787</p>
<p class='pln'>788</p>
<p class='pln'>789</p>
<p class='pln'>790</p>
<p class='pln'>791</p>
<p class='pln'>792</p>
<p class='pln'>793</p>
<p class='pln'>794</p>
<p class='pln'>795</p>
<p class='pln'>796</p>
<p class='pln'>797</p>
<p class='pln'>798</p>
<p class='pln'>799</p>
<p class='pln'>800</p>
<p class='pln'>801</p>
<p class='pln'>802</p>
<p class='pln'>803</p>
<p class='pln'>804</p>
<p class='pln'>805</p>
<p class='pln'>806</p>
<p class='pln'>807</p>
<p class='pln'>808</p>
<p class='pln'>809</p>
<p class='pln'>810</p>
<p class='pln'>811</p>
<p class='pln'>812</p>
<p class='pln'>813</p>
<p class='pln'>814</p>
<p class='pln'>815</p>
<p class='pln'>816</p>
<p class='pln'>817</p>
<p class='pln'>818</p>
<p class='pln'>819</p>
<p class='pln'>820</p>
<p class='pln'>821</p>
<p class='pln'>822</p>
<p class='pln'>823</p>
<p class='pln'>824</p>
<p class='pln'>825</p>
<p class='pln'>826</p>
<p class='pln'>827</p>
<p class='pln'>828</p>
<p class='pln'>829</p>
<p class='pln'>830</p>
<p class='pln'>831</p>
<p class='pln'>832</p>
<p class='pln'>833</p>
<p class='pln'>834</p>
<p class='pln'>835</p>
<p class='pln'>836</p>
<p class='pln'>837</p>
<p class='pln'>838</p>
<p class='pln'>839</p>
<p class='pln'>840</p>
<p class='pln'>841</p>
<p class='pln'>842</p>
<p class='pln'>843</p>
<p class='pln'>844</p>
<p class='stm run hide_run'>845</p>
<p class='stm run hide_run'>846</p>
<p class='stm run hide_run'>847</p>
<p class='stm run hide_run'>848</p>
<p class='stm run hide_run'>849</p>
<p class='stm run hide_run'>850</p>
<p class='stm run hide_run'>851</p>
<p class='stm run hide_run'>852</p>
<p class='stm run hide_run'>853</p>
<p class='stm run hide_run'>854</p>
<p class='stm run hide_run'>855</p>
<p class='stm run hide_run'>856</p>
<p class='stm run hide_run'>857</p>
<p class='stm run hide_run'>858</p>
<p class='stm run hide_run'>859</p>
<p class='pln'>860</p>
<p class='stm run hide_run'>861</p>
<p class='pln'>862</p>
<p class='stm run hide_run'>863</p>
<p class='stm run hide_run'>864</p>
<p class='pln'>865</p>
<p class='stm run hide_run'>866</p>
<p class='stm run hide_run'>867</p>
<p class='stm run hide_run'>868</p>
<p class='stm run hide_run'>869</p>
<p class='stm run hide_run'>870</p>
<p class='stm run hide_run'>871</p>
<p class='pln'>872</p>
<p class='stm run hide_run'>873</p>
<p class='pln'>874</p>
<p class='pln'>875</p>
<p class='pln'>876</p>
<p class='pln'>877</p>
<p class='pln'>878</p>
<p class='pln'>879</p>
<p class='pln'>880</p>
<p class='pln'>881</p>
<p class='pln'>882</p>
<p class='pln'>883</p>
<p class='pln'>884</p>
<p class='pln'>885</p>
<p class='pln'>886</p>
<p class='pln'>887</p>
<p class='pln'>888</p>
<p class='pln'>889</p>
<p class='pln'>890</p>
<p class='pln'>891</p>
<p class='pln'>892</p>
<p class='pln'>893</p>
<p class='pln'>894</p>
<p class='pln'>895</p>
<p class='pln'>896</p>
<p class='pln'>897</p>
<p class='pln'>898</p>
<p class='pln'>899</p>
<p class='pln'>900</p>
<p class='pln'>901</p>
<p class='pln'>902</p>
<p class='pln'>903</p>
<p class='pln'>904</p>
<p class='pln'>905</p>
<p class='pln'>906</p>
<p class='pln'>907</p>
<p class='stm run hide_run'>908</p>
<p class='stm run hide_run'>909</p>
<p class='pln'>910</p>
<p class='pln'>911</p>
<p class='stm run hide_run'>912</p>
<p class='stm run hide_run'>913</p>
<p class='stm run hide_run'>914</p>
<p class='pln'>915</p>
<p class='pln'>916</p>
<p class='stm run hide_run'>917</p>
<p class='pln'>918</p>
<p class='stm run hide_run'>919</p>
<p class='pln'>920</p>
<p class='pln'>921</p>
<p class='pln'>922</p>
<p class='pln'>923</p>
<p class='pln'>924</p>
<p class='pln'>925</p>
<p class='pln'>926</p>
<p class='pln'>927</p>
<p class='pln'>928</p>
<p class='pln'>929</p>
<p class='pln'>930</p>
<p class='pln'>931</p>
<p class='pln'>932</p>
<p class='pln'>933</p>
<p class='pln'>934</p>
<p class='pln'>935</p>
<p class='pln'>936</p>
<p class='pln'>937</p>
<p class='pln'>938</p>
<p class='pln'>939</p>
<p class='stm run hide_run'>940</p>
<p class='stm run hide_run'>941</p>
<p class='pln'>942</p>
<p class='stm run hide_run'>943</p>
<p class='stm run hide_run'>944</p>
<p class='stm run hide_run'>945</p>
<p class='stm run hide_run'>946</p>
<p class='stm mis'>947</p>
<p class='pln'>948</p>
<p class='stm run hide_run'>949</p>
<p class='pln'>950</p>
<p class='stm run hide_run'>951</p>
<p class='pln'>952</p>
<p class='stm run hide_run'>953</p>
<p class='pln'>954</p>
<p class='stm run hide_run'>955</p>
<p class='pln'>956</p>
<p class='stm run hide_run'>957</p>
<p class='pln'>958</p>
<p class='stm run hide_run'>959</p>
<p class='pln'>960</p>
<p class='stm run hide_run'>961</p>
<p class='pln'>962</p>
<p class='stm run hide_run'>963</p>
<p class='pln'>964</p>
<p class='pln'>965</p>
<p class='stm run hide_run'>966</p>
<p class='pln'>967</p>
<p class='stm run hide_run'>968</p>
<p class='pln'>969</p>
<p class='stm run hide_run'>970</p>
<p class='pln'>971</p>
<p class='stm run hide_run'>972</p>
<p class='pln'>973</p>
<p class='stm mis'>974</p>
<p class='pln'>975</p>
<p class='pln'>976</p>
<p class='stm run hide_run'>977</p>
<p class='stm run hide_run'>978</p>
<p class='pln'>979</p>
<p class='stm run hide_run'>980</p>
<p class='pln'>981</p>
<p class='pln'>982</p>
<p class='stm run hide_run'>983</p>
<p class='stm run hide_run'>984</p>
<p class='pln'>985</p>
<p class='stm mis'>986</p>
<p class='pln'>987</p>
<p class='stm run hide_run'>988</p>
<p class='pln'>989</p>
<p class='stm run hide_run'>990</p>
<p class='stm run hide_run'>991</p>
<p class='pln'>992</p>
<p class='stm run hide_run'>993</p>
<p class='pln'>994</p>
<p class='stm run hide_run'>995</p>
<p class='stm run hide_run'>996</p>
<p class='stm run hide_run'>997</p>
<p class='pln'>998</p>
<p class='pln'>999</p>
<p class='stm run hide_run'>1000</p>
<p class='stm run hide_run'>1001</p>
<p class='pln'>1002</p>
<p class='pln'>1003</p>
<p class='pln'>1004</p>
<p class='stm run hide_run'>1005</p>
<p class='pln'>1006</p>
<p class='stm run hide_run'>1007</p>
<p class='stm run hide_run'>1008</p>
<p class='stm run hide_run'>1009</p>
<p class='stm run hide_run'>1010</p>
<p class='stm run hide_run'>1011</p>
<p class='stm run hide_run'>1012</p>
<p class='stm run hide_run'>1013</p>
<p class='stm run hide_run'>1014</p>
<p class='stm run hide_run'>1015</p>
<p class='pln'>1016</p>
<p class='stm run hide_run'>1017</p>
<p class='pln'>1018</p>
<p class='stm run hide_run'>1019</p>
<p class='stm run hide_run'>1020</p>
<p class='stm run hide_run'>1021</p>
<p class='stm run hide_run'>1022</p>
<p class='stm run hide_run'>1023</p>
<p class='pln'>1024</p>
<p class='stm run hide_run'>1025</p>
<p class='stm run hide_run'>1026</p>
<p class='stm run hide_run'>1027</p>
<p class='stm run hide_run'>1028</p>
<p class='stm run hide_run'>1029</p>
<p class='stm run hide_run'>1030</p>
<p class='pln'>1031</p>
<p class='stm run hide_run'>1032</p>
<p class='pln'>1033</p>
<p class='stm run hide_run'>1034</p>
<p class='stm run hide_run'>1035</p>
<p class='stm run hide_run'>1036</p>
<p class='stm run hide_run'>1037</p>
<p class='pln'>1038</p>
<p class='stm run hide_run'>1039</p>
<p class='stm mis'>1040</p>
<p class='stm mis'>1041</p>
<p class='stm mis'>1042</p>
<p class='stm mis'>1043</p>
<p class='pln'>1044</p>
<p class='stm run hide_run'>1045</p>
<p class='pln'>1046</p>
<p class='stm run hide_run'>1047</p>
<p class='pln'>1048</p>
<p class='stm run hide_run'>1049</p>
<p class='pln'>1050</p>
<p class='stm run hide_run'>1051</p>
<p class='pln'>1052</p>
<p class='stm run hide_run'>1053</p>
<p class='pln'>1054</p>
<p class='stm run hide_run'>1055</p>
<p class='pln'>1056</p>
<p class='stm run hide_run'>1057</p>
<p class='pln'>1058</p>
<p class='stm run hide_run'>1059</p>
<p class='pln'>1060</p>
<p class='stm run hide_run'>1061</p>
<p class='pln'>1062</p>
<p class='stm run hide_run'>1063</p>
<p class='pln'>1064</p>
<p class='stm run hide_run'>1065</p>
<p class='pln'>1066</p>
<p class='stm run hide_run'>1067</p>
<p class='pln'>1068</p>
<p class='stm run hide_run'>1069</p>
<p class='pln'>1070</p>
<p class='stm run hide_run'>1071</p>
<p class='pln'>1072</p>
<p class='stm run hide_run'>1073</p>
<p class='pln'>1074</p>
<p class='pln'>1075</p>
<p class='pln'>1076</p>
<p class='pln'>1077</p>
<p class='pln'>1078</p>
<p class='pln'>1079</p>
<p class='pln'>1080</p>
<p class='pln'>1081</p>
<p class='pln'>1082</p>
<p class='pln'>1083</p>
<p class='pln'>1084</p>
<p class='pln'>1085</p>
<p class='stm run hide_run'>1086</p>
<p class='stm run hide_run'>1087</p>
<p class='stm run hide_run'>1088</p>
<p class='stm run hide_run'>1089</p>
<p class='stm run hide_run'>1090</p>
<p class='stm run hide_run'>1091</p>
<p class='stm run hide_run'>1092</p>
<p class='stm run hide_run'>1093</p>
<p class='stm run hide_run'>1094</p>
<p class='pln'>1095</p>
<p class='stm run hide_run'>1096</p>
<p class='pln'>1097</p>
<p class='pln'>1098</p>
<p class='pln'>1099</p>
<p class='pln'>1100</p>
<p class='pln'>1101</p>
<p class='pln'>1102</p>
<p class='pln'>1103</p>
<p class='pln'>1104</p>
<p class='pln'>1105</p>
<p class='pln'>1106</p>
<p class='pln'>1107</p>
<p class='pln'>1108</p>
<p class='pln'>1109</p>
<p class='pln'>1110</p>
<p class='pln'>1111</p>
<p class='pln'>1112</p>
<p class='pln'>1113</p>
<p class='pln'>1114</p>
<p class='pln'>1115</p>
<p class='pln'>1116</p>
<p class='pln'>1117</p>
<p class='pln'>1118</p>
<p class='pln'>1119</p>
<p class='pln'>1120</p>
<p class='pln'>1121</p>
<p class='pln'>1122</p>
<p class='pln'>1123</p>
<p class='pln'>1124</p>
<p class='pln'>1125</p>
<p class='pln'>1126</p>
<p class='pln'>1127</p>
<p class='pln'>1128</p>
<p class='pln'>1129</p>
<p class='pln'>1130</p>
<p class='pln'>1131</p>
<p class='pln'>1132</p>
<p class='pln'>1133</p>
<p class='pln'>1134</p>
<p class='pln'>1135</p>
<p class='pln'>1136</p>
<p class='pln'>1137</p>
<p class='pln'>1138</p>
<p class='pln'>1139</p>
<p class='pln'>1140</p>
<p class='pln'>1141</p>
<p class='pln'>1142</p>
<p class='pln'>1143</p>
<p class='pln'>1144</p>
<p class='pln'>1145</p>
<p class='pln'>1146</p>
<p class='pln'>1147</p>
<p class='pln'>1148</p>
<p class='pln'>1149</p>
<p class='pln'>1150</p>
<p class='pln'>1151</p>
<p class='pln'>1152</p>
<p class='pln'>1153</p>
<p class='pln'>1154</p>
<p class='pln'>1155</p>
<p class='pln'>1156</p>
<p class='pln'>1157</p>
<p class='pln'>1158</p>
<p class='pln'>1159</p>
<p class='pln'>1160</p>
<p class='pln'>1161</p>
<p class='pln'>1162</p>
<p class='pln'>1163</p>
<p class='pln'>1164</p>
<p class='pln'>1165</p>
<p class='pln'>1166</p>
<p class='pln'>1167</p>
<p class='pln'>1168</p>
<p class='pln'>1169</p>
<p class='pln'>1170</p>
<p class='pln'>1171</p>
<p class='pln'>1172</p>
<p class='pln'>1173</p>
<p class='pln'>1174</p>
<p class='pln'>1175</p>
<p class='pln'>1176</p>
<p class='pln'>1177</p>
<p class='pln'>1178</p>
<p class='pln'>1179</p>
<p class='pln'>1180</p>
<p class='pln'>1181</p>
<p class='pln'>1182</p>
<p class='pln'>1183</p>
<p class='pln'>1184</p>
<p class='pln'>1185</p>
<p class='pln'>1186</p>
<p class='pln'>1187</p>
<p class='pln'>1188</p>
<p class='pln'>1189</p>
<p class='pln'>1190</p>
<p class='pln'>1191</p>
<p class='pln'>1192</p>
<p class='pln'>1193</p>
<p class='pln'>1194</p>
<p class='pln'>1195</p>
<p class='pln'>1196</p>
<p class='pln'>1197</p>
<p class='pln'>1198</p>
<p class='pln'>1199</p>
<p class='pln'>1200</p>
<p class='pln'>1201</p>
<p class='pln'>1202</p>
<p class='pln'>1203</p>
<p class='pln'>1204</p>
<p class='pln'>1205</p>
<p class='pln'>1206</p>
<p class='pln'>1207</p>
<p class='pln'>1208</p>
<p class='pln'>1209</p>
<p class='stm run hide_run'>1210</p>
<p class='stm run hide_run'>1211</p>
<p class='stm run hide_run'>1212</p>
<p class='stm run hide_run'>1213</p>
<p class='stm run hide_run'>1214</p>
<p class='pln'>1215</p>
<p class='pln'>1216</p>
<p class='pln'>1217</p>
<p class='stm run hide_run'>1218</p>
<p class='stm run hide_run'>1219</p>
<p class='pln'>1220</p>
<p class='stm run hide_run'>1221</p>
<p class='stm run hide_run'>1222</p>
<p class='stm run hide_run'>1223</p>
<p class='stm run hide_run'>1224</p>
<p class='stm run hide_run'>1225</p>
<p class='stm run hide_run'>1226</p>
<p class='pln'>1227</p>
<p class='stm run hide_run'>1228</p>
<p class='stm run hide_run'>1229</p>
<p class='stm run hide_run'>1230</p>
<p class='stm run hide_run'>1231</p>
<p class='stm run hide_run'>1232</p>
<p class='stm run hide_run'>1233</p>
<p class='stm run hide_run'>1234</p>
<p class='stm run hide_run'>1235</p>
<p class='stm run hide_run'>1236</p>
<p class='stm run hide_run'>1237</p>
<p class='stm run hide_run'>1238</p>
<p class='stm run hide_run'>1239</p>
<p class='stm run hide_run'>1240</p>
<p class='stm run hide_run'>1241</p>
<p class='stm run hide_run'>1242</p>
<p class='stm run hide_run'>1243</p>
<p class='stm run hide_run'>1244</p>
<p class='stm run hide_run'>1245</p>
<p class='stm run hide_run'>1246</p>
<p class='stm run hide_run'>1247</p>
<p class='stm run hide_run'>1248</p>
<p class='pln'>1249</p>
<p class='stm run hide_run'>1250</p>
<p class='stm run hide_run'>1251</p>
<p class='stm run hide_run'>1252</p>
<p class='pln'>1253</p>
<p class='pln'>1254</p>
<p class='pln'>1255</p>
<p class='stm run hide_run'>1256</p>
<p class='stm run hide_run'>1257</p>
<p class='pln'>1258</p>
<p class='stm run hide_run'>1259</p>
<p class='pln'>1260</p>
<p class='stm mis'>1261</p>
<p class='pln'>1262</p>
<p class='stm run hide_run'>1263</p>
<p class='pln'>1264</p>
<p class='stm mis'>1265</p>
<p class='pln'>1266</p>
<p class='stm run hide_run'>1267</p>
<p class='pln'>1268</p>
<p class='stm mis'>1269</p>
<p class='pln'>1270</p>
<p class='pln'>1271</p>
<p class='stm run hide_run'>1272</p>
<p class='pln'>1273</p>
<p class='pln'>1274</p>
<p class='pln'>1275</p>
<p class='pln'>1276</p>
<p class='pln'>1277</p>
<p class='pln'>1278</p>
<p class='pln'>1279</p>
<p class='pln'>1280</p>
<p class='pln'>1281</p>
<p class='pln'>1282</p>
<p class='pln'>1283</p>
<p class='pln'>1284</p>
<p class='pln'>1285</p>
<p class='pln'>1286</p>
<p class='pln'>1287</p>
<p class='stm run hide_run'>1288</p>
<p class='stm run hide_run'>1289</p>
<p class='stm run hide_run'>1290</p>
<p class='stm run hide_run'>1291</p>
<p class='stm run hide_run'>1292</p>
<p class='stm mis'>1293</p>
<p class='stm run hide_run'>1294</p>
<p class='stm run hide_run'>1295</p>
<p class='stm run hide_run'>1296</p>
<p class='stm run hide_run'>1297</p>
<p class='stm run hide_run'>1298</p>
<p class='stm run hide_run'>1299</p>
<p class='stm mis'>1300</p>
<p class='stm run hide_run'>1301</p>
<p class='stm run hide_run'>1302</p>
<p class='stm mis'>1303</p>
    
</td>
<td class='text' valign='top'>
<p class='pln'><span class='com'># coding=utf-8</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='str'>&quot;&quot;&quot;The core of the simulator.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>A world (instance of the :class:`World` class) consists of bodies (instances of the :class:`Body` class) interlinked by joints (instances of :class:`Joint` subclasses). Joints serve two purposes in arboris: </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>- restrict the relative motion between bodies (for instance a hinge joint only allows for rotations around its axis) </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>- and parametrize the bodies positions (for instance a single angle is enough to parametrize the relative position of two bodies constrained by a hinge joint).</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>A world forms an oriented tree whose nodes are the bodies and edges are the</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>joints, so that the state (pose and velocity) of each body can be computed from</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>the state of its parent joints (the joints on the path from the body to the root</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>of the tree (which is body called &quot;ground&quot;)).</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>One or more frames (instances of the :class:`SubFrame` class) can be associated to bodies and serve as anchor points to the joints.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='nam'>__author__</span> <span class='op'>=</span> <span class='op'>(</span><span class='str'>&quot;Sébastien BARTHÉLEMY &lt;barthelemy@crans.org&gt;&quot;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>from</span> <span class='nam'>numpy</span> <span class='key'>import</span> <span class='nam'>array</span><span class='op'>,</span> <span class='nam'>zeros</span><span class='op'>,</span> <span class='nam'>eye</span><span class='op'>,</span> <span class='nam'>dot</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>import</span> <span class='nam'>numpy</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>import</span> <span class='nam'>homogeneousmatrix</span> <span class='key'>as</span> <span class='nam'>Hg</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>from</span> <span class='nam'>abc</span> <span class='key'>import</span> <span class='nam'>ABCMeta</span><span class='op'>,</span> <span class='nam'>abstractmethod</span><span class='op'>,</span> <span class='nam'>abstractproperty</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>from</span> <span class='nam'>rigidmotion</span> <span class='key'>import</span> <span class='nam'>RigidMotion</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>simplearm</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>from</span> <span class='nam'>arboris</span><span class='op'>.</span><span class='nam'>robots</span><span class='op'>.</span><span class='nam'>simplearm</span> <span class='key'>import</span> <span class='nam'>add_simplearm</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>w</span> <span class='op'>=</span> <span class='nam'>World</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>add_simplearm</span><span class='op'>(</span><span class='nam'>w</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>w</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>NamedObject</span><span class='op'>(</span><span class='nam'>object</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; A class for anything named to depend from.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>name</span> <span class='op'>=</span> <span class='nam'>name</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__repr__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>name</span> <span class='key'>is</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>object</span><span class='op'>.</span><span class='nam'>__repr__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='str'>&#39;&lt;{0}.{1} object named &quot;{2}&quot; at &quot;{3}&quot;)&gt;&#39;</span><span class='op'>.</span><span class='nam'>format</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>__class__</span><span class='op'>.</span><span class='nam'>__module__</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>__class__</span><span class='op'>.</span><span class='nam'>__name__</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>name</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>hex</span><span class='op'>(</span><span class='nam'>id</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>NamedObjectsList</span><span class='op'>(</span><span class='nam'>list</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;A list of (possibly) NamedObjects.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; This class behaves like the built-in ``list`` class except that</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; objects can be retrieved by name, using a string index or the </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; ``find`` method. In the first case, the first matching object is</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; returned, in the second case a (raw) list of matching objects is</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; returned.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; **Example:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; L = [Body(name=&quot;Jean-Paul&quot;), 1., &#39;sss&#39;]</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; NL = NamedObjectsList(L)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; NL.append(Body(name=u&#39;Guard&#39;))</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; NL.append(Body(name=u&#39;Jean-Paul&#39;))</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; NL[&#39;Guard&#39;] #doctest: +ELLIPSIS</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &lt;arboris.core.Body object named &quot;Guard&quot; at &quot;0x...&quot;)&gt;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; NL[&#39;Jean-Paul&#39;] #doctest: +ELLIPSIS</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &lt;arboris.core.Body object named &quot;Jean-Paul&quot; at &quot;0x...&quot;)&gt;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; NL.find(&#39;Jean-Paul&#39;) #doctest: +ELLIPSIS</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; [&lt;arboris.core.Body object named &quot;Jean-Paul&quot; at &quot;0x...&quot;)&gt;, &lt;arboris.core.Body object named &quot;Jean-Paul&quot; at &quot;0x...&quot;)&gt;]</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; NL[&#39;Jean-Marie&#39;]</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; Traceback (most recent call last):</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; ...</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; KeyError: &#39;No object named &quot;Jean-Marie&quot;.&#39;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; NL[&#39;Jean-Paul&#39;] = 3</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; Traceback (most recent call last):</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; ...</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; TypeError: list indices must be integers, not str</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>iterable</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>extend</span><span class='op'>(</span><span class='nam'>iterable</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>find</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>result</span> <span class='op'>=</span> <span class='op'>[</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>NamedObject</span><span class='op'>)</span> <span class='key'>and</span> <span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>name</span> <span class='op'>==</span> <span class='nam'>name</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>result</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>result</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__getitem__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>index</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>index</span><span class='op'>,</span> <span class='nam'>str</span><span class='op'>)</span> <span class='key'>or</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>index</span><span class='op'>,</span> <span class='nam'>unicode</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># returns the first item whose name is matching </span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>NamedObject</span><span class='op'>)</span> <span class='key'>and</span> <span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>name</span> <span class='op'>==</span> <span class='nam'>index</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>obj</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>KeyError</span><span class='op'>(</span><span class='str'>&#39;No object named &quot;{0}&quot;.&#39;</span><span class='op'>.</span><span class='nam'>format</span><span class='op'>(</span><span class='nam'>index</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>list</span><span class='op'>.</span><span class='nam'>__getitem__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>index</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>as_dict</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Returns a dictionary whose keys are the objects names and </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; values are the objects themselves. Objects with no name are</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; ignored. Duplicate names raise a ``DuplicateName`` </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; exception.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>result</span> <span class='op'>=</span> <span class='op'>{</span><span class='op'>}</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>NamedObject</span><span class='op'>)</span> <span class='key'>and</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>name</span> <span class='key'>is</span> <span class='key'>not</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>name</span> <span class='key'>not</span> <span class='key'>in</span> <span class='nam'>result</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>result</span><span class='op'>[</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>name</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>obj</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>DuplicateNameError</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>result</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>DuplicateNameError</span><span class='op'>(</span><span class='nam'>Exception</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>Frame</span><span class='op'>(</span><span class='nam'>object</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;A generic class for frames.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>__metaclass__</span> <span class='op'>=</span> <span class='nam'>ABCMeta</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractproperty</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>pose</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractproperty</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>jacobian</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractproperty</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>djacobian</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractproperty</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>twist</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractproperty</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>body</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractproperty</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>bpose</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>Joint</span><span class='op'>(</span><span class='nam'>RigidMotion</span><span class='op'>,</span> <span class='nam'>NamedObject</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;A generic class for ideal joints.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; An ideal joint is a kinematic restriction of the allowed relative </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; twist of two frames, here named frames 0 and 1, to which the joint</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; is said to be attached. In arboris, it serves to parametrize the</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; relative position and velocity of frame 1 regarding to frame 0.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; This class has virtual methods and properties. It should be </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; subclassed by concrete implementations.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>__metaclass__</span> <span class='op'>=</span> <span class='nam'>ABCMeta</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>NamedObject</span><span class='op'>.</span><span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_frame0</span> <span class='op'>=</span> <span class='nam'>None</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_frame1</span> <span class='op'>=</span> <span class='nam'>None</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span> <span class='op'>=</span> <span class='nam'>None</span> <span class='com'># will be set by World.init()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractproperty</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>ndof</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Number of degrees of freedom of the joint.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>dof</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span> <span class='key'>is</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>ValueError</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>frames</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Frames to which the joint is attached.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_frame0</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_frame1</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>twist</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>r&quot;&quot;&quot;Relative twist of frame 1 regarding to frame 0 expressed in frame 1: `\twist[1]_{1/0}`</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>jacobian</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>gvel</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractproperty</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>jacobian</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>r&quot;&quot;&quot;Jacobian of the joint relative position.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Return the matrix `J` such that `\twist[1]_{1/0} = J \nu`.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Or, with numpy ntation, ``j.twist == dot(j.jacobian, j.gvel)``.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; This matrix generally changes with the joint generalized position.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractproperty</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>djacobian</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractmethod</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>integrate</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>gvel</span><span class='op'>,</span> <span class='nam'>dt</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>LinearConfigurationSpaceJoint</span><span class='op'>(</span><span class='nam'>Joint</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; Joints whose configuration space is diffeomorph to R^ndof.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>gpos</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>,</span> <span class='nam'>gvel</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>gpos</span> <span class='key'>is</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>gpos</span> <span class='op'>=</span> <span class='nam'>zeros</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>ndof</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>gpos</span> <span class='op'>=</span> <span class='nam'>array</span><span class='op'>(</span><span class='nam'>gpos</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>reshape</span><span class='op'>(</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>ndof</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>gvel</span> <span class='key'>is</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>gvel</span> <span class='op'>=</span> <span class='nam'>zeros</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>ndof</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>gvel</span> <span class='op'>=</span> <span class='nam'>array</span><span class='op'>(</span><span class='nam'>gvel</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>reshape</span><span class='op'>(</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>ndof</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>Joint</span><span class='op'>.</span><span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>integrate</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>gvel</span><span class='op'>,</span> <span class='nam'>dt</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>gvel</span> <span class='op'>=</span> <span class='nam'>gvel</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>gpos</span> <span class='op'>+=</span> <span class='nam'>dt</span> <span class='op'>*</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>gvel</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>JointsList</span><span class='op'>(</span><span class='nam'>NamedObjectsList</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>iterable</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>NamedObjectsList</span><span class='op'>.</span><span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>iterable</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_init_dof</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>_init_dof</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span> <span class='op'>=</span> <span class='nam'>slice</span><span class='op'>(</span><span class='num'>0</span><span class='op'>,</span><span class='num'>0</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>Joint</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>dof</span><span class='op'>.</span><span class='nam'>step</span> <span class='key'>in</span> <span class='op'>(</span><span class='nam'>None</span><span class='op'>,</span> <span class='num'>1</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span><span class='op'>,</span> <span class='nam'>slice</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span><span class='op'>.</span><span class='nam'>stop</span> <span class='op'>==</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>dof</span><span class='op'>.</span><span class='nam'>start</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span><span class='op'>.</span><span class='nam'>step</span> <span class='key'>in</span> <span class='op'>(</span><span class='nam'>None</span><span class='op'>,</span> <span class='num'>1</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># if possible, keep self._dof as a slice</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span> <span class='op'>=</span> <span class='nam'>slice</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span><span class='op'>.</span><span class='nam'>start</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>dof</span><span class='op'>.</span><span class='nam'>stop</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># otherwise, self._dof is converted into a sequence</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span> <span class='op'>=</span> <span class='nam'>range</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span><span class='op'>.</span><span class='nam'>start</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span><span class='op'>.</span><span class='nam'>stop</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span><span class='op'>.</span><span class='nam'>extend</span><span class='op'>(</span><span class='nam'>range</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>dof</span><span class='op'>.</span><span class='nam'>start</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>dof</span><span class='op'>.</span><span class='nam'>stop</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span><span class='op'>.</span><span class='nam'>extend</span><span class='op'>(</span><span class='nam'>range</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>dof</span><span class='op'>.</span><span class='nam'>start</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>dof</span><span class='op'>.</span><span class='nam'>stop</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>dof</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_dof</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>Constraint</span><span class='op'>(</span><span class='nam'>NamedObject</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>__metaclass__</span> <span class='op'>=</span> <span class='nam'>ABCMeta</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>frames</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>NamedObject</span><span class='op'>.</span><span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractmethod</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>init</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>world</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>gforce</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>jacobian</span><span class='op'>.</span><span class='nam'>T</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_force</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractproperty</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>jacobian</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractproperty</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>ndol</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Number of degrees of &quot;liaison&quot; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; In french: *nombre de degrés de liaison*. This is equal to (6 - ndof).</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractmethod</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>update</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractmethod</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>is_active</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractmethod</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>solve</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>vel</span><span class='op'>,</span> <span class='nam'>admittance</span><span class='op'>,</span> <span class='nam'>dt</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>Shape</span><span class='op'>(</span><span class='nam'>NamedObject</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;A generic class for geometric shapes used in collision detection</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>frame</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>frame</span><span class='op'>,</span> <span class='nam'>Frame</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>frame</span> <span class='op'>=</span> <span class='nam'>frame</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>NamedObject</span><span class='op'>.</span><span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>Controller</span><span class='op'>(</span><span class='nam'>NamedObject</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>__metaclass__</span> <span class='op'>=</span> <span class='nam'>ABCMeta</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>NamedObject</span><span class='op'>.</span><span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractmethod</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>init</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>world</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractmethod</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>update</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>dt</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>World</span><span class='op'>(</span><span class='nam'>NamedObject</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>NamedObject</span><span class='op'>.</span><span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>ground</span> <span class='op'>=</span> <span class='nam'>Body</span><span class='op'>(</span><span class='str'>&#39;ground&#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_current_time</span> <span class='op'>=</span> <span class='num'>0.</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_up</span> <span class='op'>=</span> <span class='nam'>array</span><span class='op'>(</span><span class='op'>(</span><span class='num'>0.</span><span class='op'>,</span> <span class='num'>1.</span><span class='op'>,</span> <span class='num'>0.</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_controllers</span> <span class='op'>=</span> <span class='op'>[</span><span class='op'>]</span> <span class='com'>#TODO: should be a Set?</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_constraints</span> <span class='op'>=</span> <span class='op'>[</span><span class='op'>]</span> <span class='com'>#TODO: should be a Set?</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_subframes</span> <span class='op'>=</span> <span class='op'>[</span><span class='op'>]</span> <span class='com'>#TODO: should be a Set?</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_shapes</span> <span class='op'>=</span> <span class='op'>[</span><span class='op'>]</span> <span class='com'>#TODO: should be a Set?</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span> <span class='op'>=</span> <span class='num'>0</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gvel</span> <span class='op'>=</span> <span class='nam'>array</span><span class='op'>(</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_mass</span> <span class='op'>=</span>&nbsp; <span class='nam'>array</span><span class='op'>(</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span><span class='com'># updated by self.update_dynamic()</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gforce</span> <span class='op'>=</span>&nbsp; <span class='nam'>array</span><span class='op'>(</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_viscosity</span> <span class='op'>=</span> <span class='nam'>array</span><span class='op'>(</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span> <span class='com'># updated by self.update_dynamic()</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_nleffects</span> <span class='op'>=</span> <span class='nam'>array</span><span class='op'>(</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span> <span class='com'># updated by self.update_dynamic()</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_impedance</span> <span class='op'>=</span> <span class='nam'>array</span><span class='op'>(</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span> <span class='com'># updated by self.update_controller()</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_admittance</span> <span class='op'>=</span> <span class='nam'>array</span><span class='op'>(</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span> <span class='com'># updated by self.update_controller()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>iterbodies</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Iterate over all bodies, with a depth-first strategy.&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>ground</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>b</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>ground</span><span class='op'>.</span><span class='nam'>iter_descendant_bodies</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>b</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>getbodies</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Returns a NamedObjectsList of the world bodies.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>NamedObjectsList</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>iterbodies</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>iterconstraints</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Iterate over all constraints.&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_constraints</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>obj</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>itersubframes</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Iterate over all subframes.&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_subframes</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>obj</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>iterframes</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Iterate over all frames (bodies and subframes).&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>iterbodies</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>obj</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>itersubframes</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>obj</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>getframes</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Returns a NamedObjectsList of the world frames.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>frames</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>getbodies</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>frames</span><span class='op'>.</span><span class='nam'>extend</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_subframes</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>frames</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>itershapes</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Iterate over all shapes.&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_shapes</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>obj</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>getshapes</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Returns a NamedObjectsList of the world shapes.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>NamedObjectsList</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_shapes</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>iterjoints</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Iterate over all joints, with a depth-first strategy.&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>j</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>ground</span><span class='op'>.</span><span class='nam'>iter_descendant_joints</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>j</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>getjoints</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Returns a JointsList of the joints.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; **Example:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w = simplearm()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; joints = w.getjoints()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; joints[1] #doctest: +ELLIPSIS</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;arboris.joints.RzJoint object named &quot;Elbow&quot; at &quot;0x...&quot;)&gt;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; joints[&#39;Elbow&#39;] #doctest: +ELLIPSIS</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;arboris.joints.RzJoint object named &quot;Elbow&quot; at &quot;0x...&quot;)&gt;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; joints.dof</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slice(0, 3, None)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>JointsList</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>iterjoints</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>add_link</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>frame0</span><span class='op'>,</span> <span class='nam'>joint</span><span class='op'>,</span> <span class='nam'>frame1</span><span class='op'>,</span> <span class='op'>*</span><span class='nam'>args</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Add a link (ie. Joint and Body) to the world.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :param frame0: the frame where the new joint will be attached. </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; It should belong to a bady which is already in the world.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :param joint: the joint to be added.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :param frame1: the frame of the body which is to be added to the world.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; One can also add several links at a time::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; world.add_link(frame0_a, joint_a, frame1_a, frame0_b, joint_b, frame1_b)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>frame0</span><span class='op'>,</span> <span class='nam'>Frame</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>frame1</span><span class='op'>,</span> <span class='nam'>Frame</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>joint</span><span class='op'>,</span> <span class='nam'>Joint</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>joint</span><span class='op'>.</span><span class='nam'>_frame0</span> <span class='key'>is</span> <span class='nam'>None</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>joint</span><span class='op'>.</span><span class='nam'>_frame1</span> <span class='key'>is</span> <span class='nam'>None</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>len</span><span class='op'>(</span><span class='nam'>args</span><span class='op'>)</span> <span class='op'>%</span> <span class='num'>3</span> <span class='op'>==</span> <span class='num'>0</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>joint</span><span class='op'>.</span><span class='nam'>_frame0</span> <span class='op'>=</span> <span class='nam'>frame0</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>joint</span><span class='op'>.</span><span class='nam'>_frame1</span> <span class='op'>=</span> <span class='nam'>frame1</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>frame1</span><span class='op'>.</span><span class='nam'>body</span><span class='op'>.</span><span class='nam'>parentjoint</span> <span class='key'>is</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>frame1</span><span class='op'>.</span><span class='nam'>body</span><span class='op'>.</span><span class='nam'>parentjoint</span> <span class='op'>=</span> <span class='nam'>joint</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>ValueError</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;frame1\&#39;s body already has a parent joint, which means you\&#39;re probably trying to create a kinematic loop. Try using a constraint instead.&#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>frame0</span><span class='op'>.</span><span class='nam'>body</span><span class='op'>.</span><span class='nam'>childrenjoints</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>joint</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>register</span><span class='op'>(</span><span class='nam'>frame0</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>register</span><span class='op'>(</span><span class='nam'>frame1</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>len</span><span class='op'>(</span><span class='nam'>args</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='num'>0</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>add_link</span><span class='op'>(</span><span class='op'>*</span><span class='nam'>args</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>replace_joint</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>old_joint</span><span class='op'>,</span> <span class='op'>*</span><span class='nam'>args</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Replace a joint by another joint or by another kinematic chain.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; **Syntax:** ::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; world.replace_joint(old_joint, new_joint)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; world.replace_joint(old_joint, frame0, new_joint, ... , frame1)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; **Example:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w = simplearm()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; from arboris.joints import RzJoint</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; joints = w.getjoints()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w.replace_joint(joints[&#39;Elbow&#39;], RzJoint())</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>old_joint</span><span class='op'>,</span> <span class='nam'>Joint</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>old_joint</span> <span class='key'>in</span> <span class='nam'>old_joint</span><span class='op'>.</span><span class='nam'>_frame0</span><span class='op'>.</span><span class='nam'>body</span><span class='op'>.</span><span class='nam'>childrenjoints</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>old_joint</span> <span class='key'>is</span> <span class='nam'>old_joint</span><span class='op'>.</span><span class='nam'>_frame1</span><span class='op'>.</span><span class='nam'>body</span><span class='op'>.</span><span class='nam'>parentjoint</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>len</span><span class='op'>(</span><span class='nam'>args</span><span class='op'>)</span> <span class='op'>==</span> <span class='num'>1</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>new_joint</span> <span class='op'>=</span> <span class='nam'>args</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>frame0</span> <span class='op'>=</span> <span class='nam'>old_joint</span><span class='op'>.</span><span class='nam'>_frame0</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>frame1</span> <span class='op'>=</span> <span class='nam'>old_joint</span><span class='op'>.</span><span class='nam'>_frame1</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>replace_joint</span><span class='op'>(</span><span class='nam'>old_joint</span><span class='op'>,</span> <span class='nam'>frame0</span><span class='op'>,</span> <span class='nam'>new_joint</span><span class='op'>,</span> <span class='nam'>frame1</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>len</span><span class='op'>(</span><span class='nam'>args</span><span class='op'>)</span> <span class='op'>==</span> <span class='num'>0</span> <span class='key'>or</span> <span class='nam'>len</span><span class='op'>(</span><span class='nam'>args</span><span class='op'>)</span> <span class='op'>%</span> <span class='num'>3</span> <span class='op'>!=</span> <span class='num'>0</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>RuntimeError</span><span class='op'>(</span><span class='op'>)</span> <span class='com'>#TODO</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>body0</span> <span class='op'>=</span> <span class='nam'>args</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>.</span><span class='nam'>body</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>body1</span> <span class='op'>=</span> <span class='nam'>args</span><span class='op'>[</span><span class='op'>-</span><span class='num'>1</span><span class='op'>]</span><span class='op'>.</span><span class='nam'>body</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>old_joint</span><span class='op'>.</span><span class='nam'>_frame0</span><span class='op'>.</span><span class='nam'>body</span> <span class='key'>is</span> <span class='nam'>body0</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>old_joint</span><span class='op'>.</span><span class='nam'>_frame1</span><span class='op'>.</span><span class='nam'>body</span> <span class='key'>is</span> <span class='nam'>body1</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>body1</span><span class='op'>.</span><span class='nam'>parentjoint</span> <span class='op'>=</span> <span class='nam'>None</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>old_joint</span><span class='op'>.</span><span class='nam'>_frame0</span> <span class='op'>=</span> <span class='nam'>None</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>old_joint</span><span class='op'>.</span><span class='nam'>_frame1</span> <span class='op'>=</span> <span class='nam'>None</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>add_link</span><span class='op'>(</span><span class='op'>*</span><span class='nam'>args</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># new_joint is now the last in body0.childrenjoint</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># and old_joint is still somewhere in body0.childrenjoint</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># let&#39;s fix that</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>i</span> <span class='op'>=</span> <span class='nam'>body0</span><span class='op'>.</span><span class='nam'>childrenjoints</span><span class='op'>.</span><span class='nam'>index</span><span class='op'>(</span><span class='nam'>old_joint</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>body0</span><span class='op'>.</span><span class='nam'>childrenjoints</span><span class='op'>[</span><span class='nam'>i</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>body0</span><span class='op'>.</span><span class='nam'>childrenjoints</span><span class='op'>.</span><span class='nam'>pop</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>init</span><span class='op'>(</span><span class='op'>)</span> <span class='com'>#TODO</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>register</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Register an object into the world.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; ``obj`` can be a subframe, a shape or a constraint.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :arguments:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; obj</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the object that will be added. It may be a subframe, a shape,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a joint, a body or a controller.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; **Example:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w = simplearm()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; from arboris.controllers import ProportionalDerivativeController</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; joints = w.getjoints()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; c0 = ProportionalDerivativeController(joints[1:3], </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; ...&nbsp; &nbsp;&nbsp; name = &#39;my controller&#39;)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w.register(c0)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; c1 = ProportionalDerivativeController(joints[0:1])</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w.register(c1)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w.init()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>Body</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>Joint</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>ValueError</span><span class='op'>(</span><span class='str'>&#39;Joints should not be registered. Use add_link() instead.&#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>SubFrame</span><span class='op'>)</span> <span class='key'>or</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>MovingSubFrame</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_subframes</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_subframes</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>Shape</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_shapes</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_shapes</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>register</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>frame</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>Constraint</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_constraints</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_constraints</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>from</span> <span class='nam'>arboris</span><span class='op'>.</span><span class='nam'>constraints</span> <span class='key'>import</span> <span class='nam'>PointContact</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>PointContact</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#TODO: World should not know about PointContact!</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>register</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>_frames</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>register</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>_frames</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>elif</span> <span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>Controller</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_controllers</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_controllers</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>ValueError</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;I do not know how to register objects of type {0}&#39;</span><span class='op'>.</span><span class='nam'>format</span><span class='op'>(</span><span class='nam'>type</span><span class='op'>(</span><span class='nam'>obj</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>init</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Init the joints-space model of the world.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span> <span class='op'>=</span> <span class='num'>0</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>j</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>iterjoints</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>old_ndof</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span> <span class='op'>+=</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>ndof</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>j</span><span class='op'>.</span><span class='nam'>_dof</span> <span class='op'>=</span> <span class='nam'>slice</span><span class='op'>(</span><span class='nam'>old_ndof</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># Adjust the size of the worldwide model matrices </span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># (we wipe their content)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_mass</span> <span class='op'>=</span> <span class='nam'>zeros</span><span class='op'>(</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>,</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_nleffects</span> <span class='op'>=</span>&nbsp; <span class='nam'>zeros</span><span class='op'>(</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>,</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_viscosity</span> <span class='op'>=</span> <span class='nam'>zeros</span><span class='op'>(</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>,</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_controller_viscosity</span> <span class='op'>=</span> <span class='nam'>zeros</span><span class='op'>(</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>,</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gforce</span> <span class='op'>=</span> <span class='nam'>zeros</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># Init the worldwide generalized velocity vector:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gvel</span> <span class='op'>=</span> <span class='nam'>zeros</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>j</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>iterjoints</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gvel</span><span class='op'>[</span><span class='nam'>j</span><span class='op'>.</span><span class='nam'>dof</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>gvel</span><span class='op'>[</span><span class='op'>:</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>j</span><span class='op'>.</span><span class='nam'>gvel</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gvel</span><span class='op'>[</span><span class='nam'>j</span><span class='op'>.</span><span class='nam'>dof</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>c</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_constraints</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>c</span><span class='op'>.</span><span class='nam'>init</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>a</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_controllers</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>a</span><span class='op'>.</span><span class='nam'>init</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>current_time</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_current_time</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>up</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_up</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>mass</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_mass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>viscosity</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_viscosity</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>nleffects</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_nleffects</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>ndof</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>gvel</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gvel</span><span class='op'>.</span><span class='nam'>copy</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>update_geometric</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Compute the forward geometric model. </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; This will recursively update each body pose attribute.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Example:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w = simplearm()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w.update_geometric()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>ground</span><span class='op'>.</span><span class='nam'>update_geometric</span><span class='op'>(</span><span class='nam'>eye</span><span class='op'>(</span><span class='num'>4</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>update_kinematic</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Compute the forward geometric and kinematic models. </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; This will recursively update all each body pose and jacobian</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; attributes.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>ground</span><span class='op'>.</span><span class='nam'>update_kinematic</span><span class='op'>(</span><span class='nam'>eye</span><span class='op'>(</span><span class='num'>4</span><span class='op'>)</span><span class='op'>,</span><span class='nam'>zeros</span><span class='op'>(</span><span class='op'>(</span><span class='num'>6</span><span class='op'>,</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>update_dynamic</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>r&quot;&quot;&quot;Compute the forward geometric, kinematic and dynamic models. </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Recursively update each body pose, jacobian, djacobian, twist </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; and nleffects attributes (thanks to the</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :meth:`arboris.Body.update_dynamic` method) and then update</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; the world mass, viscosity and nleffects attributes.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; **Example:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w = simplearm()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w.update_dynamic()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; **Algorithm:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; The (world) generalized mass, viscosity and nleffect matrices </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; respectively denoted `M`, `B` and `N` are computed from each body </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; `b` jacobian `\J[b]_{b/g}`, hessian `\dJ[b]_{b/g}`, mass `M_b`, </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; viscosity `B_b` and nleffects `N_b` matrices as :</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; M &amp;= \sum_b \J[b]_{b/g}^T \; M_b \; \J[b]_{b/g} \\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; B &amp;= \sum_b \J[b]_{b/g}^T \; B_b \; \J[b]_{b/g} \\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; N &amp;= \sum_b \J[b]_{b/g}^T </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \left( M_b \; \dJ[b]_{b/g} + N_b \; \J[b]_{b/g}\right)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; If there is no additional constraint (such as contacts) nor actuation</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; involved, the resulting (free) model is then:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; M \dGVel + \left( N + B \right) \GVel = 0</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>ground</span><span class='op'>.</span><span class='nam'>update_dynamic</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>eye</span><span class='op'>(</span><span class='num'>4</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>zeros</span><span class='op'>(</span><span class='op'>(</span><span class='num'>6</span><span class='op'>,</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>)</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>zeros</span><span class='op'>(</span><span class='op'>(</span><span class='num'>6</span><span class='op'>,</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>)</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>zeros</span><span class='op'>(</span><span class='num'>6</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_mass</span><span class='op'>[</span><span class='op'>:</span><span class='op'>]</span> <span class='op'>=</span> <span class='num'>0.</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_viscosity</span><span class='op'>[</span><span class='op'>:</span><span class='op'>]</span> <span class='op'>=</span> <span class='num'>0.</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_nleffects</span><span class='op'>[</span><span class='op'>:</span><span class='op'>]</span> <span class='op'>=</span> <span class='num'>0.</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>b</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>ground</span><span class='op'>.</span><span class='nam'>iter_descendant_bodies</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_mass</span> <span class='op'>+=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>b</span><span class='op'>.</span><span class='nam'>jacobian</span><span class='op'>.</span><span class='nam'>T</span><span class='op'>,</span> <span class='nam'>b</span><span class='op'>.</span><span class='nam'>mass</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>b</span><span class='op'>.</span><span class='nam'>jacobian</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_viscosity</span> <span class='op'>+=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>b</span><span class='op'>.</span><span class='nam'>jacobian</span><span class='op'>.</span><span class='nam'>T</span><span class='op'>,</span> <span class='nam'>b</span><span class='op'>.</span><span class='nam'>viscosity</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>b</span><span class='op'>.</span><span class='nam'>jacobian</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_nleffects</span> <span class='op'>+=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>b</span><span class='op'>.</span><span class='nam'>jacobian</span><span class='op'>.</span><span class='nam'>T</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>b</span><span class='op'>.</span><span class='nam'>mass</span><span class='op'>,</span> <span class='nam'>b</span><span class='op'>.</span><span class='nam'>djacobian</span><span class='op'>)</span> <span class='op'>+</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>b</span><span class='op'>.</span><span class='nam'>nleffects</span><span class='op'>,</span> <span class='nam'>b</span><span class='op'>.</span><span class='nam'>jacobian</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>update_controllers</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>dt</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>r&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :param dt:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :type dt: float</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :param t:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :type t: float</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; **Example:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w = simplearm()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; from arboris.controllers import ProportionalDerivativeController</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; joints = w.getjoints()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; a0 = ProportionalDerivativeController(joints[1:2], 2.)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w.register(a0)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w.init()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w.update_dynamic()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w.update_controllers(0.001)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w._impedance</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; array([[ 686.98833333,&nbsp; 223.44666667,&nbsp;&nbsp; 20.67333333],</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [ 223.44666667,&nbsp;&nbsp; 93.44866667,&nbsp;&nbsp; 10.67333333],</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [&nbsp; 20.67333333,&nbsp;&nbsp; 10.67333333,&nbsp; &nbsp; 2.67333333]])</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; w._admittance</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; array([[ 0.00732382, -0.0203006 ,&nbsp; 0.0244142 ],</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [-0.0203006 ,&nbsp; 0.07594182, -0.14621124],</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [ 0.0244142 , -0.14621124,&nbsp; 0.76901683]])</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; **Algorithm:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Let&#39;s consider the following discretized 2nd-order model:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; M(t) \dGVel(t+dt) + \left( N(t)+B(t) )\right) \GVel(t+dt) &amp;= </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \GForce(t)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; considering</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \dGVel(t+dt) = \frac{\GVel(t+dt) - \GVel(t)}{dt}</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; we get</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \left( \frac{M(t)}{dt}+N(t)+B(t) \right) \GVel(t+dt) &amp;= </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \frac{M(t)}{dt} \GVel(t) + \GForce(t)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Here `\GForce(t)` sums up the generalized forces due to </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; all the active controllers and constraints.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; The generalized force due to a controller has the following form:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \GForce_a(t) &amp;= \GForce_{0a}(t) + Z_a(t) \GVel(t+td)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; where `\GForce_{0a}(t)` is constant during the </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; `[t, t+dt]` period of time.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; It leads us to</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \left( \frac{M(t)}{dt}+N(t)+B(t) -\sum_a Z_a(t) \right) </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \GVel(t+dt) &amp;= </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \frac{M(t)}{dt} \GVel(t) + \sum_a \GForce_{0a}(t)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; One can the define impedance (`Z`) and admittance (`Y`)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; matrices:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Z(t) &amp;= \frac{M(t)}{dt}+N(t)+B(t)-\sum_a Z_a(t) \\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Y(t) &amp;= Z^{-1}(t)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; TODO: check the two last tests results!</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>dt</span> <span class='op'>&gt;</span> <span class='num'>0</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gforce</span><span class='op'>[</span><span class='op'>:</span><span class='op'>]</span> <span class='op'>=</span> <span class='num'>0.</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_impedance</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_mass</span><span class='op'>/</span><span class='nam'>dt</span> <span class='op'>+</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_viscosity</span> <span class='op'>+</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_nleffects</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>a</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_controllers</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>(</span><span class='nam'>gforce</span><span class='op'>,</span> <span class='nam'>impedance</span><span class='op'>)</span> <span class='op'>=</span> <span class='nam'>a</span><span class='op'>.</span><span class='nam'>update</span><span class='op'>(</span><span class='nam'>dt</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gforce</span> <span class='op'>+=</span> <span class='nam'>gforce</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_impedance</span> <span class='op'>-=</span> <span class='nam'>impedance</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_admittance</span> <span class='op'>=</span> <span class='nam'>numpy</span><span class='op'>.</span><span class='nam'>linalg</span><span class='op'>.</span><span class='nam'>inv</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_impedance</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>update_constraints</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>dt</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>r&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; In accordance with the integration scheme, we assume the following</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; first order model between generalized velocities and generalized </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; forces:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \GVel(t+dt) &amp;= Y(t) </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \left( \frac{M(t)}{dt} \GVel(t) + \GForce(t) \right)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; where:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - the admittance matrix&nbsp; `Y` takes into account a </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; first order model of the actuators,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - the actuators generalized forces `\GForce(t)` </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; are assumed to be constant during the `[t , t+dt ]`</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time interval.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; This (constraint-free) model must be completed by constraints </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; forces `\pre[c]f`, which are mapped to generalized forces</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; by the constraint jacobian `\pre[c]J_c^T`:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \GVel(t+dt) </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;= Y(t) </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \left( \frac{M(t)}{dt} \GVel(t) + \GForce(t)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + \sum_{c} \; \pre[c]J_{c}^T(t) \; \pre[c]f(t)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \right)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; one can also define the constraint velocity&nbsp; as: </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; `\pre[c]v = \pre[c]J_c \; \GVel` so that:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \pre[c]v(t+dt) </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;= \pre[c]J_c(t) \; \GVel(t+dt)\\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;= \pre[c]J_c(t) \; Y(t) </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \left( </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \frac{M(t)}{dt} \GVel(t) + \; \GForce(t)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \right)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + \sum_d \; \pre[c]J_c(t) \; Y(t) \; \pre[d]J_d^T(t) </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \; \pre[d]f(t)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; one can define the (global) constraints velocity `v&#39;`, </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; force `f&#39;`, jacobian matrix `J&#39;` </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; and admittance matrix `Y&#39;`:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; J&#39;(t) &amp;=</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \begin{bmatrix}</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \pre[0]J_0(t)\\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \vdots\\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \pre[c]J_c(t)\\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \vdots</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \end{bmatrix}\\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v&#39;(t) &amp;= </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \begin{bmatrix}</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \pre[0]v(t)\\ \vdots \\ \pre[c]v(t) \\ \vdots</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \end{bmatrix}\\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f&#39;(t) &amp;= </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \begin{bmatrix}</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \pre[0]f(t)\\ \vdots \\ \pre[c]f(t) \\ \vdots</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \end{bmatrix}\\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Y&#39;(t) &amp;= </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; J&#39;(t) \; Y(t) \; J&#39;(t)^T</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; and get a synthetic expression:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v&#39;(t+dt) &amp;= J&#39;(t) \; Y(t) </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \left( \frac{M(t)}{dt}&nbsp; \GVel(t) + \GForce(t) \right)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + Y&#39;(t) \; f&#39;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; This method computes the constraint forces in three steps:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - ask each active constraint object for its jacobian,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - compute `J`, `v`&nbsp; and `Y`,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - iterate over each constraint object in order to compute </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; `\pre[c]f`. At each iteration the force is </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; updated by `\Delta\pre[c]f`</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - eventually add each active constraint generalized force to</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; world :attr:`~arboros.core.World._gforce` property.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; TODO: add an example.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>dt</span> <span class='op'>&gt;</span> <span class='num'>0</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>constraints</span> <span class='op'>=</span> <span class='op'>[</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>ndol</span> <span class='op'>=</span> <span class='num'>0</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>c</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_constraints</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>c</span><span class='op'>.</span><span class='nam'>update</span><span class='op'>(</span><span class='nam'>dt</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>c</span><span class='op'>.</span><span class='nam'>is_active</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>c</span><span class='op'>.</span><span class='nam'>_dol</span> <span class='op'>=</span> <span class='nam'>slice</span><span class='op'>(</span><span class='nam'>ndol</span><span class='op'>,</span> <span class='nam'>ndol</span><span class='op'>+</span><span class='nam'>c</span><span class='op'>.</span><span class='nam'>ndol</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>ndol</span> <span class='op'>=</span> <span class='nam'>ndol</span> <span class='op'>+</span> <span class='nam'>c</span><span class='op'>.</span><span class='nam'>ndol</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>constraints</span><span class='op'>.</span><span class='nam'>append</span><span class='op'>(</span><span class='nam'>c</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>jac</span> <span class='op'>=</span> <span class='nam'>zeros</span><span class='op'>(</span><span class='op'>(</span><span class='nam'>ndol</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_ndof</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>gforce</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gforce</span><span class='op'>.</span><span class='nam'>copy</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>c</span> <span class='key'>in</span> <span class='nam'>constraints</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>jac</span><span class='op'>[</span><span class='nam'>c</span><span class='op'>.</span><span class='nam'>_dol</span><span class='op'>,</span><span class='op'>:</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>c</span><span class='op'>.</span><span class='nam'>jacobian</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>gforce</span> <span class='op'>+=</span> <span class='nam'>c</span><span class='op'>.</span><span class='nam'>gforce</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>vel</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>jac</span><span class='op'>,</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_admittance</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_mass</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gvel</span><span class='op'>/</span><span class='nam'>dt</span><span class='op'>)</span> <span class='op'>+</span> <span class='nam'>gforce</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>admittance</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>jac</span><span class='op'>,</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_admittance</span><span class='op'>,</span> <span class='nam'>jac</span><span class='op'>.</span><span class='nam'>T</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>k</span><span class='op'>=</span><span class='num'>0</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>while</span> <span class='nam'>k</span> <span class='op'>&lt;</span> <span class='num'>20</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#TODO: change the break condition, it should be computed from the error</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>k</span><span class='op'>+=</span><span class='num'>1</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>c</span> <span class='key'>in</span> <span class='nam'>constraints</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>dforce</span> <span class='op'>=</span> <span class='nam'>c</span><span class='op'>.</span><span class='nam'>solve</span><span class='op'>(</span><span class='nam'>vel</span><span class='op'>[</span><span class='nam'>c</span><span class='op'>.</span><span class='nam'>_dol</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>admittance</span><span class='op'>[</span><span class='nam'>c</span><span class='op'>.</span><span class='nam'>_dol</span><span class='op'>,</span><span class='nam'>c</span><span class='op'>.</span><span class='nam'>_dol</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>dt</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>vel</span> <span class='op'>+=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>admittance</span><span class='op'>[</span><span class='op'>:</span><span class='op'>,</span><span class='nam'>c</span><span class='op'>.</span><span class='nam'>_dol</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>dforce</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>c</span> <span class='key'>in</span> <span class='nam'>constraints</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gforce</span> <span class='op'>+=</span> <span class='nam'>c</span><span class='op'>.</span><span class='nam'>gforce</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>integrate</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>dt</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>r&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; From the :meth:`update_controllers` and </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :meth:`update_constraints` methods we get the new </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; generalized velocity.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \GVel(t+dt) &amp;= Y(t) \left(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \frac{M(t)}{dt} \GVel(t) </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + \sum_{c=\text{controllers}} \GForce_{0a}(t)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + \sum_{c=\text{constraints}} \GForce_{c}(t)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \right)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; In order to get the new generalized position, each joint is integrated</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; separately.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; TODO: add support for kinematic controllers</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; TODO: repair this doctest</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; TODO: check the last test result!</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt; w = simplearm()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt; joints = w.getjoints()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt; joints[&#39;Shoulder&#39;].gpos[:] = -1.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt; from arboris.controllers import ProportionalDerivativeController</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt; c0 = ProportionalDerivativeController(w.joints[1:2], 1.)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt; w.register(c0)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt; w.init()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt; w.update_dynamic()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt; dt = 0.001</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt; w.update_controllers(dt)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt; w.integrate(dt)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt; w._gvel</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; array([-0.00709132,&nbsp; 0.03355273, -0.09131555])</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>dt</span> <span class='op'>&gt;</span> <span class='num'>0</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gvel</span><span class='op'>[</span><span class='op'>:</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_admittance</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_mass</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gvel</span><span class='op'>/</span><span class='nam'>dt</span><span class='op'>)</span> <span class='op'>+</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gforce</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>j</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>iterjoints</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>j</span><span class='op'>.</span><span class='nam'>integrate</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_gvel</span><span class='op'>[</span><span class='nam'>j</span><span class='op'>.</span><span class='nam'>dof</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>dt</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_current_time</span> <span class='op'>+=</span> <span class='nam'>dt</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>_SubFrame</span><span class='op'>(</span><span class='nam'>NamedObject</span><span class='op'>,</span> <span class='nam'>Frame</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>body</span><span class='op'>,</span> <span class='nam'>bpose</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Create a frame rigidly fixed to a body. </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; b = Body()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; f = SubFrame(b, Hg.rotz(3.14/3.),&#39;Brand New Frame&#39;)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; The ``body`` argument must be a member of the ``Body`` class:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; f = SubFrame(None, Hg.rotz(3.14/3.))</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Traceback (most recent call last):</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; ValueError: The ``body`` argument must be an instance of the ``Boby`` class</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; The ``bpose`` argument must be an homogeneous matrix:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; b = Body()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; from numpy import ones</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&gt; f = SubFrame(b, ones((4,4)))</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Traceback (most recent call last):</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; AssertionError</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>bpose</span> <span class='key'>is</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>bpose</span> <span class='op'>=</span> <span class='nam'>eye</span><span class='op'>(</span><span class='num'>4</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>NamedObject</span><span class='op'>.</span><span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>Hg</span><span class='op'>.</span><span class='nam'>ishomogeneousmatrix</span><span class='op'>(</span><span class='nam'>bpose</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_bpose</span> <span class='op'>=</span> <span class='nam'>bpose</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span><span class='op'>(</span><span class='nam'>isinstance</span><span class='op'>(</span><span class='nam'>body</span><span class='op'>,</span> <span class='nam'>Body</span><span class='op'>)</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>raise</span> <span class='nam'>ValueError</span><span class='op'>(</span><span class='str'>&quot;The ``body`` argument must be an instance of the ``Boby`` class&quot;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_body</span> <span class='op'>=</span> <span class='nam'>body</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>pose</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_body</span><span class='op'>.</span><span class='nam'>pose</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_bpose</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>twist</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>Hg</span><span class='op'>.</span><span class='nam'>iadjoint</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_bpose</span><span class='op'>)</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_body</span><span class='op'>.</span><span class='nam'>_twist</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>jacobian</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>Hg</span><span class='op'>.</span><span class='nam'>iadjoint</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_bpose</span><span class='op'>)</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_body</span><span class='op'>.</span><span class='nam'>_jacobian</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>djacobian</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># we assume self._bpose is constant</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>Hg</span><span class='op'>.</span><span class='nam'>iadjoint</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>_bpose</span><span class='op'>)</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_body</span><span class='op'>.</span><span class='nam'>_djacobian</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>body</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_body</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractproperty</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>bpose</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>SubFrame</span><span class='op'>(</span><span class='nam'>_SubFrame</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>bpose</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_bpose</span><span class='op'>.</span><span class='nam'>copy</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>MovingSubFrame</span><span class='op'>(</span><span class='nam'>_SubFrame</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>bpose</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_bpose</span><span class='op'>.</span><span class='nam'>copy</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>bpose</span><span class='op'>.</span><span class='nam'>setter</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>bpose</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>bpose</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>assert</span> <span class='nam'>Hg</span><span class='op'>.</span><span class='nam'>ishomogeneousmatrix</span><span class='op'>(</span><span class='nam'>bpose</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_bpose</span><span class='op'>[</span><span class='op'>:</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>bpose</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>Body</span><span class='op'>(</span><span class='nam'>NamedObject</span><span class='op'>,</span> <span class='nam'>Frame</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>,</span> <span class='nam'>mass</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>,</span> <span class='nam'>viscosity</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>mass</span> <span class='key'>is</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>mass</span> <span class='op'>=</span> <span class='nam'>zeros</span><span class='op'>(</span><span class='op'>(</span><span class='num'>6</span><span class='op'>,</span><span class='num'>6</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span> <span class='com'>#TODO: check the mass matrix</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>viscosity</span> <span class='key'>is</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>viscosity</span> <span class='op'>=</span> <span class='nam'>zeros</span><span class='op'>(</span><span class='op'>(</span><span class='num'>6</span><span class='op'>,</span><span class='num'>6</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span> <span class='com'>#TODO: check the viscosity matrix</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>NamedObject</span><span class='op'>.</span><span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>name</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># the object will have a frame, with the same name as the object itself</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>parentjoint</span> <span class='op'>=</span> <span class='nam'>None</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>childrenjoints</span> <span class='op'>=</span> <span class='op'>[</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>mass</span> <span class='op'>=</span> <span class='nam'>mass</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>viscosity</span> <span class='op'>=</span> <span class='nam'>viscosity</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_pose</span> <span class='op'>=</span> <span class='nam'>None</span> <span class='com'># updated by update_{geometric,kinematic,dynamic}</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_jacobian</span> <span class='op'>=</span> <span class='nam'>None</span> <span class='com'># updated by update_{geometric,kinematic,dynamic}</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_djacobian</span> <span class='op'>=</span> <span class='nam'>None</span> <span class='com'># updated by update_dynamic</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_twist</span> <span class='op'>=</span> <span class='nam'>None</span> <span class='com'># updated by update_dynamic</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_nleffects</span> <span class='op'>=</span> <span class='nam'>None</span> <span class='com'># updated by update_dynamic</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>iter_descendant_bodies</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Iterate over all descendant bodies, with a depth-first strategy&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>from</span> <span class='nam'>itertools</span> <span class='key'>import</span> <span class='nam'>imap</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>b</span> <span class='key'>in</span> <span class='nam'>imap</span><span class='op'>(</span><span class='key'>lambda</span> <span class='nam'>j</span><span class='op'>:</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>_frame1</span><span class='op'>.</span><span class='nam'>body</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>childrenjoints</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>b</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>bb</span> <span class='key'>in</span> <span class='nam'>b</span><span class='op'>.</span><span class='nam'>iter_descendant_bodies</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>bb</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>iter_ancestor_bodies</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>parentjoint</span> <span class='key'>is</span> <span class='key'>not</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>parentbody</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>parentjoint</span><span class='op'>.</span><span class='nam'>_frame0</span><span class='op'>.</span><span class='nam'>body</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>parentbody</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>a</span> <span class='key'>in</span> <span class='nam'>parentbody</span><span class='op'>.</span><span class='nam'>iter_ancestor_bodies</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>a</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>iter_descendant_joints</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Iterate over all descendant joints, with a depth-first strategy&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>j</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>childrenjoints</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>j</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>jj</span> <span class='key'>in</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>_frame1</span><span class='op'>.</span><span class='nam'>body</span><span class='op'>.</span><span class='nam'>iter_descendant_joints</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>jj</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>iter_ancestor_joints</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>parentjoint</span> <span class='key'>is</span> <span class='key'>not</span> <span class='nam'>None</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>parentjoint</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>a</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>parentjoint</span><span class='op'>.</span><span class='nam'>_frame0</span><span class='op'>.</span><span class='nam'>body</span><span class='op'>.</span><span class='nam'>iter_ancestor_joints</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>yield</span> <span class='nam'>a</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>pose</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_pose</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>jacobian</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_jacobian</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>djacobian</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_djacobian</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>twist</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_twist</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>nleffects</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_nleffects</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>bpose</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>eye</span><span class='op'>(</span><span class='num'>4</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>property</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>body</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>update_geometric</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span><span class='nam'>pose</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - g: ground body</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - p: parent body</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - c: child body</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - r: reference frame of the joint, rigidly fixed to the parent body</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - n: new frame of the joint, rigidly fixed to the child body</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; so H_nc and H_pr are constant.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; H_gc = H_gp * H_pc</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; = H_gp * (H_pr * H_rn * H_nc)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_pose</span> <span class='op'>=</span> <span class='nam'>pose</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>H_gp</span> <span class='op'>=</span> <span class='nam'>pose</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>j</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>childrenjoints</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>H_cn</span> <span class='op'>=</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>_frame1</span><span class='op'>.</span><span class='nam'>bpose</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>H_pr</span> <span class='op'>=</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>_frame0</span><span class='op'>.</span><span class='nam'>bpose</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>H_rn</span> <span class='op'>=</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>pose</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>H_pc</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>H_pr</span><span class='op'>,</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>H_rn</span><span class='op'>,</span> <span class='nam'>Hg</span><span class='op'>.</span><span class='nam'>inv</span><span class='op'>(</span><span class='nam'>H_cn</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>child_pose</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>H_gp</span><span class='op'>,</span> <span class='nam'>H_pc</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>j</span><span class='op'>.</span><span class='nam'>_frame1</span><span class='op'>.</span><span class='nam'>body</span><span class='op'>.</span><span class='nam'>update_geometric</span><span class='op'>(</span><span class='nam'>child_pose</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>update_dynamic</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>pose</span><span class='op'>,</span> <span class='nam'>jac</span><span class='op'>,</span> <span class='nam'>djac</span><span class='op'>,</span> <span class='nam'>twist</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>r&quot;&quot;&quot;Sets the body ``pose, jac, djac, twist`` and computes its children ones.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; This method (1) sets the body dynamical model (pose, jacobian, </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; hessian and twist) to the values given as argument, (2) computes </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; the dynamical model of the children bodies and (3) call the </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; equivalent method on them.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; As a result, the dynamical model of all the bodies is computed </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; recursively.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp;&nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :param pose: the body pose relative to the ground: `H_{gb}`</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :type pose: 4x4 ndarray</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :param jac: the body jacobian relative to the world (in body frame):</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; `\J[b]_{b/g}`</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :type jac: 6x(ndof) ndarray</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :param djac: the derivative of the body jacobian: `\dJ[b]_{b/g}`</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :param twist: the body twist: `\twist[b]_{b/g}`</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :type twist: 6 ndarray</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; **Algorithm:**</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Let&#39;s define the following notations:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - `g`: the ground body,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - `p`: the parent body (which is the present :class:`arboris.Body` </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instance)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - `c`: a child body,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - `j`: the joint between the bodies `p` and `c`,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - `r`: reference frame of the joint `j`, rigidly fixed to the parent </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; body</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; - `n`: new frame of the joint `j`, rigidly fixed to the child body</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. image:: img/body_model.png</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; One can notice that `H_{nc}` and `H_{pr}` are constant.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; The child body pose can be computed as</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; H_{gc} &amp;= H_{gp} \; H_{pc} \\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;= H_{gp} \; (H_{pr} \; H_{rn} \; H_{nc})</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; where `H_{rn}` depends on the joint generalized configuration and is </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; given by its :attr:`~arboris.core.Joint.pose` attribute.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; The chil body twist is given as</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \twist[c]_{c/g} &amp;= \Ad[c]_p \; \twist[p]_{p/g} + \twist[c]_{c/p} \\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;= \Ad[c]_p \; \twist[p]_{p/g} + \Ad[c]_n \; \twist[n]_{n/r} \\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;= \Ad[c]_p \; \J[p]_{p/g} \; \GVel </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; + \Ad[c]_n \; \J[n]_{n/r} \; \GVel_j \\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;= \J[c]_{c/g} \; \GVel</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; where&nbsp; `\twist[n]_{n/r}` isgiven by the joint</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :attr:`~arboris.core.Joint.twist` attribute. </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; \GVel_j is the generalized velocity of the joint `j` and is </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; related to the world generalized velocity by trivial projection</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \GVel_j &amp;= </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \begin{bmatrix}</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &amp; \cdots &amp;0 &amp; I &amp; 0 &amp; \cdots &amp; 0</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \end{bmatrix} \; \GVel</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; therefore, the child body jacobian is</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \J[c]_{c/g} &amp;= \Ad[c]_p \; \J[p]_{p/g} + </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \begin{bmatrix}</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &amp; \cdots &amp; 0 &amp; \Ad[c]_n \; \J[n]_{n/r} &amp; 0 &amp; \cdots &amp; 0</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \end{bmatrix} \\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; where `\J[n]_{n/r}` is given by the joint</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :attr:`~arboris.core.Joint.jacobian` attribute. Derivating the previous</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; expression leads to the child body acceleration:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \dtwist[c]_{c/g} &amp;= \dAd[c]_p \; \J[p]_{p/g} \; \GVel</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + \Ad[c]_p \; \dJ[p]_{p/g} \; \GVel</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + \Ad[c]_p \; \J[p]_g \; \dGVel</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + \Ad[c]_n \; \dJ[n]_{n/r} \; \GVel_j</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + \Ad[c]_n \; \J[n]_{m/r} \dGVel_j \\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;= \J[c]_{c/g} \; \dGVel + \dJ[c]_{c/g} \; \GVel</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; the expression of the child body hessian is then obtained by</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; identification:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \dJ[c]_{c/g} \; \GVel</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;= \dAd[c]_p \; \J[p]_{p/g} \; \GVel</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + \Ad[c]_p \; \dJ[p]_{p/g} \; \GVel</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + \Ad[c]_n \; \dJ[n]_{n/r} \; \GVel_j \\</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \dJ[c]_{c/g} </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;= \dAd[c]_p \; \J[p]_{p/g} + \Ad[c]_p \; \dJ[p]_{p/g} + </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \begin{bmatrix}</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &amp; \cdots &amp; 0 &amp; (\Ad[c]_n \; \dJ[n]_{n/r}) &amp; 0 &amp; \cdots &amp; 0</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \end{bmatrix}</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; with </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; .. math::</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \dAd[c]_p &amp;= \Ad[c]_n \; \dAd[n]_r \; \Ad[r]_p</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; and where `\dAd[n]_r` and `\dJ[n]_{n/r}` are respectively given by </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; the joint :attr:`~arboris.core.Joint.idadjoint` and </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; :attr:`~arboris.core.Joint.djacobian` attributes.</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; T_ab: velocity of {a} relative to {b} expressed in {a} (body twist)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_pose</span> <span class='op'>=</span> <span class='nam'>pose</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_jacobian</span> <span class='op'>=</span> <span class='nam'>jac</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_djacobian</span> <span class='op'>=</span> <span class='nam'>djac</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_twist</span> <span class='op'>=</span> <span class='nam'>twist</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>wx</span> <span class='op'>=</span> <span class='nam'>array</span><span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>[</span><span class='op'>[</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='num'>0</span><span class='op'>,</span><span class='op'>-</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>twist</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>twist</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='op'>[</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>twist</span><span class='op'>[</span><span class='num'>2</span><span class='op'>]</span><span class='op'>,</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='num'>0</span><span class='op'>,</span><span class='op'>-</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>twist</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>]</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='op'>[</span><span class='op'>-</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>twist</span><span class='op'>[</span><span class='num'>1</span><span class='op'>]</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>twist</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>,</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='num'>0</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>mass</span><span class='op'>[</span><span class='num'>3</span><span class='op'>,</span><span class='num'>3</span><span class='op'>]</span><span class='op'>&lt;=</span><span class='num'>1e-10</span><span class='op'>:</span> <span class='com'>#TODO: avoid hardcoded value</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>rx</span> <span class='op'>=</span> <span class='nam'>zeros</span><span class='op'>(</span><span class='op'>(</span><span class='num'>3</span><span class='op'>,</span><span class='num'>3</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>rx</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>mass</span><span class='op'>[</span><span class='num'>0</span><span class='op'>:</span><span class='num'>3</span><span class='op'>,</span><span class='num'>3</span><span class='op'>:</span><span class='num'>6</span><span class='op'>]</span><span class='op'>/</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>mass</span><span class='op'>[</span><span class='num'>3</span><span class='op'>,</span><span class='num'>3</span><span class='op'>]</span> <span class='com'>#TODO: better solution?</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_nleffects</span> <span class='op'>=</span> <span class='nam'>zeros</span><span class='op'>(</span><span class='op'>(</span><span class='num'>6</span><span class='op'>,</span><span class='num'>6</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_nleffects</span><span class='op'>[</span><span class='num'>0</span><span class='op'>:</span><span class='num'>3</span><span class='op'>,</span><span class='num'>0</span><span class='op'>:</span><span class='num'>3</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>wx</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_nleffects</span><span class='op'>[</span><span class='num'>3</span><span class='op'>:</span><span class='num'>6</span><span class='op'>,</span><span class='num'>3</span><span class='op'>:</span><span class='num'>6</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>wx</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_nleffects</span><span class='op'>[</span><span class='num'>0</span><span class='op'>:</span><span class='num'>3</span><span class='op'>,</span><span class='num'>3</span><span class='op'>:</span><span class='num'>6</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>rx</span><span class='op'>,</span><span class='nam'>wx</span><span class='op'>)</span> <span class='op'>-</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>wx</span><span class='op'>,</span><span class='nam'>rx</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>_nleffects</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>nleffects</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>mass</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>H_gp</span> <span class='op'>=</span> <span class='nam'>pose</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>J_pg</span> <span class='op'>=</span> <span class='nam'>jac</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>dJ_pg</span> <span class='op'>=</span> <span class='nam'>djac</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>T_pg</span> <span class='op'>=</span> <span class='nam'>twist</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>j</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>childrenjoints</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>H_cn</span> <span class='op'>=</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>_frame1</span><span class='op'>.</span><span class='nam'>bpose</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>H_pr</span> <span class='op'>=</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>_frame0</span><span class='op'>.</span><span class='nam'>bpose</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>H_rn</span> <span class='op'>=</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>pose</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>H_pc</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>H_pr</span><span class='op'>,</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>H_rn</span><span class='op'>,</span> <span class='nam'>Hg</span><span class='op'>.</span><span class='nam'>inv</span><span class='op'>(</span><span class='nam'>H_cn</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>child_pose</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>H_gp</span><span class='op'>,</span> <span class='nam'>H_pc</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>Ad_cp</span> <span class='op'>=</span> <span class='nam'>Hg</span><span class='op'>.</span><span class='nam'>iadjoint</span><span class='op'>(</span><span class='nam'>H_pc</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>Ad_cn</span> <span class='op'>=</span> <span class='nam'>Hg</span><span class='op'>.</span><span class='nam'>adjoint</span><span class='op'>(</span><span class='nam'>H_cn</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>Ad_rp</span> <span class='op'>=</span> <span class='nam'>Hg</span><span class='op'>.</span><span class='nam'>adjoint</span><span class='op'>(</span><span class='nam'>Hg</span><span class='op'>.</span><span class='nam'>inv</span><span class='op'>(</span><span class='nam'>H_pr</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>dAd_nr</span> <span class='op'>=</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>idadjoint</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>dAd_cp</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>Ad_cn</span><span class='op'>,</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>dAd_nr</span><span class='op'>,</span> <span class='nam'>Ad_rp</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>T_nr</span> <span class='op'>=</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>twist</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>J_nr</span> <span class='op'>=</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>jacobian</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>dJ_nr</span> <span class='op'>=</span> <span class='nam'>j</span><span class='op'>.</span><span class='nam'>djacobian</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>child_twist</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>Ad_cp</span><span class='op'>,</span> <span class='nam'>T_pg</span><span class='op'>)</span> <span class='op'>+</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>Ad_cn</span><span class='op'>,</span> <span class='nam'>T_nr</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>child_jac</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>Ad_cp</span><span class='op'>,</span> <span class='nam'>J_pg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>child_jac</span><span class='op'>[</span><span class='op'>:</span><span class='op'>,</span><span class='nam'>j</span><span class='op'>.</span><span class='nam'>dof</span><span class='op'>]</span> <span class='op'>+=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>Ad_cn</span><span class='op'>,</span> <span class='nam'>J_nr</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>child_djac</span> <span class='op'>=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>dAd_cp</span><span class='op'>,</span> <span class='nam'>J_pg</span><span class='op'>)</span> <span class='op'>+</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>Ad_cp</span><span class='op'>,</span> <span class='nam'>dJ_pg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>child_djac</span><span class='op'>[</span><span class='op'>:</span><span class='op'>,</span><span class='nam'>j</span><span class='op'>.</span><span class='nam'>dof</span><span class='op'>]</span> <span class='op'>+=</span> <span class='nam'>dot</span><span class='op'>(</span><span class='nam'>Ad_cn</span><span class='op'>,</span> <span class='nam'>dJ_nr</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>j</span><span class='op'>.</span><span class='nam'>_frame1</span><span class='op'>.</span><span class='nam'>body</span><span class='op'>.</span><span class='nam'>update_dynamic</span><span class='op'>(</span><span class='nam'>child_pose</span><span class='op'>,</span> <span class='nam'>child_jac</span><span class='op'>,</span> <span class='nam'>child_djac</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>child_twist</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>class</span> <span class='nam'>Observer</span><span class='op'>(</span><span class='nam'>object</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>__metaclass__</span> <span class='op'>=</span> <span class='nam'>ABCMeta</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractmethod</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>init</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>world</span><span class='op'>,</span> <span class='nam'>timeline</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractmethod</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>update</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>dt</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='op'>@</span><span class='nam'>abstractmethod</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>finish</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'><span class='key'>def</span> <span class='nam'>simulate</span><span class='op'>(</span><span class='nam'>world</span><span class='op'>,</span> <span class='nam'>timeline</span><span class='op'>,</span> <span class='nam'>observers</span><span class='op'>=</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'>&nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Run a full simulation, </span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param world: the world to be simulated</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type world: :class:`arboris.core.World`</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :param time: a list of distinct times</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; :type time: iterable</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; Example:</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; w = simplearm()</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; dt = 0.001</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; time = numpy.arange(0,0.01,0.001)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &gt;&gt;&gt; simulate(w, time)</span><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='strut'>&nbsp;</span></p>
<p class='pln'><span class='str'>&nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>world</span><span class='op'>.</span><span class='nam'>_current_time</span> <span class='op'>!=</span> <span class='nam'>timeline</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span> <span class='com'>#TODO: use logger to warn user of possible problem</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>world</span><span class='op'>.</span><span class='nam'>_current_time</span> <span class='op'>=</span> <span class='nam'>timeline</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>world</span><span class='op'>.</span><span class='nam'>init</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obs</span> <span class='key'>in</span> <span class='nam'>observers</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>obs</span><span class='op'>.</span><span class='nam'>init</span><span class='op'>(</span><span class='nam'>world</span><span class='op'>,</span> <span class='nam'>timeline</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>next_time</span> <span class='key'>in</span> <span class='nam'>timeline</span><span class='op'>[</span><span class='num'>1</span><span class='op'>:</span><span class='op'>]</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>dt</span> <span class='op'>=</span> <span class='nam'>next_time</span> <span class='op'>-</span> <span class='nam'>world</span><span class='op'>.</span><span class='nam'>_current_time</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>world</span><span class='op'>.</span><span class='nam'>update_dynamic</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>world</span><span class='op'>.</span><span class='nam'>update_controllers</span><span class='op'>(</span><span class='nam'>dt</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>world</span><span class='op'>.</span><span class='nam'>update_constraints</span><span class='op'>(</span><span class='nam'>dt</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obs</span> <span class='key'>in</span> <span class='nam'>observers</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>obs</span><span class='op'>.</span><span class='nam'>update</span><span class='op'>(</span><span class='nam'>dt</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>world</span><span class='op'>.</span><span class='nam'>integrate</span><span class='op'>(</span><span class='nam'>dt</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obs</span> <span class='key'>in</span> <span class='nam'>observers</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p class='stm mis'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>obs</span><span class='op'>.</span><span class='nam'>finish</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
    
</td>
</tr>
</table>
</div>

</body>
</html>
